#!/usr/bin/env bash
#######################################
download_vnc_apk_menu() {
	cd /sdcard/Download || mkdir -p /sdcard/Download && cd /sdcard/Download
	RETURN_TO_WHERE='download_vnc_apk_menu'
	#15 60 4
	OPTION=$(whiptail --title "remote desktop apk" --menu "Which remote desktop software do you want to install?" 0 50 0 \
		"1" "vnc/xsdl" \
		"2" "xwayland" \
		"0" "ğŸŒš Back to the main menu è¿”å›ä¸»èœå•" \
		3>&1 1>&2 2>&3)
	##########################
	case "${OPTION}" in
	0 | "") ${RETURN_TO_MENU} ;;
	1) download_vnc_or_xsdl_apk ;;
	2) xwayland_warning ;;
	esac
	###########
	press_enter_to_return
	${RETURN_TO_WHERE}
}
#########################################
download_vnc_or_xsdl_apk() {
	for i in /sdcard/Download ~/sd/Download /media/sd/Download; do
		[[ ! -e ${i} ]] || cd ${i}
	done
	unset i

	if (whiptail --title "æ‚¨æƒ³è¦ä¸‹è½½å“ªä¸ªè½¯ä»¶?" --yes-button 'VNC Viewer' --no-button 'XServer XSDL' --yesno "vncæ“ä½œä½“éªŒæ›´å¥½,å½“å‰ç‰ˆæœ¬å·²ç»å¯ä»¥é€šè¿‡pulse serveræ¥ä¼ è¾“éŸ³é¢‘ã€‚xsdlå¯¹æŸäº›è½¯ä»¶çš„å…¼å®¹æ€§æ›´é«˜ï¼Œä½†æ“ä½œä½“éªŒæ²¡æœ‰vncå¥½ã€‚VNC has a better operating experience and is also smoother.XSDL is more compatible with some softwareï¼Œ but the experience is not as good as VNC in every way.\nè‹¥VNCå¯åŠ¨åä»æ— å£°éŸ³ï¼Œåˆ™è¯·å‰å¾€Playå•†åº—æˆ–Fdroidæ›´æ–°termuxè‡³æœ€æ–°ç‰ˆæœ¬,å†å®‰è£…termux:api.apk" 16 50); then
		printf "%s\n" "${YELLOW}æŒ‰å›è½¦é”®å¼€å§‹ä¸‹è½½${RESET}"
		do_you_want_to_continue
		printf '%s\n' 'Downloading vnc viewer...'
		#rm -f 'VNCViewer_com-realvnc-viewer-android-3-6-1-42089.tar.xz' 2>/dev/null
		printf '%s\n' 'æ­£åœ¨ä¸ºæ‚¨ä¸‹è½½è‡³/sdcard/Downloadç›®å½•...'
		printf '%s\n' 'Download size â‰ˆ11MB'
		if [ -d "/sdcard/Download/.GITCLONEVNCCLIENT" ]; then
			rm -rf /sdcard/Download/.GITCLONEVNCCLIENT
		fi

		git clone -b vnc --depth=1 https://gitee.com/mo2/VncClient.git .GITCLONEVNCCLIENT
		mv -f /sdcard/Download/.GITCLONEVNCCLIENT/vnc/vnc36142089.tar.xz ./
		printf '%s\n' 'æ­£åœ¨è§£å‹...'
		tar -Jxvf vnc36142089.tar.xz
		#tar -Jxvf 'VNCViewer_com-realvnc-viewer-android-3-6-1-42089.tar.xz'
		rm -rf /sdcard/Download/.GITCLONEVNCCLIENT
		rm -f /sdcard/Download/vnc36142089.tar.xz
		printf '%s\n' 'æ­£åœ¨åˆ é™¤å‹ç¼©åŒ…...'
		printf '%s\n' 'Deleting ...'
		#rm -f 'VNCViewer_com-realvnc-viewer-android-3-6-1-42089.tar.xz'
		am start -n com.android.documentsui/com.android.documentsui.ViewDownloadsActivity
		printf "%s\n" "${YELLOW}è§£å‹æˆåŠŸï¼Œè¯·è¿›å…¥ä¸‹è½½ç›®å½•æ‰‹åŠ¨å®‰è£…ã€‚${RESET}"
		printf '%s\n' 'æ–‡ä»¶åç§° VNC Viewer_com,realvnc,viewer,android_3,6,1,42089.apk'
		cd ${CURRENT_DIR}
	else
		printf '%s\n' 'æŒ‰å›è½¦é”®å¼€å§‹ä¸‹è½½'
		do_you_want_to_continue
		printf '%s\n' 'Downloading xsdl...'
		#rm -f 'XServerXSDL-X-org-server_1-20-41.tar.xz' 2>/dev/null
		printf '%s\n' 'æ­£åœ¨ä¸ºæ‚¨ä¸‹è½½è‡³/sdcard/Downloadç›®å½•...'
		printf '%s\n' 'Download size â‰ˆ29MB'
		if [ -d "/sdcard/Download/.GITCLONEVNCCLIENT" ]; then
			rm -rf /sdcard/Download/.GITCLONEVNCCLIENT
		fi

		git clone -b xsdl --depth=1 https://gitee.com/ak2/xsdl.git .GITCLONEVNCCLIENT
		mv -f /sdcard/Download/.GITCLONEVNCCLIENT/xsdl/XSDL.tar.xz ./
		printf '%s\n' 'æ­£åœ¨è§£å‹...'
		tar -Jxvf XSDL.tar.xz
		#tar -Jxvf 'XServerXSDL-X-org-server_1-20-41.tar.xz'
		rm -rf /sdcard/Download/.GITCLONEVNCCLIENT
		rm -f /sdcard/Download/XSDL.tar.xz
		printf '%s\n' 'æ­£åœ¨åˆ é™¤å‹ç¼©åŒ…...'
		printf '%s\n' 'Deleting ...'
		#rm -f 'XServerXSDL-X-org-server_1-20-41.tar.xz'

		printf '%s\n' 'è§£å‹æˆåŠŸï¼Œè¯·è¿›å…¥ä¸‹è½½ç›®å½•æ‰‹åŠ¨å®‰è£…ã€‚'
		printf '%s\n' 'æ–‡ä»¶åç§° XServer XSDL*.apk'
		am start -n com.android.documentsui/com.android.documentsui.ViewDownloadsActivity
		cd ${CURRENT_DIR}
	fi
}
###################
download_vnc_or_xsdl_apk
