#!/usr/bin/env bash
############################################
proot_management_menu() {
	case ${TMOE_CHROOT} in
	false) TMOE_TIPS_02='' ;;
	*) TMOE_TIPS_02='\nchrootÂú®Êú™umountÂâçremoveÂ∞ÜÂØºËá¥ÂÆø‰∏ªÁ≥ªÁªüÈáçË¶ÅÊï∞ÊçÆË¢´Ê∏ÖÁ©∫' ;;
	esac
	RETURN_TO_WHERE='proot_management_menu'
	CURRENT_DIR="$(pwd)"
	TMOE_CONTAINER_FORTUNE=true
	TMOE_CONTAINER_HITOKOTO=true
	MACHINE_NAME=$(printf "%s\n" ${DEBIAN_FOLDER} | sed 's@_@-@g')
	proot_management_menu_en() {
		SELECTED_GNU_LINUX=$(whiptail --title "${DEBIAN_FOLDER_CAPITAL}" --menu "CONTAINER_DIR=${DEBIAN_CHROOT_MIN}\nFor non-special circumstances,please do not run rm -rf \${CONTAINER_DIR} manually." 0 50 0 \
			"1" "üå± start ${DEBIAN_FOLDER}" \
			"2" "‚èπÔ∏è kill process" \
			"3" "üêØ start gui(remote desktop)" \
			"4" "alpha:Create a temp auto-startup script" \
			"5" "üçπ backup ${CONTAINER_TYPE} container" \
			"6" "üíî unmount & remove" \
			"7" "üìò readme" \
			"8" "üåà beta:create a new container" \
			"9" "ü•§ edit script" \
			"10" "üçÖ space occupation" \
			"0" "üåö Return to previous menu" \
			3>&1 1>&2 2>&3)
	}
	proot_management_menu_cn() {
		SELECTED_GNU_LINUX=$(whiptail --title "${DEBIAN_FOLDER_CAPITAL}" --menu "ÂÆπÂô®Ë∑ØÂæÑ‰∏∫${DEBIAN_CHROOT_MIN}\nÈùûÁâπÊÆäÊÉÖÂÜµ‰∏ã,ËØ∑Âú®Êú¨Â∑•ÂÖ∑ÂÜÖÊ≠£Â∏∏ÁßªÈô§ÂÆπÂô®,ËØ∑ÂãøÊâãÂä®rm -rf \${ÂÆπÂô®Ë∑ØÂæÑ}${TMOE_TIPS_02}" 0 50 0 \
			"1" "üå± ÂêØÂä®${CONTAINER_TYPE} ${DEBIAN_FOLDER}" \
			"2" "‚èπÔ∏è ÂÅúÊ≠¢ÂÆπÂô®ËøõÁ®ã" \
			"3" "üêØ start gui(remote desktop)" \
			"4" "alphaÂÜÖÊµã:ÂàõÂª∫‰∏¥Êó∂Ëá™ÂêØÂä®ËÑöÊú¨" \
			"5" "üçπ backup Â§á‰ªΩ${CONTAINER_TYPE}ÂÆπÂô®" \
			"6" "üíî unmount & remove Âç∏ËΩΩÂπ∂ÁßªÈô§" \
			"7" "üìò readme Ëá™Ëø∞/ËØ¥Êòé" \
			"8" "üåà betaÂÖ¨Êµã:create a new containerÊñ∞Âª∫ÂÆπÂô®" \
			"9" "ü•§ edit script ÁºñËæëËÑöÊú¨" \
			"10" "üçÖ space occupation Á©∫Èó¥Âç†Áî®Â§ßÂ∞è" \
			"0" "üåö back ËøîÂõû‰∏äÁ∫ßËèúÂçï" \
			3>&1 1>&2 2>&3)
	}
	proot_management_menu_de() {
		SELECTED_GNU_LINUX=$(whiptail --title "${DEBIAN_FOLDER_CAPITAL}" --menu "CONTAINER_DIR=${DEBIAN_CHROOT_MIN}\nF√ºhren Sie rm -rf \${CONTAINER_DIR} unter nicht besonderen Umst√§nden nicht manuell aus." 0 50 0 \
			"1" "üå± start ${DEBIAN_FOLDER}" \
			"2" "‚èπÔ∏è T√∂tungsprozess" \
			"3" "üêØ start gui(remote desktop)" \
			"4" "alpha:Create a temp auto-startup script" \
			"5" "üçπ backup ${CONTAINER_TYPE} container" \
			"6" "üíî aush√§ngen und entfernen" \
			"7" "üìò Liesmich" \
			"8" "üåà beta:Erstellen Sie einen neuen Container" \
			"9" "ü•§ Skript bearbeiten" \
			"10" "üçÖ Raumbesetzung" \
			"0" "üåö zur√ºck" \
			3>&1 1>&2 2>&3)
	}
	case ${TMOE_MENU_LANG} in
	zh_*UTF-8) proot_management_menu_cn ;;
	de_DE.UTF-8) proot_management_menu_de ;; #Deutsche
	*) proot_management_menu_en ;;
	esac
	##############################
	case "${SELECTED_GNU_LINUX}" in
	0 | "") ${RETURN_TO_MENU} ;;
	1) normally_start_gnu_linux_distro ;;
	2) kill_container_process ;;
	3) start_gui_menu ;;
	4) create_a_temporary_automatic_startup_script ;;
	5) backup_tmoe_gnu_linux_distro ;;
	6) umount_and_remove_gnu_linux_distro ;;
	7) readme_of_gnu_linux_distro ;;
	8)
		case ${RETURN_TO_MENU} in
		'list_installed_tmoe_containers')
			printf "%s\n" "${RED}Sorry${RESET}, it is not possible to create a new container in the current mode, please return to the main menu and select the architecture again."
			printf "%s\n" "You can press ${YELLOW}Ctrl + C${RESET} to exit the current mode, and type ${GREEN}tmoe m${RESET} to enter the ${BLUE}main menu.${RESET}"
			press_enter_to_return
			proot_management_menu
			;;
		*) create_a_new_container ;;
		esac
		;;
	9) edit_container_startup_script ;;
	10) du_sh_gnu_linux_distro ;;
	esac
	#"9" "ü•§ install ÂÆâË£Ö" \ 9) install_new_tmoe_gnu_linux_distro ;;
	####################
	case "${SELECTED_GNU_LINUX}" in
	2 | 6 | 7 | 9 | 10)
		#kill_container_process, backup_tmoe_gnu_linux_distro, readme_of_gnu_linux_distro, edit_container_startup_script, du_sh_gnu_linux_distro
		#ÂõûÂà∞Êú¨ËèúÂçïÔºö ÂÅúÊ≠¢ËøõÁ®ã,Â§á‰ªΩÔºåÂëΩ‰ª§ÔºåÁ©∫Èó¥ ,ÁºñËæë
		press_enter_to_return
		proot_management_menu
		;;
	6)
		#unmount & remove :umount_and_remove_gnu_linux_distro
		${RETURN_TO_MENU}
		;;
	esac
	#Âç∏ËΩΩ‰πãÂêéË¶ÅÂõûÂà∞ÂèëË°åÁâàÈÄâÊã©ËèúÂçïÔºåËÄåÈùûÂΩìÂâçÂèëË°åÁâàËèúÂçï
}
##############################
create_a_temporary_automatic_startup_script() {
	printf "%s\n" "${YELLOW}PREVIEW:${RESET}"
	printf "%s\n" "You can create an automatic startup script, and when you enter the container, the container will automatically execute it."
	printf "%s\n" "If it is a temporary script, it will only be executed once and will not take effect next time.If it is a permanent script, it will be executed every time you enter the container."
	printf "%s\n" "For example, if you need a container to automatically execute ${GREEN}ruby -run -e httpd . -p 8080${RESET}, after you create the script, the container will automatically start the ruby httpd service."

	printf "%s\n" "${RED}Sorry,${GREEN}this feature${YELLOW} is still ${BLUE}in alpha${RESET}"
	press_enter_to_return
	${RETURN_TO_WHERE}
}
start_gui_menu() {
	start_gui_menu_en() {
		SELECTED_GNU_LINUX=$(whiptail --title "${DEBIAN_FOLDER_CAPITAL}" --menu "Do you want to start vnc or x11?" 0 50 0 \
			"1" "üêØ startvnc(tiger/tight)" \
			"2" "‚öíÔ∏è startxsdl" \
			"3" "üç¨ novnc(HTML5 VNC client)" \
			"4" "‚öîÔ∏è startx11vnc" \
			"5" "alpha:tightvnc" \
			"6" "alpha:tigervnc" \
			"0" "üåö Return to previous menu" \
			3>&1 1>&2 2>&3)
	}
	start_gui_menu_cn() {
		SELECTED_GNU_LINUX=$(whiptail --title "${DEBIAN_FOLDER_CAPITAL}" --menu "ÊòØÂê¶ÈúÄË¶ÅÂêØÂä®ËøúÁ®ãÊ°åÈù¢Ôºü" 0 50 0 \
			"1" "üêØ startvnc:ÂêØÂä®tiger/tightvnc" \
			"2" "‚öíÔ∏è startxsdl:ÂêØÂä®xsdl/VcXsrv" \
			"3" "üç¨ novnc:Âú®ÊµèËßàÂô®ÈáåËøûÊé•vnc" \
			"4" "‚öîÔ∏è startx11vnc:ÂêØÂä®x11vnc" \
			"5" "alphaÂÜÖÊµã:tightvnc" \
			"6" "alphaÂÜÖÊµã:tigervnc" \
			"0" "üåö back ËøîÂõû‰∏äÁ∫ßËèúÂçï" \
			3>&1 1>&2 2>&3)
	}
	start_gui_menu_de() {
		SELECTED_GNU_LINUX=$(whiptail --title "${DEBIAN_FOLDER_CAPITAL}" --menu "Do you want to start vnc or x11?" 0 50 0 \
			"1" "üêØ startvnc(tiger/tight)" \
			"2" "‚öíÔ∏è startxsdl" \
			"3" "üç¨ novnc(HTML5 VNC client)" \
			"4" "‚öîÔ∏è startx11vnc" \
			"5" "alpha:tightvnc" \
			"6" "alpha:tigervnc" \
			"0" "üåö zur√ºck" \
			3>&1 1>&2 2>&3)
	}
	case ${TMOE_MENU_LANG} in
	zh_*UTF-8) start_gui_menu_cn ;;
	de_DE.UTF-8) start_gui_menu_de ;; #Deutsche
	*) start_gui_menu_en ;;
	esac
	##############################
	case "${SELECTED_GNU_LINUX}" in
	0 | "") ${RETURN_TO_WHERE} ;;
	1) start_gnu_linux_distro_tigervnc ;;
	2) start_gnu_linux_distro_x ;;
	3) install_web_novnc ;;
	4) start_gnu_linux_distro_x11vnc ;;
	5 | 6)
		printf "%s\n" "${RED}Sorry,${GREEN}this feature${YELLOW} is still ${BLUE}in alpha${RESET}"
		press_enter_to_return
		start_gui_menu
		;;
	esac
}
##################
edit_container_startup_script() {
	for i in editor vim nano vi; do
		if [ $(command -v ${i}) ]; then
			${TMOE_PREFIX} ${i} ${DEBIAN_CHROOT}/usr/local/etc/tmoe-linux/container/tmoe-linux-container
			break
		fi
	done
}
#####################
create_a_new_container() {
	unset NEW_DISTRO_CODE
	TARGET=$(whiptail --inputbox "Please type the container name." 9 50 --title "CONTAINER NAME" 3>&1 1>&2 2>&3)
	NEW_DISTRO_CODE="$(printf '%s\n' "${TARGET}" | head -n 1 | cut -d ' ' -f 1)"
	if [ -z "${NEW_DISTRO_CODE}" ]; then
		printf "%s\n" "Sorry,the value is empty."
		press_enter_to_return
		proot_management_menu
	fi
	DISTRO_NAME_01=$(printf '%s\n' "${TMOE_LINUX_CONTAINER_DISTRO}" | awk -F '-' '{print $1}')
	DISTRO_CODE_01=$(printf '%s\n' "${NEW_DISTRO_CODE}" | awk '{print $1}')
	TMOE_LINUX_CONTAINER_DISTRO="${DISTRO_NAME_01}-${DISTRO_CODE_01}"
	create_container_edition_txt
	normally_start_gnu_linux_distro
}
#####################
#EXEC_LSOF=$(sed -n p ${LSOF_TEMP_FILE})
check_tmoe_container_pid() {
	LIST_OPEN_FILES_COUNTS=$(awk '{print $1}' ${LSOF_TEMP_FILE} | grep -c '^lsof')
	case ${LIST_OPEN_FILES_COUNTS} in
	0)
		LIST_OPEN_FILES=$(grep "${DEBIAN_CHROOT%/}" ${LSOF_TEMP_FILE} | awk '{print $1}' | uniq)
		KILL_PID=$(printf "%s\n" "${LIST_OPEN_FILES}" | sed "s@^@pkill -9 @g")
		;;
	*)
		LIST_OPEN_FILES=$(grep "${DEBIAN_CHROOT%/}" ${LSOF_TEMP_FILE} | awk '{print $2}' | uniq)
		KILL_PID=$(printf "%s\n" "${LIST_OPEN_FILES}" | sed "s@^@kill -9 @g")
		;;
	esac
	PROCESS_ID_AND_NAME=$(grep "${DEBIAN_CHROOT%/}" ${LSOF_TEMP_FILE} | awk '{print $2,$1}' | uniq)

	printf "${PURPLE}"
	cat <<-EOF
		${PROCESS_ID_AND_NAME}
	EOF
	printf "${RESET}"
	printf '%s\n' '--------------------'
	case ${LIST_OPEN_FILES} in
	"") ;;
	*) printf "%s\n" "${KILL_PID}" ;;
	esac
}
##################
tips_of_check_pid() {
	printf "${GREEN}%s ${YELLOW}%s${RESET}\n" "DETECTING" "PROCESS ID ..."
	printf "${BLOD}${YELLOW}%s${RESET}\n" "Ê≠£Âú®Ê£ÄÊµã${DEBIAN_FOLDER}ËøêË°å‰∏≠ÁöÑËøõÁ®ãÔºö"
	LSOF_TEMP_FILE="${TMPDIR}/.lsof.tmp"
	[[ ! -e ${LSOF_TEMP_FILE} ]] || rm -f ${LSOF_TEMP_FILE}
	[[ ! -e ${LSOF_TEMP_FILE}.02 ]] || rm -f ${LSOF_TEMP_FILE}.02
}
##########
tips_of_kill_pid() {
	printf "${RED}%s ${BLUE}%s${RESET}\n" "${PROCESS_ID_AND_NAME}" | sed "s@^@Killed @g"
	printf "${BOLD}${YELLOW}%s\n" "All processes have been killed."
	printf "%s\n" "Â∑≤${RED}ÁªàÊ≠¢${BLUE}${DEBIAN_FOLDER}${RESET}ÂÆπÂô®ËøõÁ®ã"
	[[ ! -e ${LSOF_TEMP_FILE} ]] || rm -f ${LSOF_TEMP_FILE}
}
##########
kill_chroot_container_process() {
	case ${SYSTEMD_NSPAWN} in
	true) machinectl terminate ${MACHINE_NAME} ;;
	esac
	#if [ -e "${DEBIAN_CHROOT}/run/dbus/pid" ]; then
	#	DBUS_PID="$(sed -n p ${DEBIAN_CHROOT}/run/dbus/pid)"
	#	su -c "kill -9 ${DBUS_PID} 2>/dev/null"
	#fi

	#for i in /run/dbus/pid /tmp/.X1-lock /tmp/.X11-unix/X1; do
	#	if [ -e "${DEBIAN_CHROOT}${i}" ]; then
	#		sudo rm -vf ${DEBIAN_CHROOT}${i}
	#	fi
	#done
	tips_of_check_pid
	#EXEC_LSOF=$(su -c "lsof")
	su -c "lsof ${DEBIAN_CHROOT%/}" >${LSOF_TEMP_FILE}.02
	if [[ $(command -v batcat) ]]; then
		batcat -ppn -l ruby ${LSOF_TEMP_FILE}.02
	elif [[ $(command -v bat) ]]; then
		bat -ppn -l ruby ${LSOF_TEMP_FILE}.02
	else
		cat ${LSOF_TEMP_FILE}.02
	fi

	LIST_OPEN_FILES_02=$(awk '{print $2}' ${LSOF_TEMP_FILE}.02 | sed 1d | uniq)
	KILL_PID_02=$(printf "%s\n" "${LIST_OPEN_FILES_02}" | sed "s@^@${GREEN}sudo ${RED}kill -9${BLUE} @g")
	if [[ -n ${LIST_OPEN_FILES_02} ]]; then
		case ${TMOE_MENU_LANG} in
		zh_*UTF-8) printf "%s\n" "Ëã•Êó†Ê≥ï${RED}ÁªàÊ≠¢${RESET}${BLUE}ÂÆπÂô®ËøõÁ®ã${RESET}ÔºåÂàôËØ∑${PURPLE}ÊâãÂä®ÊâßË°å${RESET}‰ª•‰∏ã${GREEN}sudo${RESET}ÂºÄÂ§¥ÁöÑÂëΩ‰ª§„ÄÇ" ;;
		esac
		printf "%s\n" "If you can not ${RED}kill${RESET} these ${BLUE}processes${RESET},try running ${GREEN}the following commands.${RESET}"
		printf "%s\n" "${GREEN}${KILL_PID_02}${RESET}"
	fi
	#Ê≠§Â§ÑÊâßË°åbash -c "${KILL_PID_02}"‰ºöÂØºËá¥tmoe-managerÈÄÄÂá∫„ÄÇ

	su -c "lsof" >${LSOF_TEMP_FILE}
	check_tmoe_container_pid
	su -c "${KILL_PID}"
	#ÂøÖÈ°ªÂú®killÊéâËøõÁ®ãÂêéÂÜçumount
	source ${TMOE_SHARE_DIR}/removal/umount
	tips_of_kill_pid
}
kill_proot_container_process() {
	tips_of_check_pid
	#EXEC_LSOF=$(lsof 2>/dev/null)
	lsof 2>/dev/null >${LSOF_TEMP_FILE}
	check_tmoe_container_pid
	bash -c "${KILL_PID}"
	tips_of_kill_pid
}
################
kill_container_process() {
	#printf "%s\n" "Sorry,Áî±‰∫éÊú¨ÂäüËÉΩÂú®Ë∞ÉËØï‰∏≠Âá∫Áé∞bugÔºåÂõ†Ê¨°Êó†Ê≥ïÂáÜÁ°ÆÂú∞Ê£ÄÊµãÂÆπÂô®ËøõÁ®ã„ÄÇ"
	#printf "%s\n" "Please look forward to the stable version tomorrow."
	case ${TMOE_CHROOT} in
	true) kill_chroot_container_process ;;
	*) kill_proot_container_process ;;
	esac
}
##############
readme_of_gnu_linux_distro() {
	LONG_DISTRO_NAME=$(printf '%s\n' "${TMOE_LINUX_CONTAINER_DISTRO}" | awk -F '-' '{print $1}')
	LONG_DISTRO_CODE=$(printf '%s\n' "${TMOE_LINUX_CONTAINER_DISTRO}" | awk -F '-' '{print $2}')
	[[ ! $(printf '%s\n' "${TMOE_LINUX_CONTAINER_DISTRO}" | awk -F '-' '{print $3}') = Stream ]] || LONG_DISTRO_CODE=$(printf '%s\n' "${TMOE_LINUX_CONTAINER_DISTRO}" | awk -F '-' '{print $2"-"$3}')
	case ${LONG_DISTRO_NAME} in
	arch) SHORT_DISTRO_NAME='a' ;;
	alpine) SHORT_DISTRO_NAME='ap' ;;
	armbian) SHORT_DISTRO_NAME='arm' ;;
	centos) SHORT_DISTRO_NAME='c' ;;
	debian) SHORT_DISTRO_NAME='d' ;;
	fedora) SHORT_DISTRO_NAME='f' ;;
	funtoo) SHORT_DISTRO_NAME='ft' ;;
	gentoo) SHORT_DISTRO_NAME='g' ;;
	kali) SHORT_DISTRO_NAME='k' ;;
	mint) SHORT_DISTRO_NAME='mi' ;;
	manjaro) SHORT_DISTRO_NAME='m' ;;
	opensuse) SHORT_DISTRO_NAME='o' ;;
	openwrt) SHORT_DISTRO_NAME='ow' ;;
	raspbios) SHORT_DISTRO_NAME='r' ;;
	slackware) SHORT_DISTRO_NAME='s' ;;
	ubuntu) SHORT_DISTRO_NAME='u' ;;
	void) SHORT_DISTRO_NAME='v' ;;
	*) SHORT_DISTRO_NAME=${LONG_DISTRO_NAME} ;;
	esac
	case ${TMOE_CHROOT} in
	true) SHORT_VIRT_TYPE='c' ;;
	*) SHORT_VIRT_TYPE='p' ;;
	esac
	case "${LONG_DISTRO_CODE}" in
	alpine) SHORT_DISTRO_CODE='ap' ;;
	focal) SHORT_DISTRO_CODE='20.04' ;;
	groovy) SHORT_DISTRO_CODE='20.10' ;;
	sid) SHORT_DISTRO_CODE='s' ;;
	bionic) SHORT_DISTRO_CODE='18.04' ;;
	rolling) SHORT_DISTRO_CODE='r' ;;
	zsh) SHORT_DISTRO_CODE='z' ;;
	8-Stream) SHORT_DISTRO_CODE='8s' ;;
	9-Stream) SHORT_DISTRO_CODE='9s' ;;
	"") SHORT_DISTRO_CODE="" ;;
	*) SHORT_DISTRO_CODE=${LONG_DISTRO_CODE} ;;
	esac
	case ${ARCH_TYPE} in
	amd64) SHORT_ARCH='x' ;;
	arm64) SHORT_ARCH='a' ;;
	armhf) SHORT_ARCH='h' ;;
	armel) SHORT_ARCH='armel' ;;
	i386) SHORT_ARCH='i' ;;
	ppc*) SHORT_ARCH='p' ;;
	s390*) SHORT_ARCH='s390' ;;
	mips64el) SHORT_ARCH='m64' ;;
	mipsel) SHORT_ARCH='m' ;;
	risc*) SHORT_ARCH='risc' ;;
	esac
	if [ "$(ls ${DEBIAN_CHROOT}/usr/local/etc/tmoe-linux/docs/README.* 2>/dev/null)" ]; then
		for i in ${DEBIAN_CHROOT}/usr/local/etc/tmoe-linux/docs/README.*; do
			if [ $(command -v bat) ]; then
				bat -ppn ${i}
			elif [ $(command -v batcat) ]; then
				batcat -ppn ${i}
			else
				cat ${i}
			fi
			break
		done
	fi
	cat <<-EOF
		${BOLD}${YELLOW}LIST INSTALLED CONTAINERS:${RESET} ${BLUE}tmoe ls${RESET}, if you are using tmoe-zsh, just type ${GREEN}t ls${RESET}
		${BOLD}${YELLOW}Start the default container:${RESET} ${BLUE}tmoe ${SHORT_VIRT_TYPE}${RESET}
		${BOLD}${YELLOW}Full command:${RESET} ${PURPLE}tmoe ${CONTAINER_TYPE} ${LONG_DISTRO_NAME} ${LONG_DISTRO_CODE} ${ARCH_TYPE}${RESET}
		${BOLD}${YELLOW}Simplified command:${RESET}  ${BLUE}tmoe ${SHORT_VIRT_TYPE} ${SHORT_DISTRO_NAME} ${SHORT_DISTRO_CODE} ${SHORT_ARCH}${RESET}
		${BOLD}${YELLOW}Start ${DEBIAN_FOLDER} + tigervnc server:${RESET} ${GREEN}tmoe ${SHORT_VIRT_TYPE} ${SHORT_DISTRO_NAME} ${SHORT_DISTRO_CODE} ${SHORT_ARCH} v${RESET}
		${BOLD}${YELLOW}Start ${DEBIAN_FOLDER} + x11vnc server:${RESET} ${GREEN}tmoe ${SHORT_VIRT_TYPE} ${SHORT_DISTRO_NAME} ${SHORT_DISTRO_CODE} ${SHORT_ARCH} x11${RESET}
		${BOLD}${YELLOW}Start ${DEBIAN_FOLDER} + X server:${RESET} ${GREEN}tmoe ${SHORT_VIRT_TYPE} ${SHORT_DISTRO_NAME} ${SHORT_DISTRO_CODE} ${SHORT_ARCH} xs${RESET}
		The default ${YELLOW}login shell${RESET} is ${GREEN}zsh${RESET}, if you want to start ${BLUE}bash${RESET},then type ${GREEN}tmoe ${SHORT_VIRT_TYPE} ${SHORT_DISTRO_NAME} ${SHORT_DISTRO_CODE} ${SHORT_ARCH} bash${RESET}
		Start ${BLUE}ash${RESET} as a login shellÔºö  ${GREEN}tmoe ${SHORT_VIRT_TYPE} ${SHORT_DISTRO_NAME} ${SHORT_DISTRO_CODE} ${SHORT_ARCH} ash${RESET} 
		--------------------
		ÂàóÂá∫ÂΩìÂâçÂ∑≤ÂÆâË£ÖÁöÑÂÆπÂô®:${BLUE}tmoe ls${RESET}
		ÂêØÂä®ÈªòËÆ§${CONTAINER_TYPE}ÂÆπÂô®:${BLUE}tmoe ${SHORT_VIRT_TYPE}${RESET},Ëã•ÊÇ®ÁöÑÂÆø‰∏ªshellÁéØÂ¢É‰∏∫tmoe-zsh,ÂàôÂèØÁÆÄÂåñ‰∏∫${GREEN}t ${SHORT_VIRT_TYPE}${RESET}
		ÂêØÂä®${DEBIAN_FOLDER}ÁöÑÂÆåÊï¥ÂëΩ‰ª§‰∏∫ ${PURPLE}tmoe ${CONTAINER_TYPE} ${LONG_DISTRO_NAME} ${LONG_DISTRO_CODE} ${ARCH_TYPE}${RESET}
		Ëã•ÊÇ®Êú™ÈÄâÊã©Ë∑®Êû∂ÊûÑËøêË°åÔºåÂàôÂèØÂéªÈô§${PURPLE}${ARCH_TYPE}${RESET}ÂèÇÊï∞„ÄÇ
		Á≤æÁÆÄÂëΩ‰ª§‰∏∫  ${BLUE}tmoe ${SHORT_VIRT_TYPE} ${SHORT_DISTRO_NAME} ${SHORT_DISTRO_CODE} ${SHORT_ARCH}${RESET}
		Ëã•ÊÇ®‰ΩøÁî®ÁöÑÊòØtmoe-zshÈÖçÁΩÆÁöÑÁéØÂ¢ÉÔºåÂàôÂèØ‰ª•Ëøõ‰∏ÄÊ≠•ÁÆÄÂåñ‰∏∫ ${YELLOW}t ${SHORT_VIRT_TYPE} ${SHORT_DISTRO_NAME} ${SHORT_DISTRO_CODE} ${SHORT_ARCH}${RESET}
		ÂêåÊó∂ÂêØÂä®${BLUE}${DEBIAN_FOLDER}${RESET}ÂÆπÂô®+${YELLOW}tigervnc server${RESET}ÁöÑÂëΩ‰ª§‰∏∫  ${GREEN}tmoe ${SHORT_VIRT_TYPE} ${SHORT_DISTRO_NAME} ${SHORT_DISTRO_CODE} ${SHORT_ARCH} v${RESET}
		ÂêåÊó∂ÂêØÂä®${BLUE}${DEBIAN_FOLDER}${RESET}ÂÆπÂô®+${YELLOW}x11vnc server${RESET}ÁöÑÂëΩ‰ª§‰∏∫  ${GREEN}tmoe ${SHORT_VIRT_TYPE} ${SHORT_DISTRO_NAME} ${SHORT_DISTRO_CODE} ${SHORT_ARCH} x11${RESET}
		ÂêåÊó∂ÂêØÂä®${BLUE}${DEBIAN_FOLDER}${RESET}ÂÆπÂô®+${YELLOW}XSDL/VcXsrv${RESET}ÁöÑÂëΩ‰ª§‰∏∫  ${GREEN}tmoe ${SHORT_VIRT_TYPE} ${SHORT_DISTRO_NAME} ${SHORT_DISTRO_CODE} ${SHORT_ARCH} xs${RESET}
		ÂÆπÂô®ÁöÑÈªòËÆ§${YELLOW}ÁôªÂΩïSHELL${RESET}‰∏∫${GREEN}zsh${RESET},Ëã•ÊÇ®ÈúÄË¶Å‰ΩøÁî®ÂÖ∂ÂÆÉ${YELLOW}shell${RESET}ÔºåÂàôËØ∑‰ΩøÁî®‰ª•‰∏ãÂëΩ‰ª§
		‰∏¥Êó∂‰ΩøÁî®${GREEN}bash${RESET}‰Ωú‰∏∫${YELLOW}ÁôªÂΩïSHELL${RESET}Ôºö  ${GREEN}tmoe ${SHORT_VIRT_TYPE} ${SHORT_DISTRO_NAME} ${SHORT_DISTRO_CODE} ${SHORT_ARCH} bash${RESET}  
		‰∏¥Êó∂‰ΩøÁî®${GREEN}ash${RESET}‰Ωú‰∏∫${YELLOW}ÁôªÂΩïSHELL${RESET}Ôºö  ${GREEN}tmoe ${SHORT_VIRT_TYPE} ${SHORT_DISTRO_NAME} ${SHORT_DISTRO_CODE} ${SHORT_ARCH} ash${RESET} 
		--------------------
		${BOLD}È¢ùÂ§ñÊãìÂ±ïÂäüËÉΩ${RESET}
		${YELLOW}ÔºàË°•ÂÖ®ÂäüËÉΩÔºâ${RESET}ËØ¥Êòé${RESET}
		${YELLOW}shellÁéØÂ¢ÉË¶ÅÊ±Ç${RESET}Ôºö${GREEN}zsh${RESET}
		The completion function exists separately as a zsh plugin, so bash and other shells are not supported.
		‰ªÖÊîØÊåÅ${GREEN}zsh${RESET},${RED}‰∏çÊîØÊåÅ${RESET}${PURPLE}bash${RESET}

		tmoe-zsh‰ºöËá™Âä®Âä†ËΩΩtmoeË°•ÂÖ®Êèí‰ª∂ÔºåÂÖ∂‰ªñÊèí‰ª∂ÁÆ°ÁêÜÂô®ÈúÄË¶ÅÊâãÂä®Âä†ËΩΩ„ÄÇ
		zinitÊèí‰ª∂ÁÆ°ÁêÜÂô®ÈÖçÁΩÆË°•ÂÖ®Êèí‰ª∂Ôºö${GREEN}
		[[ \$(egrep '^[^#]*zinit.*completion/_tmoe' ${HOME}/.zshrc) ]] || sed -i '$ a\zinit ice lucid wait=1 as"completion" && zinit snippet ${TMOE_SHARE_DIR}/completion/_tmoe' ${HOME}/.zshrc
		${RESET}
		Ëá≥‰∫éÂÖ∂‰ªñÊèí‰ª∂ÁÆ°ÁêÜÂô®Ôºå‰æãÂ¶Çoh-my-zshÔºåÂõ†ÂºÄÂèëËÄÖÂπ∂Êú™ËøõË°åÊµãËØïÔºåÊïÖËØ∑Ëá™Ë°åÂä†ËΩΩÊèí‰ª∂„ÄÇ
		${BOLD}${YELLOW}TIPS OF TMOE COMPLETION PLUGIN${RESET}${RESET}
		  1.Âú®TMOE-ZSHÈÖçÁΩÆÁöÑÁéØÂ¢É‰∏ã,Ëæì${YELLOW}t${RESET},Êåâ‰∏ãÁ©∫Ê†º,ÂÜçÊåâ‰∏ãTABÈîÆ${BLUE}‚áÑ${RESET}ËøõË°åË°•ÂÖ®ÔºåËæì${GREEN}/${RESET}ËøõË°åËøûÁª≠Ë°•ÂÖ®ÔºåÂú®ËØ•Ê®°Âºè‰∏ãÊîØÊåÅÊêúÁ¥¢ÂèëË°åÁâàÂêçÁß∞„ÄÇ
		  2.Âú®ÂÖ∂‰ªñÊèí‰ª∂ÁÆ°ÁêÜÂô®ÈÖçÁΩÆÁöÑÁéØÂ¢É‰∏ãÔºåËæìÂÖ•${YELLOW}tmoe${RESET},‰∏çÊåâÂõûËΩ¶,Êåâ‰∏ãTABÈîÆ${BLUE}‚áÑ${RESET}ËøõË°åË°•ÂÖ®.
		  Type ${GREEN}tmoe${RESET}, then don't press ${RED}enter${RESET}, press Tab${BLUE}‚áÑ${RESET} key to complete.
	EOF
	case ${SYSTEMD_NSPAWN} in
	true)
		cat <<-EOF
			Ê£ÄÊµãÂà∞ÊÇ®ÈÄâÊã©ÁöÑsystemd-nspawnÂÆπÂô®ÔºåÂú®ËøõÂÖ•ÂÆπÂô®ÂêéÔºåÊåâ‰∏ã${GREEN}Ctrl${RESET}+‰∏âÊ¨°${YELLOW}]]]${RED}ÈÄÄÂá∫${RESET}„ÄÇ
			ÊÇ®ÂèØ‰ª•‰ΩøÁî®${GREEN}machinectl${RESET}Êù•ÁÆ°ÁêÜnspawnÂÆπÂô®„ÄÇ
			${GREEN}machinectl -h${RESET} Ëé∑ÂèñÂ∏ÆÂä©‰ø°ÊÅØ get help info
			${GREEN}machinectl list${RESET} ÂàóÂá∫ÂÆπÂô®
			${GREEN}machinectl terminate ${DEBIAN_FOLDER}-${ARCH_TYPE}${RESET} ÁªàÊ≠¢ÂÆπÂô®
		EOF
		;;
	esac
}
######
if_container_is_not_installed() {
	[[ -e ${DEBIAN_CHROOT} ]] || install_new_tmoe_gnu_linux_distro
	case ${DEB_BOOT_STRAP} in
	true) install_new_tmoe_gnu_linux_distro ;;
	esac
}
git_pull_tmoe_linux() {
	cd ${TMOE_GIT_DIR}
	git reset --hard origin/master
	git pull --rebase --stat origin master --allow-unrelated-histories || git rebase --skip
	cd ${CURRENT_DIR}

}
normally_start_gnu_linux_distro() {
	source ${CONFIG_FOLDER}/hitokoto.conf
	case ${TMOE_CONTAINER_FORTUNE} in
	true)
		if [ $(command -v fortune) ]; then
			fortune 2>/dev/null
		elif [ -e /usr/games/fortune ]; then
			/usr/games/fortune 2>/dev/null
		fi
		;;
	esac
	case ${TMOE_CONTAINER_HITOKOTO} in
	true) [[ ! ${TMOE_LANG} =~ zh_.*UTF-8 ]] || get_hitokito_cn ;;
	esac
	if_container_is_not_installed
	cat_release_file
	case $(uname -o) in
	Android)
		[[ ! $(command -v termux-wake-unlock) ]] || termux-wake-lock 2>/dev/null
		;;
	esac

	if [[ $(command -v pulseaudio) && $(id -u) != 0 ]]; then
		pulseaudio --start
	fi
	case ${SYSTEMD_NSPAWN} in
	true)
		source ${TMOE_SHARE_DIR}/removal/umount
		source ${TMOE_SHARE_DIR}/container/nspawn/startup
		;;
	*) ${TMOE_PREFIX} bash ${DEBIAN_CHROOT}/usr/local/etc/tmoe-linux/container/tmoe-linux-container ;;
	esac
	if [[ -e ${DEBIAN_CHROOT} ]]; then
		press_enter_to_return
		proot_management_menu
	fi
}
start_gnu_linux_distro_tigervnc() {
	[[ ! $(command -v am) ]] || am start -n com.realvnc.viewer.android/com.realvnc.viewer.android.app.ConnectionChooserActivity 2>/dev/null
	${TMOE_PREFIX} touch ${DEBIAN_CHROOT}/root/.vnc/startvnc
	normally_start_gnu_linux_distro
}
start_gnu_linux_distro_x11vnc() {
	[[ ! $(command -v am) ]] || am start -n com.realvnc.viewer.android/com.realvnc.viewer.android.app.ConnectionChooserActivity 2>/dev/null
	${TMOE_PREFIX} touch ${DEBIAN_CHROOT}/root/.vnc/startx11vnc
	normally_start_gnu_linux_distro
}
start_gnu_linux_distro_x() {
	[[ ! $(command -v am) ]] || am start -n x.org.server/x.org.server.MainActivity 2>/dev/null
	sleep 3
	${TMOE_PREFIX} touch ${DEBIAN_CHROOT}/root/.vnc/startxsdl
	normally_start_gnu_linux_distro
}
install_web_novnc() {
	#source ${TMOE_SHARE_DIR}/app/novnc
	NOVNC_PORT=$(grep '^NOVNC_PORT=' ${DEBIAN_CHROOT}/usr/local/bin/novnc | head -n 1 | awk -F '=' '{print $2}' | cut -d '"' -f 2)
	[[ -n ${NOVNC_PORT} ]] || NOVNC_PORT=36080
	NOVNC_ADDR="http://localhost:${NOVNC_PORT}/vnc.html"
	printf "${YELLOW}%s${RESET}\n" "${NOVNC_ADDR}"
	if [[ $(command -v am) ]]; then
		am start -a android.intent.action.VIEW -d "${NOVNC_ADDR}" 2>/dev/null
	elif [[ $(command -v xdg-open) ]]; then
		xdg-open ${NOVNC_ADDR} 2>/dev/null
	elif [[ -e /mnt/c/WINDOWS/system32/cmd.exe ]]; then
		/mnt/c/WINDOWS/system32/cmd.exe /c "start ${NOVNC_ADDR}"
	fi
	${TMOE_PREFIX} touch ${DEBIAN_CHROOT}/root/.vnc/novnc
	normally_start_gnu_linux_distro
}
install_new_tmoe_gnu_linux_distro() {
	check_tmoe_completion_version
	check_tmoe_completion
	#git_pull_tmoe_linux
	###
	case ${WEEKLY_BUILD_CONTAINER} in
	true) install_weekly_build_container ;;
	*)
		case ${ARCH_TYPE} in
		mips* | risc*) ;;
		*)
			case ${DISTRO_NAME} in
			debian) check_debian_distro_code ;;
			ubuntu) check_ubuntu_distro_code ;;
			kali) install_kali_rolling_gnu_linux_distro ;;
			arch) install_arch_linux_distro ;;
			esac
			;;
		esac
		;;
	esac
}
##########
bat_build_latest_txt() {
	if [[ -e ${BUILD_LATEST_TXT} ]]; then
		if [[ $(command -v bat) ]]; then
			bat -ppn -l sh ${BUILD_LATEST_TXT}
		elif [[ $(command -v batcat) ]]; then
			batcat -ppn -l sh ${BUILD_LATEST_TXT}
		else
			cat ${BUILD_LATEST_TXT}
		fi
		printf "${BLUE}-----------------------------------------${RESET}\n"
	fi
}
bat_build_latest02_txt() {
	BUILD_LATEST_TXT=${CONFIG_FOLDER}/build-latest02.txt
	bat_build_latest_txt
}
bat_build_latest01_txt() {
	BUILD_LATEST_TXT=${CONFIG_FOLDER}/build-latest01.txt
	bat_build_latest_txt
}
install_weekly_build_container() {
	NODE_NAME='node01-azure'
	case ${NODE02_ENABLED} in
	true)
		if (whiptail --title "NETWORK NODE" --yes-button 'node01-azure' --no-button 'node02-tmoe' --yesno "Please choose a network node\nËØ∑ÈÄâÊã©ÁΩëÁªúËäÇÁÇπ" 8 50); then
			NODE_URL="${NODE01_URL}"
		else
			NODE_NAME='node02-tmoe'
			NODE_URL="${NODE02_URL}"
		fi
		;;
	*) NODE_URL="${NODE01_URL}" ;;
	esac

	if [ "$(ls ${TMOE_SHARE_DIR}/docker-build/${ARCH_TYPE}/${DISTRO_NAME_02}/README.* 2>/dev/null)" ]; then
		for i in ${TMOE_SHARE_DIR}/docker-build/${ARCH_TYPE}/${DISTRO_NAME_02}/README.*; do
			if [ $(command -v bat) ]; then
				bat -ppn ${i}
			elif [ $(command -v batcat) ]; then
				batcat -ppn ${i}
			else
				cat ${i}
			fi
			break
		done
	fi
	case ${TMOE_LANG} in
	zh_*UTF-8) printf "%s\n" "Êú¨ÂÆπÂô®‰ΩøÁî®‰ª•‰∏ãDockerfileËøõË°åÊûÑÂª∫„ÄÇ" ;;
	esac
	printf "%s\n" "${BOLD}${YELLOW}Dockerfile:${RESET}"
	DOCKERFILE="${TMOE_SHARE_DIR}/docker-build/${ARCH_TYPE}/${DISTRO_NAME_02}/${DESKTOP}/Dockerfile"
	printf "%s\n" "${BLUE}${DOCKERFILE}${RESET}"
	if [ $(command -v bat) ]; then
		bat -ppn "${DOCKERFILE}"
	else
		cat "${DOCKERFILE}"
	fi
	for i in ${CONFIG_FOLDER}/build-latest02.txt ${CONFIG_FOLDER}/build-latest01.txt; do
		if [[ -e ${i} ]]; then
			rm -f ${i}
		fi
	done
	BUILD_TXT="${ARCH_TYPE}/${DISTRO_NAME_02}/${DESKTOP}/build.txt"
	case ${TMOE_LANG} in
	zh_*UTF-8) printf "%s\n" "Ê≠£Âú®Ëé∑ÂèñÁâàÊú¨‰ø°ÊÅØ..." ;;
	esac
	printf "%s\n" "Getting ${DEBIAN_FOLDER} version info..."
	ROOTFS_VERSION='latest02'

	case ${NODE_NAME} in
	node02-tmoe)
		aria2c --console-log-level=error --no-conf --allow-overwrite=true --http-user=${NODE02_USER} --http-passwd=${NODE02_PW} -d ${CONFIG_FOLDER} -o build-latest02.txt ${NODE_URL}/latest02/${BUILD_TXT}
		bat_build_latest02_txt
		;;
	*)
		aria2c --console-log-level=error --no-conf --allow-overwrite=true -d ${CONFIG_FOLDER} -o build-latest02.txt ${NODE_URL}/latest02/${BUILD_TXT}
		bat_build_latest02_txt
		aria2c --console-log-level=error --no-conf --allow-overwrite=true -d ${CONFIG_FOLDER} -o build-latest01.txt ${NODE_URL}/latest01/${BUILD_TXT}
		if grep -q 'DOCTYPE html' ${CONFIG_FOLDER}/build-latest01.txt; then
			rm -f ${CONFIG_FOLDER}/build-latest01.txt
		elif ! grep -q 'STATUS=completed' ${CONFIG_FOLDER}/build-latest01.txt; then
			ROOTFS_VERSION='latest02'
		elif ! grep -q 'STATUS=completed' ${CONFIG_FOLDER}/build-latest02.txt; then
			ROOTFS_VERSION='latest01'
		else
			LATEST_01_DATE="$(grep 'BUILD_DATE=' ${CONFIG_FOLDER}/build-latest01.txt | awk -F'=' '{print $2}')"
			LATEST_02_DATE="$(grep 'BUILD_DATE=' ${CONFIG_FOLDER}/build-latest02.txt | awk -F'=' '{print $2}')"
			LATEST_01_TIME="$(date -d $(grep 'END_TIME=' ${CONFIG_FOLDER}/build-latest01.txt | awk -F'=' '{print $2}') +%s)"
			LATEST_02_TIME="$(date -d $(grep 'END_TIME=' ${CONFIG_FOLDER}/build-latest02.txt | awk -F'=' '{print $2}') +%s)"
			if ((${LATEST_02_DATE} < ${LATEST_01_DATE})); then
				ROOTFS_VERSION='latest01'
			elif ((${LATEST_02_DATE} > ${LATEST_01_DATE})); then
				ROOTFS_VERSION='latest02'
			elif ((${LATEST_02_TIME} < ${LATEST_01_TIME})); then
				ROOTFS_VERSION='latest01'
			else
				ROOTFS_VERSION='latest02'
			fi
		fi
		bat_build_latest01_txt
		;;
	esac
	ROOTFS_FILE="$(grep 'ROOTFS_FILE=' ${CONFIG_FOLDER}/build-${ROOTFS_VERSION}.txt | awk -F'=' '{print $2}')"
	printf "%s\n" "Do you want to download ${BLUE}${ROOTFS_FILE}${RESET}(${YELLOW}${ROOTFS_VERSION}${RESET})?"
	case ${ROOTFS_VERSION} in
	latest01) ROOTFS_VERSION_02='latest02' ;;
	latest02) ROOTFS_VERSION_02='latest01' ;;
	esac
	do_you_want_to_continue
	if [[ -s ${CONFIG_FOLDER}/build-latest01.txt ]]; then
		if grep -q 'STATUS=completed' ${CONFIG_FOLDER}/build-latest01.txt; then
			if (whiptail --title "VERSION" --yes-button "${ROOTFS_VERSION}" --no-button "${ROOTFS_VERSION_02}" --yesno "Please choose a version.\nÊúÄÊñ∞Áâà‰∏∫${ROOTFS_VERSION}" 8 50); then
				printf "%s\n" "${YELLOW}${ROOTFS_VERSION}${RESET}"
			else
				ROOTFS_VERSION=${ROOTFS_VERSION_02}
				printf "%s\n" "${PURPLE}${ROOTFS_VERSION}${RESET}"
			fi
		fi
	fi
	bash -c "$(sed -n p ${TMOE_SHARE_DIR}/container/install |
		sed "1a\WEEKLY_BUILD_CONTAINER=true" |
		sed "1a\DESKTOP=${DESKTOP}" |
		sed "1a\NODE_URL=${NODE_URL}" |
		sed "1a\NODE02_USER=${NODE02_USER}" |
		sed "1a\NODE02_PW=${NODE02_PW}" |
		sed "1a\ROOTFS_VERSION=${ROOTFS_VERSION}" |
		sed "1a\NODE_NAME=${NODE_NAME}" |
		sed "s@TMOE_ROOTFS_TAR_XZ=.*debian-sid_.*@TMOE_ROOTFS_TAR_XZ=${ROOTFS_FILE}@" |
		sed "s/debian system/${DISTRO_NAME} system/g" |
		sed "s@BFSU Open Source Mirror Station@${NODE_NAME}@" |
		sed "s:Debian GNU/Linux:${DISTRO_NAME} GNU/Linux:g")"
	#--http-user=${NODE02_USER} --http-passwd=${NODE02_PW}
	#		sed -E "s@(LINUX_CONTAINER_DISTRO_FILE)=.*@\1=\${CONFIG_FOLDER}/linux_container_distro_02.txt@" |
}
#############
umount_and_remove_gnu_linux_distro() {
	kill_container_process
	source ${TMOE_SHARE_DIR}/container/remove
}
du_sh_gnu_linux_distro() {
	case ${TMOE_CHROOT} in
	true)
		printf "%s\n" "Unmounting dirs ..."
		su -c "umount -lvf ${DEBIAN_CHROOT}/* 2>/dev/null"
		su -c "umount -lvf ${DEBIAN_CHROOT}/*/*  2>/dev/null"
		su -c "umount -lvf ${DEBIAN_CHROOT}  2>/dev/null"
		;;
	esac
	printf "%s\n" "Detecting the space occupied by ${BLUE}${DEBIAN_FOLDER}${RESET} ..."
	printf "%s\n" "Ê≠£Âú®Ê£ÄÊµã${BLUE}${DEBIAN_FOLDER}${RESET}Âç†Áî®Á©∫Èó¥Â§ßÂ∞è..."
	case ${TMOE_CHROOT} in
	true)
		if [ -e "${DEBIAN_CHROOT}" ]; then
			cd ${DEBIAN_CHROOT}
			${TMOE_PREFIX} du -sh * 2>/dev/null
			printf "%s\n" "${YELLOW}Ê≠£Âú®ÂàóÂá∫ÊéíË°åÊ¶ú...${RESET}"
			${TMOE_PREFIX} find ./ -type d \( -path="./proc" \
				-o -path="./root/sd" \
				-o -path="./root/tf" \
				-o -path="./root/termux" \
				-o -path="./media/sd" \
				-o -path="./media/termux" \
				-o -path="./media/tf" \
				-o -path="./sd" \
				-o -path="./tf" \
				-o -path="./dev" \
				-o -path="./sys" \
				-o -path="./system" \) -prune \
				-type f -print0 2>/dev/null |
				xargs -0 ${TMOE_PREFIX} du |
				sort -n |
				tail -10 |
				cut -f 2 |
				xargs -I{} ${TMOE_PREFIX} du -sh {}
		else
			printf "${RED}%s${RESET} ${BLUE}%s${RESET}\n" "You did not install" "${DEBIAN_FOLDER}"
		fi
		;;
	*)
		if [ -e "${DEBIAN_CHROOT}" ]; then
			cd ${DEBIAN_CHROOT}
			${TMOE_PREFIX} du -sh *
			printf "%s\n" "${YELLOW}Ê≠£Âú®ÂàóÂá∫TOP30...${RESET}"
			${TMOE_PREFIX} find ./ -type d \( -path="./proc" \
				-o -path="./root/sd" \
				-o -path="./root/tf" \
				-o -path="./root/termux" \
				-o -path="./media/sd" \
				-o -path="./media/termux" \
				-o -path="./media/tf" \
				-o -path="./sd" \
				-o -path="./tf" \
				-o -path="./dev" \
				-o -path="./sys" \
				-o -path="./system" \) -prune \
				-type f -print0 2>/dev/null |
				xargs -0 ${TMOE_PREFIX} du |
				sort -n |
				tail -30 |
				cut -f 2 |
				xargs -I{} ${TMOE_PREFIX} du -sh {}
		else
			printf "${RED}%s${RESET} ${BLUE}%s${RESET}\n" "You did not install" "${DEBIAN_FOLDER}"
		fi
		;;
	esac
}
######################
backup_tmoe_gnu_linux_distro() {
	if [[ ! -e ${DEBIAN_CHROOT} ]]; then
		cat <<-EOF
			ÊÇ®${RED}Â∞öÊú™ÂÆâË£Ö${RESET}${BLUE}${DEBIAN_FOLDER_CAPITAL}${RESET}ÂÆπÂô®
			ÊòØÂê¶‰ΩøÁî®ÊÅ¢Â§çÂÆπÂô®ÁöÑÈÄâÈ°πÔºü
		EOF
		do_you_want_to_continue
		source ${TMOE_SHARE_DIR}/compression/restore
		restore_gnu_linux_container
	else
		case ${TMOE_CHROOT} in
		true) source ${TMOE_SHARE_DIR}/removal/umount ;;
		esac
		source ${TMOE_SHARE_DIR}/compression/backup
	fi
}
#####################
proot_management_menu $@
