#!/usr/bin/env bash
#######################################
un_xz_debian_recovery_kit() {
	printf "$BLUE"
	cat <<-'EndOFneko'
		       DL.                           
		       QBBBBBKv:rr77ri:.             
		       gBBQdY7::::..::i7vv.          
		       UBd. . .:.........rBBBQBBBB5  
		       Pu  :..r......i:....BBBQBBB:  
		       ri.i:.j:...:. i7... uBBZrd:   
		 :     7.:7.7U.:..r: Yr:.. iQ1:qU    
		.Qi   .7.ii.X7:...L.:qr:...iB7ZQ     
		 .27. :r.r:L7i::.7r:vri:...rr  .     
		  v   ::.Yrviri:7v7v: ::...i.   i    
		      r:ir: r.iiiir..:7r...r   :P.2Y 
		      v:vi::.      :  ::. .qI7U1U :1 
		Qr    7.7.         :.i::. :Di:. i .v:
		v7..  s.r7.   ...   .:7i: rDi...r .. 
		 vi: .7.iDBBr  .r   .:.7. rPr:..r    
		 i   :virZBgi  :vrYJ1vYY .ruY:..i    
		     YrivEv. 7BBRBqj21I7 .77J:.:.PQ  
		    .1r:q.   rB52SKrj.:i i5isi.:i :.r
		    YvrY7    r.  . ru :: PIrj7.:r..v 
		   rSviYI..iuU .:.:i:.7.KPPiSr.:vr   
		  .u:Y:JQMSsJUv...   .rDE1P71:.7X7   
		  5  Ivr:QJ7JYvi....ir1dq vYv.7L.Y   
		  S  7Z  Qvr:.iK55SqS1PX  Xq7u2 :7   
		         .            i   7          
	EndOFneko
	printf "$RESET"
	printf "%s\n" "æ­£åœ¨è§£å‹${DOWNLOAD_FILE_NAME}ï¼Œdecompressing recovery package, please be patient."
	#pv "debian_2020-03-11_17-31.tar.xz" | tar -PpJx 2>/dev/null
	cat <<-EOF
		å°‘å¥³ç¥ˆç¦±ä¸­...
			${BOLD}Tmoe-linux å°æç¤º02${RESET}:

				è‹¥æ‚¨çš„å®¿ä¸»æœºä¸º${BOLD}Android${RESET}ç³»ç»Ÿ,åˆ™åœ¨termuxåŸç³»ç»Ÿä¸‹è¾“${GREEN}startvnc${RESET}å°†${RED}åŒæ—¶å¯åŠ¨${RESET}Androidç‰ˆRealvnc${YELLOW}å®¢æˆ·ç«¯${RESET}å’ŒGNU/Linuxçš„VNC${YELLOW}æœåŠ¡ç«¯${RESET}ã€‚
				-------------------
				è¾“${GREEN}debian${RESET}ä»…å¯åŠ¨${BLUE}GNU/Linuxå®¹å™¨${RESET}ï¼Œä¸ä¼šè‡ªåŠ¨å¯åŠ¨è¿œç¨‹æ¡Œé¢æœåŠ¡ã€‚
				-------------------
				æ‚¨å¯ä»¥åœ¨è§£å‹å®Œæˆä¹‹åè¾“${GREEN}startvnc${RESET}æ¥å¯åŠ¨${BLUE}tightæˆ–tigervncæœåŠ¡${RESET}ï¼Œè¾“${RED}stopvnc${RESET}åœæ­¢
				-------------------
				You can type ${GREEN}startvnc${RESET} to start ${BLUE}tight/tigervnc server${RESET},type ${RED}stopvnc${RESET} to stop it.
				-------------------
	EOF
	printf "%s\n" "æ­£åœ¨${GREEN}è§£å‹${RESET}ä¸­..."
	printf "%s\n" "å°‘å¥³ç¥ˆç¦±ä¸­..."
	if [ ! "$(command -v pv)" ] || [ "${TMOE_CHROOT}" = 'true' ]; then
		${TMOE_PREFIX} tar -PpJxvf ${DOWNLOAD_FILE_NAME}
	else
		pv ${DOWNLOAD_FILE_NAME} | tar -PpJx
	fi
	cd "{CURRENT_DIR}"
	printf '%s\n' 'The vnc server is about to start for you.'
	# The password you entered is hidden.'
	#printf '%s\n' 'å³å°†ä¸ºæ‚¨å¯åŠ¨vncæœåŠ¡ï¼Œæ‚¨éœ€è¦è¾“ä¸¤éï¼ˆä¸å¯è§çš„ï¼‰å¯†ç ã€‚'
	#printf "%s\n" "When prompted for a view-only password, it is recommended that you enter 'n'"
	#printf '%s\n' 'å¦‚æœæç¤ºview-only,é‚£ä¹ˆå»ºè®®æ‚¨è¾“n,é€‰æ‹©æƒåœ¨æ‚¨è‡ªå·±çš„æ‰‹ä¸Šã€‚'
	copy_tmoe_locale_file_to_container
	printf '%s\n' 'è¯·è¾“å…¥6è‡³8ä½çš„VNCå¯†ç '
	switch_termux_rootfs_to_linux
	check_proot_proc_permissions
	source ${PREFIX}/bin/startvnc
}
############################
switch_termux_rootfs_to_linux() {
	if [ "${LINUX_DISTRO}" != 'Android' ]; then
		cd /data/data/com.termux/files/usr/bin
		sed -i 's:#!/data/data/com.termux/files/usr/bin/env bash:#!/usr/bin/env bash:g' $(grep -rl 'com.termux' ./)
		#sed -i 's:#!/usr/bin/env bash:#!/usr/bin/env bash:' ${DEBIAN_CHROOT}/remove-debian.sh
		cp -pf ./* ${PREFIX}/bin/
	fi
}
install_debian_gnu_linux_distro_menu() {
	RETURN_TO_WHERE='install_debian_gnu_linux_distro_menu'
	DOWNLOAD_PATH="/sdcard/Download/backup"
	#DISTRO_CODE=''
	DISTRO_NAME='debian'
	DEB_BOOT_STRAP='false'
	LXC_IMAGES_REPO="https://mirrors.bfsu.edu.cn/lxc-images/images/${DISTRO_NAME}/"
	#\nStableç‰ˆæ›´åŠ ç¨³å®šä¸”bugè¾ƒå°‘,ä½†stableçš„è½¯ä»¶åŒ…è¾ƒæ—§,è€Œsidè¾ƒæ–°ã€‚\nBuster is more stable and has fewer bugs,\nbut the packages inside the buster software source are older.\nThe sid package is relatively new.
	DISTRO_CODE=""
	install_debian_gnu_linux_distro_menu_zh() {
		BETA_SYSTEM=$(
			whiptail --title "è¯·é€‰æ‹©æ‚¨éœ€è¦å®‰è£…çš„debian version" --menu "bullseyeä¸º2021~2023å¹´çš„stableç‰ˆ,sidæ°¸è¿œéƒ½ä¸ºunstable,sidçš„è½¯ä»¶åŒ…è¾ƒæ–°" 0 50 0 \
				"1" "ğŸ‘¦Sid(æ»šåŠ¨æ›´æ–°,éš”å£çš„ç”·å­©å¸­å¾·,ç©å…·ç»ˆç»“è€…)" \
				"2" "ğŸ11-bullseye(2021~2024,èƒ¡è¿ªéª‘çš„é©¬)" \
				"3" "ä½¿ç”¨debootstrapæ‰‹åŠ¨æ„å»º" \
				"4" "Custom codeæ‰‹åŠ¨è¾“å…¥ç‰ˆæœ¬ä»£å·" \
				"5" "ğŸ¶10-buster(2019~2022,å®‰å¼Ÿä¸€å®¶å…»çš„å°ç‹—)" \
				"6" "ğŸ“•ğŸ›12-bookworm(2023~2026,ä¹¦è™«--ç†ŠæŠ±å“¥çš„æ‰‹ä¸‹)" \
				"7" "ğŸ¦• 13-trixie(2025~2028,å°æé¾™)" \
				"8" "è‡ªåŠ¨æ£€æµ‹debian-14(2027~2030)" \
				"9" "ğŸ™9-stretch(2017~2020,ç©å…·æ€»åŠ¨å‘˜3ä¸­çš„ç« é±¼)" \
				"0" "ğŸŒš Return to previous menu è¿”å›ä¸Šçº§èœå•" \
				3>&1 1>&2 2>&3
		)
	}
	install_debian_gnu_linux_distro_menu_ja() {
		BETA_SYSTEM=$(
			whiptail --title "Debian version" --menu "Stable has fewer bugs,but the packages inside the \nsoftware source are older.Sid is relatively new." 0 50 0 \
				"1" "ğŸ‘¦Sidä¸å®‰å®šç‰ˆ:ã“ã‚Œã¯ã€é–‹ç™ºè€…å‘ã‘ã®ç‰ˆã§ã‚ã‚‹" \
				"2" "ğŸ11-bullseye(2021~2024)" \
				"3" "debootstrapã‚’ä½¿ç”¨ã—ã¦æ‰‹å‹•ã§ãƒ“ãƒ«ãƒ‰ã™ã‚‹" \
				"4" "ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒ¼ãƒ‰" \
				"5" "ğŸ¶10-buster(2019~2022)" \
				"6" "ğŸ“•ğŸ›12-bookworm(2023~2026)" \
				"7" "ğŸ¦• 13-trixie(2025~2028)" \
				"8" "debian-14(2027~2030)" \
				"9" "ğŸ™9-stretch(2017~2020)" \
				"0" "ğŸŒš æˆ»ã‚‹" \
				3>&1 1>&2 2>&3
		)
	}
	install_debian_gnu_linux_distro_menu_en() {
		BETA_SYSTEM=$(
			whiptail --title "Debian version" --menu "Stable has fewer bugs,but the packages inside the \nsoftware source are older.Sid is relatively new." 0 50 0 \
				"1" "ğŸ‘¦Sid (Unstable,a rolling development version)" \
				"2" "ğŸ11-bullseye(2021~2024)" \
				"3" "Manually build using debootstrap" \
				"4" "Custom code" \
				"5" "ğŸ¶10-buster(2019~2022)" \
				"6" "ğŸ“•ğŸ›12-bookworm(2023~2026)" \
				"7" "ğŸ¦• 13-trixie(2025~2028)" \
				"8" "debian-14(2027~2030)" \
				"9" "ğŸ™9-stretch(2017~2020)" \
				"0" "ğŸŒš Return to previous menu" \
				3>&1 1>&2 2>&3
		)
	}
	#"9" "ğŸ¤ 8-jessie(2015~2018,ç¿ ä¸,å¥³ç‰›ä»”)" \	9) DISTRO_CODE='jessie' ;;
	#"2" "recovery pkg æ¢å¤åŒ…" \	2) install_debian_gnu_linux_container_via_rec_pkg ;;
	##############################
	case ${TMOE_MENU_LANG} in
	zh_*UTF-8) install_debian_gnu_linux_distro_menu_zh ;;
	ja_JP.UTF-8) install_debian_gnu_linux_distro_menu_ja ;;
	*) install_debian_gnu_linux_distro_menu_en ;;
	esac
	case "${BETA_SYSTEM}" in
	0 | "") choose_which_gnu_linux_distro ;;
	1) DISTRO_CODE='sid' ;;
	2) DISTRO_CODE='bullseye' ;;
	3) debootstrap_debian_distro ;;
	4) custom_debian_version ;;
	5) DISTRO_CODE='buster' ;;
	6) check_debian_12 ;;
	7) check_debian_13 ;;
	8) check_debian_new_version ;;
	9) DISTRO_CODE='stretch' ;;
	esac
	######################
	TMOE_LINUX_CONTAINER_DISTRO="${DISTRO_NAME}-${DISTRO_CODE}"
	creat_container_edition_txt
	go_to_proot_management
	###############
	exit 0
}
#########################
check_debian_distro_code() {
	printf "%s\n" "å³å°†ä¸ºæ‚¨å®‰è£…Debian ${DISTRO_CODE} ${ARCH_TYPE} GNU/Linux container"
	do_you_want_to_continue
	case "${DISTRO_CODE}" in
	squeeze | wheezy | jessie | stretch | buster) install_debian_buster_via_tuna ;;
	sid) install_debian_sid_via_tuna ;;
	"") ;;
	*) install_debian_testing_via_tuna ;;
	esac
}
#"9" "ğŸ§7-wheezy(2013~2016,å±å±,å¸¦ç€é¢†ç»“çš„ç©å…·ä¼é¹…)" \
#"10" "ğŸ‘½6-squeeze(2011~2014,ä¸‰åªçœ¼çš„å¤–æ˜Ÿäºº)" \
############
check_debian_12() {
	#DISTRO_CODE='bookworm'
	DISTRO_CODE=$(curl -L ${LXC_IMAGES_REPO} | grep date | cut -d '=' -f 4 | cut -d '"' -f 2 | egrep -v 'jessie|stretch|buster|bullseye|sid|trixie|size' | tail -n 1)
	if [ -z ${DISTRO_CODE} ]; then
		printf "%s\n" "æ£€æµ‹åˆ°debian12å°šæœªå‘å¸ƒï¼Œå»ºè®®æ‚¨ç­‰åˆ°2023å¹´æ—¶å†æ¥å°è¯•"
		printf "%s\n" "å¦‚éœ€ä½“éªŒæœ€æ–°ç‰ˆæœ¬ï¼Œè¯·å®‰è£…debian sidï¼Œå¹¶æ·»åŠ experimentalè½¯ä»¶æº"
		press_enter_to_return
		install_debian_gnu_linux_distro_menu
	fi
}
check_debian_13() {
	#DISTRO_CODE='bookworm'
	DISTRO_CODE=$(curl -L ${LXC_IMAGES_REPO} | grep date | cut -d '=' -f 4 | cut -d '"' -f 2 | egrep -v 'jessie|stretch|buster|bullseye|bookworm|sid|size' | tail -n 1)
	if [ -z ${DISTRO_CODE} ]; then
		printf "%s\n" "æ£€æµ‹åˆ°debian13å°šæœªå‘å¸ƒï¼Œå»ºè®®æ‚¨ç­‰åˆ°2025å¹´æ—¶å†æ¥å°è¯•"
		printf "%s\n" "å¦‚éœ€ä½“éªŒæœ€æ–°ç‰ˆæœ¬ï¼Œè¯·å®‰è£…debian sidï¼Œå¹¶æ·»åŠ experimentalè½¯ä»¶æº"
		press_enter_to_return
		install_debian_gnu_linux_distro_menu
	fi
}
#############
debootstrap_debian_distro() {
	[[ $(command -v debootstrap) ]] || ${TMOE_INSTALLATION_COMMAND} debootstrap
	custom_debian_version
	printf "%s\n" "${DISTRO_CODE}"
	do_you_want_to_continue
	TMOE_LINUX_CONTAINER_DISTRO="${DISTRO_NAME}-${DISTRO_CODE}"
	#æ­¤å¤„é‡å¤åˆ›å»ºå¹¶éå¤šä½™
	creat_container_edition_txt
	if [ ! -e "${DEBIAN_CHROOT}" ]; then
		DEB_BOOT_STRAP='true'
		printf "%s\n" "${DEBIAN_CHROOT}"
		link_debootstrap_script
		if (whiptail --title "DEBIAN URL" --yes-button "BFSU MIRROR" --no-button "DEBIAN OFFICIAL" --yesno "Which url do you want to choose?" 8 50); then
			DEBIAN_MIRROR_URL="http://mirrors.bfsu.edu.cn/debian"
		else
			DEBIAN_MIRROR_URL="http://deb.debian.org/debian"
		fi

		${TMOE_PREFIX} mkdir -pv ${DEBIAN_CHROOT}
		#whiptail,wget,dialog,apt-transport-https
		#debootstrap --no-check-gpg --foreign --arch ${ARCH_TYPE} ${DISTRO_CODE} ${DEBIAN_CHROOT} http://mirrors.huaweicloud.com/debian
		#--include=apt-utils,curl,ca-certificates,locales,locales-all
		#--include=ifupdown,init,iproute2,iputils-ping,isc-dhcp-client,locales,netbase,net-tools,procps,curl,ca-certificates,openssl,whiptail
		${TMOE_PREFIX} debootstrap --no-check-gpg --arch ${ARCH_TYPE} --components=main,contrib,non-free --variant=minbase --include=init,locales,ca-certificates,openssl ${DISTRO_CODE} ${DEBIAN_CHROOT} ${DEBIAN_MIRROR_URL}
		if [[ ${DEBIAN_CHROOT} != / && -n ${DEBIAN_CHROOT} ]]; then
			${TMOE_PREFIX} rm -fv ${DEBIAN_CHROOT}/dev/*
		fi
		printf "%s\n" "DEBOOTSTRAP_DIR=${DEBIAN_CHROOT}" >${CONFIG_FOLDER}/debootstrap_dir.txt
		#DEBIAN_FRONTEND=noninteractive DEBCONF_NONINTERACTIVE_SEEN=true LC_ALL=C LANGUAGE=C LANG=C && chroot ${DEBIAN_CHROOT} /debootstrap/debootstrap --second-stage
	fi
}
###########
custom_debian_version() {
	TARGET=$(whiptail --inputbox "è¯·è¾“å…¥debianç‰ˆæœ¬ä»£å·ï¼Œä¾‹å¦‚buster(è‹±æ–‡å°å†™)\n Please type the debian version code." 10 50 --title "DEBIAN CODE" 3>&1 1>&2 2>&3)
	#[[ "$?" = 0 ]] || ${RETURN_TO_WHERE}
	DISTRO_CODE="$(printf '%s\n' "${TARGET}" | head -n 1 | cut -d ' ' -f 1)"
	if [ -z "${DISTRO_CODE}" ]; then
		printf "%s\n" "æ£€æµ‹åˆ°æ‚¨å–æ¶ˆäº†æ“ä½œ"
		printf "%s\n" "å·²è‡ªåŠ¨åˆ‡æ¢ä¸ºdebian11(ä»£å·bullseye)"
		DISTRO_CODE='bullseye'
	fi
}
#################
check_debian_new_version() {
	DISTRO_CODE=$(curl -L ${LXC_IMAGES_REPO} | grep date | cut -d '=' -f 4 | cut -d '"' -f 2 | egrep -v 'jessie|stretch|buster|bullseye|bookworm|sid|trixie|size' | tail -n 1)
	if [ -z ${DISTRO_CODE} ]; then
		printf "%s\n" "æ£€æµ‹åˆ°debian14å°šæœªå‘å¸ƒï¼Œå»ºè®®æ‚¨ç­‰åˆ°2027å¹´æ—¶å†æ¥å°è¯•"
		printf "%s\n" "å¦‚éœ€ä½“éªŒæœ€æ–°ç‰ˆæœ¬ï¼Œè¯·å®‰è£…debian sidï¼Œå¹¶æ·»åŠ experimentalè½¯ä»¶æº"
		press_enter_to_return
		install_debian_gnu_linux_distro_menu
	fi
}
#####################################
verify_sha256sum() {
	printf "$BLUE"
	cat <<-'EndOFneko'
		                                        
		                            .:7E        
		            .iv7vrrrrr7uQBBBBBBB:       
		           v17::.........:SBBBUg        
		        vKLi.........:. .  vBQrQ        
		   sqMBBBr.......... :i. .  SQIX        
		   BBQBBr.:...:....:. 1:.....v. ..      
		    UBBB..:..:i.....i YK:: ..:   i:     
		     7Bg.... iv.....r.ijL7...i. .Lu     
		  IB: rb...i iui....rir :Si..:::ibr     
		  J7.  :r.is..vrL:..i7i  7U...Z7i..     
		  ...   7..I:.: 7v.ri.755P1. .S  ::     
		    :   r:.i5KEv:.:.  :.  ::..X..::     
		   7is. :v .sr::.         :: :2. ::     
		   2:.  .u: r.     ::::   r: ij: .r  :  
		   ..   .v1 .v.    .   .7Qr: Lqi .r. i  
		   :u   .iq: :PBEPjvviII5P7::5Du: .v    
		    .i  :iUr r:v::i:::::.:.:PPrD7: ii   
		    :v. iiSrr   :..   s i.  vPrvsr. r.  
		     ...:7sv:  ..PL  .Q.:.   IY717i .7. 
		      i7LUJv.   . .     .:   YI7bIr :ur 
		     Y rLXJL7.:jvi:i:::rvU:.7PP XQ. 7r7 
		    ir iJgL:uRB5UPjriirqKJ2PQMP :Yi17.v 
		         :   r. ..      .. .:i  ...     
	EndOFneko
	printf "$RESET"
	cat <<-EOF
		ç¾åœ¨å¯å…¬é–‹çš„æƒ…å ±:
			${BOLD}Tmoe-linux å°æç¤º01${RESET}:

				è¾“${GREEN}startx11vnc${RESET}å¯åŠ¨${BLUE}x11vncæœåŠ¡${RESET},x11vncèƒ½è¿è¡Œtightvncæ— æ³•æ‰“å¼€çš„æŸäº›åº”ç”¨å“¦ï¼
				-------------------
				You can type ${GREEN}startx11vnc${RESET} to start ${BLUE}x11vnc server${RESET},type ${RED}stopvnc${RESET} to stop it.
				------------------
				åœ¨å®¹å™¨å†…è¾“${GREEN}debian-i${RESET}å¯åŠ¨è½¯ä»¶å®‰è£…åŠè¿œç¨‹æ¡Œé¢é…ç½®${BLUE}ç®¡ç†å·¥å…·${RESET}ã€‚
				-------------------
	EOF
	printf '%s\n' 'Verifying sha256hash...'
	printf '%s\n' 'æ­£åœ¨æ ¡éªŒsha256å“ˆå¸Œå€¼...'
	printf "%s\n" "${GREEN}${CORRENTSHA256SUM}${RESET}"
	LOCAL_FILE_SHA256_SUM="$(sha256sum ${DOWNLOAD_FILE_NAME} | cut -c 1-64)"
	if [ "${LOCAL_FILE_SHA256_SUM}" != "${CORRENTSHA256SUM}" ]; then
		printf "%s\n" "å½“å‰æ–‡ä»¶çš„sha256æ ¡éªŒå€¼ä¸º${RED}${LOCAL_FILE_SHA256_SUM}${RESET}"
		printf "%s\n" "è¿œç¨‹æ–‡ä»¶çš„sha256æ ¡éªŒå€¼ä¸º${CORRENTSHA256SUM}"
		printf '%s\n' 'sha256æ ¡éªŒå€¼ä¸ä¸€è‡´ï¼Œè¯·é‡æ–°ä¸‹è½½ï¼'
		printf '%s\n' 'sha256hash value is inconsistent, please download again.'
		printf "%s\n" "æŒ‰å›è½¦é”®æ— è§†é”™è¯¯å¹¶ç»§ç»­å®‰è£…,æŒ‰Ctrl+Cå–æ¶ˆã€‚"
		do_you_want_to_continue
	else
		printf '%s\n' 'Congratulations,æ£€æµ‹åˆ°sha256å“ˆå¸Œå€¼ä¸€è‡´'
		printf '%s\n' 'Detected that sha256hash is the same as the source code, and your download is correct.'
	fi
}
##########################
git_clone_tmoe_linux_container_file() {
	if [ ! $(command -v debian-i) ]; then
		aria2c --console-log-level=warn --no-conf --allow-overwrite=true -d ${PREFIX}/bin -o debian-i 'https://raw.githubusercontent.com/2moe/tmoe-linux/master/manager.sh' || curl -Lo ${PREFIX}/bin/debian-i 'https://raw.githubusercontent.com/2moe/tmoe-linux/master/manager.sh' || sudo -E aria2c --console-log-level=warn --no-conf --allow-overwrite=true -d ${PREFIX}/bin -o debian-i 'https://raw.githubusercontent.com/2moe/tmoe-linux/master/manager.sh'
		chmod +x ${PREFIX}/bin/debian-i
	fi
	TMOE_TRUE_TEMP_FOLDER='.TMOE_LINUX_CONTAINER_TEMP_FOLDER'
	mkdir -pv ${TMOE_TRUE_TEMP_FOLDER}
	cd ${TMOE_TRUE_TEMP_FOLDER}

	TMOE_TEMP_FOLDER=".${DOWNLOAD_FILE_NAME}_CONTAINER_TEMP_FOLDER_01"
	git clone --depth=1 -b ${BRANCH_NAME} ${TMOE_LINUX_CONTAINER_REPO_01} ${TMOE_TEMP_FOLDER}
	cd ${TMOE_TEMP_FOLDER}
	mv .container_linux_* ..
	cd ..
	if [ ! -z ${TMOE_LINUX_CONTAINER_REPO_02} ]; then
		TMOE_TEMP_FOLDER=".${DOWNLOAD_FILE_NAME}_CONTAINER_TEMP_FOLDER_02"
		git clone --depth=1 -b ${BRANCH_NAME} ${TMOE_LINUX_CONTAINER_REPO_02} ${TMOE_TEMP_FOLDER}
		cd ${TMOE_TEMP_FOLDER}
		mv .container_linux_* ..
		cd ..
	fi
	if [ ! -z ${TMOE_LINUX_CONTAINER_REPO_03} ]; then
		TMOE_TEMP_FOLDER=".${DOWNLOAD_FILE_NAME}_CONTAINER_TEMP_FOLDER_03"
		git clone --depth=1 -b ${BRANCH_NAME} ${TMOE_LINUX_CONTAINER_REPO_03} ${TMOE_TEMP_FOLDER}
		cd ${TMOE_TEMP_FOLDER}
		mv .container_linux_* ..
		cd ..
	fi
	printf "%s\n" "Debianæ¢å¤åŒ…å†…çš„æ•°ç™¾å¼ å£çº¸æ¥è‡ªäºå½±ä¹‹éŸ³é…±"
	cat .container_linux_* >${DOWNLOAD_FILE_NAME}
	mv -f ${DOWNLOAD_FILE_NAME} ../
	cd ../
	rm -rf ${TMOE_TRUE_TEMP_FOLDER}
}
#################
check_tmoe_linux_container_rec_pkg_file_and_git() {
	mkdir -pv ${DOWNLOAD_PATH}
	cd ${DOWNLOAD_PATH}
	if [ -f "${DOWNLOAD_FILE_NAME}" ]; then
		if (whiptail --title "æ£€æµ‹åˆ°å‹ç¼©åŒ…å·²ä¸‹è½½,è¯·é€‰æ‹©æ‚¨éœ€è¦æ‰§è¡Œçš„æ“ä½œï¼" --yes-button 'è§£å‹uncompress' --no-button 'é‡ä¸‹DL again' --yesno "Detected that the file has been downloaded.\nDo you want to unzip it, or download it again?\næ£€æµ‹åˆ°æ¢å¤åŒ…å·²ç»ä¸‹è½½,\næ‚¨æƒ³è¦ç›´æ¥è§£å‹è¿˜æ˜¯é‡æ–°ä¸‹è½½ï¼Ÿ" 0 0); then
			printf "%s\n" "è§£å‹åå°†è¦†ç›–å®¹å™¨çš„æ‰€æœ‰æ•°æ®"
			do_you_want_to_continue
		else
			git_clone_tmoe_linux_container_file
		fi
	else
		git_clone_tmoe_linux_container_file
	fi
	verify_sha256sum
	un_xz_debian_recovery_kit
}
########################
debian_sid_arm64_xfce_recovery_package() {
	printf "%s\n" "å³å°†ä¸ºæ‚¨ä¸‹è½½è‡³${DOWNLOAD_PATH}"
	printf '%s\n' 'ä¸‹è½½å¤§å°çº¦1.5G,è§£å‹åçº¦å 5.8G'
	#printf "%s\n" "2020-07-11å‡Œæ™¨æ³¨ï¼šå¿˜è®°ç»™LibreOfficeæ‰“è¡¥ä¸äº† (ã„’oã„’)/~~ï¼Œè¯·åœ¨å®‰è£…å®Œæˆåä½¿ç”¨tmoe-linux toolç»™libreofficeæ‰“è¡¥ä¸"
	CORRENTSHA256SUM='5c85ec7857539025fc9744d89b10655219dcd2a535da0f20bd405d28512dfe59' #DevSkim: ignore DS173237
	BRANCH_NAME='arm64'
	TMOE_LINUX_CONTAINER_REPO_01='https://gitee.com/ak2/debian_sid_rootfs_01'
	TMOE_LINUX_CONTAINER_REPO_02='https://gitee.com/ak2/debian_sid_rootfs_02'
	TMOE_LINUX_CONTAINER_REPO_03='https://gitee.com/ak2/debian_sid_rootfs_03'
	DOWNLOAD_FILE_NAME='debian-sid+xfce4.14_2020-08-29_18-13-rootfs_bak.tar.xz'
	check_tmoe_linux_container_rec_pkg_file_and_git
}
##################
debian_buster_arm64_xfce_recovery_package() {
	printf "%s\n" "å³å°†ä¸ºæ‚¨ä¸‹è½½è‡³${DOWNLOAD_PATH}"
	printf '%s\n' 'ä¸‹è½½å¤§å°çº¦573MiB,è§£å‹åçº¦å 2.2G'
	CORRENTSHA256SUM='a7106647f7b4577c3e9868d790f1bea5464b38362785a592cb5283f44b976512' #DevSkim: ignore DS173237
	BRANCH_NAME='arm64'
	TMOE_LINUX_CONTAINER_REPO_01='https://gitee.com/ak2/debian_stable_rootfs_01'
	TMOE_LINUX_CONTAINER_REPO_02='https://gitee.com/ak2/debian_stable_rootfs_02'
	TMOE_LINUX_CONTAINER_REPO_03=''
	DOWNLOAD_FILE_NAME='debian-buster_arm64-xfce4.12+music-app_2020-08-28_18-27-rootfs_bak.tar.xz'
	check_tmoe_linux_container_rec_pkg_file_and_git
}
#################
install_debian_sid_via_tuna() {
	bash -c "$(sed -n p ${TMOE_SHARE_DIR}/container/install |
		sed 's@ARCH_TYPE\}/default@ARCH_TYPE\}/cloud@')"
}
#################
install_debian_gnu_linux_container_via_rec_pkg() {
	#Do you want to install debian container via Tsinghua University open source mirror station,\nor download the recovery package (debian-xfce.tar.xz)?\næ‚¨æƒ³è¦é€šè¿‡è½¯ä»¶æºé•œåƒç«™æ¥å®‰è£…ï¼Œè¿˜æ˜¯åœ¨çº¿ä¸‹è½½æ¢å¤åŒ…æ¥å®‰è£…ï¼Ÿ\nè½¯ä»¶æºè·å–çš„æ˜¯æœ€æ–°ç‰ˆé•œåƒï¼Œä¸”æ”¯æŒarm64,armhf,x86,x64ç­‰æ¶æ„,\nå®‰è£…åŸºç¡€ç³»ç»Ÿé€Ÿåº¦å¾ˆå¿«ï¼Œä½†å®‰è£…guié€Ÿåº¦è¾ƒæ…¢ã€‚\næ¢å¤åŒ…éæœ€æ–°ç‰ˆ,è½¯ä»¶åŒ…åªæ›´æ–°è‡³2020-07-10,ä¸”ä»…æ”¯æŒarm64æ¶æ„,ä½†å®‰è£…guié€Ÿåº¦è¾ƒå¿«ã€‚\nè‹¥æ‚¨æ— ä½¿ç”¨GUIçš„éœ€æ±‚ï¼Œå»ºè®®é€šè¿‡è½¯ä»¶æºé•œåƒç«™æ¥å®‰è£…ã€‚" 0 50 0 \
	BETA_SYSTEM=$(whiptail --title "Download recovery package and install container" --menu "æ¢å¤åŒ…åœ¨è§£å‹å®Œæˆåï¼Œå°†æ ¹æ®ç³»ç»Ÿå¯¹æƒé™çš„é™åˆ¶æ¥åˆ¤æ–­ç‰¹æ®Šæ–‡ä»¶çš„æŒ‚è½½ä¸å¦ã€‚" 0 50 0 \
		"1" "arm64 sid xfce,600+P,1.5G,20200829" \
		"2" "arm64 buster xfce,200+P,573M,20200828" \
		"0" "ğŸŒš Return to previous menu è¿”å›ä¸Šçº§èœå•" \
		3>&1 1>&2 2>&3)
	##############################
	#"1" "netinstall(é€šè¿‡è½¯ä»¶æºåœ¨çº¿å®‰è£…)" \
	case "${BETA_SYSTEM}" in
	0 | "") install_debian_gnu_linux_distro_menu ;;
	1) DISTRO_CODE='sid' ;;
	2) DISTRO_CODE='buster' ;;
	esac
	######################
	case ${TRUE_ARCH_TYPE} in
	arm64) ;;
	*)
		printf "%s\n" "Sorryï¼Œæ¢å¤åŒ…æš‚æœªæ”¯æŒè·¨æ¶æ„è¿è¡Œ"
		press_enter_to_return
		install_debian_gnu_linux_distro_menu
		;;
	esac
	case ${TMOE_CHROOT} in
	true)
		printf "%s\n" "æ£€æµ‹åˆ°æ‚¨é€‰æ‹©çš„æ˜¯chrootå®¹å™¨,æš‚ä¸æ”¯æŒæ¢å¤,è¯·åœ¨çº¿å®‰è£…ã€‚"
		press_enter_to_return
		install_debian_gnu_linux_distro_menu
		;;
	esac
	TMOE_LINUX_CONTAINER_DISTRO="${DISTRO_NAME}-${DISTRO_CODE}"
	creat_container_edition_txt
	printf "%s\n" "å³å°†ä¸ºæ‚¨å®‰è£…Debian ${DISTRO_CODE} GNU/Linux container"
	do_you_want_to_continue
	case "${DISTRO_CODE}" in
	buster) debian_buster_arm64_xfce_recovery_package ;;
	sid) debian_sid_arm64_xfce_recovery_package ;;
	esac
	###############
	exit 0
}
###########
install_debian_buster_via_tuna() {
	bash -c "$(sed -n p ${TMOE_SHARE_DIR}/container/install |
		sed "s:/sid:/${DISTRO_CODE}:g" |
		sed "s:-sid:-${DISTRO_CODE}:g" |
		sed 's@ARCH_TYPE\}/default@ARCH_TYPE\}/cloud@' |
		sed "s@debian/ stable@debian/ ${DISTRO_CODE}@g" |
		sed "s@stable/updates@${DISTRO_CODE}/updates@g" |
		sed "s@buster-backports@${DISTRO_CODE}-backports@g" |
		sed 's@#deb http@deb http@g' |
		sed 's/.*sid main/#&/')"
}
############
install_debian_testing_via_tuna() {
	bash -c "$(sed -n p ${TMOE_SHARE_DIR}/container/install |
		sed "s:/sid:/${DISTRO_CODE}:g" |
		sed "s:-sid:-${DISTRO_CODE}:g" |
		sed 's@ARCH_TYPE\}/default@ARCH_TYPE\}/cloud@' |
		sed "s@debian/ stable@debian/ ${DISTRO_CODE}@g" |
		sed "s@stable/updates@${DISTRO_CODE}-security@g" |
		sed "s@buster-backports@${DISTRO_CODE}-backports@g" |
		sed 's@#deb http@deb http@g' |
		sed 's/.*sid main/#&/')"
}
#################
install_debian_gnu_linux_distro_menu $@
