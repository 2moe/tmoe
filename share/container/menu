#!/usr/bin/env bash
##############################
proot_container_main_menu() {
	case "$1" in
	restore | --restore) restore_tmoe_container ;;
	*) proot_container_menu ;;
	esac
}
################################
list_tmoe_containers() {
	ARCH_TYPE=${TRUE_ARCH_TYPE}
	rm ~/.config/tmoe-linux/across_architecture_container.txt 2>/dev/null
	choose_which_gnu_linux_distro
}
##############
across_architectures_container() {
	case ${TMOE_CHROOT} in
	true)
		case ${LINUX_DISTRO} in
		Android)
			getprop ro.product.model 2>/dev/null
			printf "%s %s\n" "éƒ¨åˆ†Androidç³»ç»Ÿæ— ${BLUE}/proc/sys/fs/binfmt_misc${RESET}, æ•…æœ¬å·¥å…·æœªå¯¹Androidå¼€æ”¾æ­¤åŠŸèƒ½ã€‚" "å¦‚éœ€è·¨æž¶æž„è¿è¡Œchrootå®¹å™¨,åˆ™è¯·æ¢ç”¨GNU/Linuxç³»ç»Ÿï¼Œæˆ–è‡ªè¡ŒåŠ è½½${YELLOW}å†…æ ¸æ¨¡å—${RESET}ã€‚"
			printf "%s\n" "Sorry, you are using Android system, please modprobe binfmt_misc kernel module by yourself."
			press_enter_to_return
			list_tmoe_containers
			;;
		esac
		;;
	esac
	source ${TMOE_SHARE_DIR}/container/qemu/qemu-user
	tmoe_qemu_user_manager
}
#############
proot_container_menu() {
	source ${TMOE_SHARE_DIR}/container/list
	check_proot_or_chroot
	RETURN_TO_WHERE='proot_container_menu'
	RETURN_TO_WHERE_02=${RETURN_TO_WHERE}
	proot_container_menu_en() {
		SELECTED_GNU_LINUX=$(whiptail --title "${CONTAINER_TYPE} CONTAINER" --menu "Your current architecture is ${TRUE_ARCH_TYPE}.\nDo you want to run on the same architecture or across architectures?" 0 50 0 \
			"1" "${TRUE_ARCH_TYPE} distros list" \
			"2" "ðŸ“‘ List installed" \
			"3" "âš”ï¸ Across architectures" \
			"4" "ðŸ”¯ Restore ${CONTAINER_TYPE} container" \
			"5" "ðŸ“• Configuration & manual" \
			"0" "ðŸŒš Back to the main menu" \
			3>&1 1>&2 2>&3)
	}
	proot_container_menu_cn() {
		SELECTED_GNU_LINUX=$(whiptail --title "${CONTAINER_TYPE}å®¹å™¨" --menu "æ‚¨æ˜¯æƒ³è¦åŒæž¶æž„è¿è¡Œ,è¿˜æ˜¯è·¨æž¶æž„å‘¢ï¼Ÿ\né™¤å‘ä¸‹å…¼å®¹å¤–,è·¨æž¶æž„è¿è¡Œçš„æ•ˆçŽ‡å¯èƒ½åä½Ž" 0 50 0 \
			"1" "${TRUE_ARCH_TYPE}å‘è¡Œç‰ˆåˆ—è¡¨" \
			"2" "ðŸ“‘ List installed å½“å‰å·²å®‰è£…å®¹å™¨åˆ—è¡¨" \
			"3" "âš”ï¸ Across architectures è·¨CPUæž¶æž„" \
			"4" "ðŸ”¯ Restore æ¢å¤/è¿˜åŽŸ${CONTAINER_TYPE}å®¹å™¨" \
			"5" "ðŸ“• é…ç½®ä¸Žæ‰‹å†Œ" \
			"0" "ðŸŒš Back to the main menu è¿”å›žä¸»èœå•" \
			3>&1 1>&2 2>&3)
	}
	case ${TMOE_MENU_LANG} in
	zh_*UTF-8) proot_container_menu_cn ;;
	*) proot_container_menu_en ;;
	esac
	##############################
	case "${SELECTED_GNU_LINUX}" in
	0 | "") tmoe_manager_main_menu ;;
	1) list_tmoe_containers ;;
	2) list_installed_tmoe_containers ;;
	3) across_architectures_container ;;
	4) restore_tmoe_container ;;
	5) configure_tmoe_container ;;
	esac
	####################
	press_enter_to_return
	tmoe_manager_main_menu
}
##################
restore_tmoe_container() {
	source ${TMOE_SHARE_DIR}/compression/restore
}
configure_tmoe_container() {
	source ${TMOE_SHARE_DIR}/configuration/menu
	configure_tmoe_container
}
####################
proot_container_main_menu
