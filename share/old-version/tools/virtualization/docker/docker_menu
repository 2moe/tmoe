##########################
tmoe_docker_init() {
    if [ ! "$(pgrep docker)" ]; then
        service docker start 2>/dev/null || systemctl start docker
    else
        docker stop ${CONTAINER_NAME} 2>/dev/null
    fi
    MOUNT_DOCKER_FOLDER=/media/docker
    if [ ! -d "${MOUNT_DOCKER_FOLDER}" ]; then
        mkdir -pv ${MOUNT_DOCKER_FOLDER}
        chown -R ${CURRENT_USER_NAME}:${CURRENT_USER_GROUP} ${MOUNT_DOCKER_FOLDER}
    fi
    TMOE_LINUX_DOCKER_SHELL_FILE="${MOUNT_DOCKER_FOLDER}/.tmoe-linux-docker.sh"
    #if [ ! -e "${TMOE_LINUX_DOCKER_SHELL_FILE}" ]; then
    cp ${TMOE_GIT_DIR}/share/old-version/tools/virtualization/docker/configure ${TMOE_LINUX_DOCKER_SHELL_FILE}
    sed -i 's@###tmoe_locale_gen@tmoe_locale_gen@g' ${TMOE_LINUX_DOCKER_SHELL_FILE}
    sed -i 's@###tuna_mirror@tuna_mirror@g' ${TMOE_LINUX_DOCKER_SHELL_FILE}
    #fi
}
################
run_docker_container_with_same_architecture() {
    case ${SYSTEMD_DOCKER} in
    true)
        printf "%s\n" "${BLUE}docker run -itd --name ${CONTAINER_NAME} --privileged=true --env LANG=${TMOE_LANG} --env CONTAINER_SYSTEMD=true --env TMOE_CHROOT=true --env TMOE_DOCKER=true --env TMOE_PROOT=false --restart on-failure -v ${MOUNT_DOCKER_FOLDER}:${MOUNT_DOCKER_FOLDER} ${DOCKER_NAME}:${DOCKER_TAG} /sbin/init${RESET}"
        docker run -itd --name ${CONTAINER_NAME} --privileged=true --env LANG=${TMOE_LANG} --env CONTAINER_SYSTEMD=true --env TMOE_CHROOT=true --env TMOE_DOCKER=true --env TMOE_PROOT=false --restart on-failure -v ${MOUNT_DOCKER_FOLDER}:${MOUNT_DOCKER_FOLDER} ${DOCKER_NAME}:${DOCKER_TAG} /sbin/init
        ;;
    *)
        printf "%s\n" "${BLUE}docker run -itd --name ${CONTAINER_NAME} --env LANG=${TMOE_LANG} --env TMOE_CHROOT=true --env TMOE_DOCKER=true --env TMOE_PROOT=false --restart on-failure -v ${MOUNT_DOCKER_FOLDER}:${MOUNT_DOCKER_FOLDER} ${DOCKER_NAME}:${DOCKER_TAG}${RESET}"
        docker run -itd --name ${CONTAINER_NAME} --env LANG=${TMOE_LANG} --env TMOE_CHROOT=true --env TMOE_DOCKER=true --env TMOE_PROOT=false --restart on-failure -v ${MOUNT_DOCKER_FOLDER}:${MOUNT_DOCKER_FOLDER} ${DOCKER_NAME}:${DOCKER_TAG}
        ;;
    esac
}
##########
run_special_tag_docker_container() {
    tmoe_docker_init
    case "${TMOE_QEMU_ARCH}" in
    "") run_docker_container_with_same_architecture ;;
    *)
        #QEMU_USER_STATIC_PATH_01='/usr/local/bin'
        QEMU_USER_STATIC_PATH_02='/usr/bin'
        QEMU_USER_PATH="${QEMU_USER_STATIC_PATH_02}"
        #if [ -e "${QEMU_USER_STATIC_PATH_01}/qemu-aarch64-static" ]; then
        #    QEMU_USER_PATH="${QEMU_USER_STATIC_PATH_01}"
        #else
        #    QEMU_USER_PATH="${QEMU_USER_STATIC_PATH_02}"
        #fi
        case ${SYSTEMD_DOCKER} in
        true)
            printf "%s\n" "${BLUE}docker run -itd --name ${CONTAINER_NAME} --privileged=true --env LANG=${TMOE_LANG} --env CONTAINER_SYSTEMD=true --env TMOE_CHROOT=true --env TMOE_DOCKER=true --env TMOE_PROOT=false --restart on-failure -v ${QEMU_USER_PATH}/qemu-${TMOE_QEMU_ARCH}-static:${QEMU_USER_STATIC_PATH_02}/qemu-${TMOE_QEMU_ARCH}-static -v ${MOUNT_DOCKER_FOLDER}:${MOUNT_DOCKER_FOLDER} ${DOCKER_NAME}:${DOCKER_TAG} /sbin/init${RESET}"
            docker run -itd --name ${CONTAINER_NAME} --privileged=true --env LANG=${TMOE_LANG} --env CONTAINER_SYSTEMD=true --env TMOE_CHROOT=true --env TMOE_DOCKER=true --env TMOE_PROOT=false --restart on-failure -v ${QEMU_USER_PATH}/qemu-${TMOE_QEMU_ARCH}-static:${QEMU_USER_STATIC_PATH_02}/qemu-${TMOE_QEMU_ARCH}-static -v ${MOUNT_DOCKER_FOLDER}:${MOUNT_DOCKER_FOLDER} ${DOCKER_NAME}:${DOCKER_TAG} /sbin/init
            ;;
        *)
            printf "%s\n" "${BLUE}docker run -itd --name ${CONTAINER_NAME} --env LANG=${TMOE_LANG} --env TMOE_CHROOT=true --env TMOE_DOCKER=true --env TMOE_PROOT=false --restart on-failure -v ${QEMU_USER_PATH}/qemu-${TMOE_QEMU_ARCH}-static:${QEMU_USER_STATIC_PATH_02}/qemu-${TMOE_QEMU_ARCH}-static -v ${MOUNT_DOCKER_FOLDER}:${MOUNT_DOCKER_FOLDER} ${DOCKER_NAME}:${DOCKER_TAG}${RESET}"
            docker run -itd --name ${CONTAINER_NAME} --env LANG=${TMOE_LANG} --env TMOE_CHROOT=true --env TMOE_DOCKER=true --env TMOE_PROOT=false --restart on-failure -v ${QEMU_USER_PATH}/qemu-${TMOE_QEMU_ARCH}-static:${QEMU_USER_STATIC_PATH_02}/qemu-${TMOE_QEMU_ARCH}-static -v ${MOUNT_DOCKER_FOLDER}:${MOUNT_DOCKER_FOLDER} ${DOCKER_NAME}:${DOCKER_TAG}
            ;;
        esac
        ;;
    esac

    printf "%s\n" "Â∑≤Â∞ÜÂÆø‰∏ªÊú∫ÁöÑ${YELLOW}${MOUNT_DOCKER_FOLDER}${RESET}ÁõÆÂΩï${RED}ÊåÇËΩΩËá≥${RESET}ÂÆπÂô®ÂÜÖÁöÑ${BLUE}${MOUNT_DOCKER_FOLDER}${RESET}"
    printf "%s\n" "You can type ${GREEN}sudo docker exec -it ${CONTAINER_NAME} sh${RESET} to connect ${CONTAINER_NAME} container."
    printf "%s\n" "ÊÇ®ÂèØ‰ª•Ëæì${GREEN}docker attach ${CONTAINER_NAME}${RESET}Êù•ËøûÊé•${CONTAINER_NAME}ÂÆπÂô®"
    printf "%s\n" "Do you want to start and configure this container?"
    printf "%s\n" "ÊÇ®ÊòØÂê¶ÊÉ≥Ë¶ÅÂêØÂä®Âπ∂ÈÖçÁΩÆÊú¨ÂÆπÂô®Ôºü"
    do_you_want_to_continue
    docker start ${CONTAINER_NAME}
    docker exec -it ${CONTAINER_NAME} /bin/sh ${TMOE_LINUX_DOCKER_SHELL_FILE}
}
##############
only_delete_docker_container() {
    service docker start 2>/dev/null || systemctl start docker
    cat <<-EOF
		${RED}docker stop ${CONTAINER_NAME}
		docker rm ${CONTAINER_NAME}${RESET}
	EOF
    do_you_want_to_continue
    docker stop ${CONTAINER_NAME} 2>/dev/null
    docker rm ${CONTAINER_NAME} 2>/dev/null
}
##########
delete_docker_container_and_image() {
    cat <<-EOF
		${RED}docker rmi ${DOCKER_NAME}:${DOCKER_TAG}
		docker rmi ${DOCKER_NAME}:${DOCKER_TAG_02}${RESET}
	EOF
    only_delete_docker_container
    #docker rm ${CONTAINER_NAME} 2>/dev/null
    docker rmi ${DOCKER_NAME}:${DOCKER_TAG} 2>/dev/null
    if [ ! -z "${DOCKER_TAG_02}" ]; then
        docker rmi ${DOCKER_NAME}:${DOCKER_TAG_02} 2>/dev/null
    fi
    docker rmi ${DOCKER_NAME} 2>/dev/null
    if [ ! -z "${DOCKER_NAME_02}" ]; then
        docker rmi ${DOCKER_NAME_02}:${DOCKER_TAG} 2>/dev/null
        docker rmi ${DOCKER_NAME_02}:${DOCKER_TAG_02} 2>/dev/null
        docker rmi ${DOCKER_NAME_02} 2>/dev/null
    fi
}
##################
reset_docker_container() {
    delete_docker_container_and_image
    printf "%s\n" "${BLUE}docker pull ${DOCKER_NAME}:${DOCKER_TAG}${RESET}"
    docker pull ${DOCKER_NAME}:${DOCKER_TAG}
    run_special_tag_docker_container
}
###############
tmoe_docker_readme() {
    cat <<-ENDOFDOCKER
	${GREEN}service docker start || systemctl start docker${RESET}	${BLUE}ÂêØÂä®docker${RESET}
	${GREEN}systemctl enable docker${RESET}	${BLUE}Â∞ÜdockerËÆæÂÆö‰∏∫ÂºÄÊú∫Ëá™ÂêØ${RESET}
	---------------------------------
    ${GREEN}docker ps${RESET} 	${BLUE}ÂàóÂá∫ÂΩìÂâçÊ≠£Âú®ËøêË°åÁöÑÂÆπÂô®${RESET}
    ${GREEN}docker ps -a${RESET} 	${BLUE}ÂàóÂá∫ÊâÄÊúâÂÆπÂô®${RESET}
    ${GREEN}docker start ${CONTAINER_NAME}${RESET}	${BLUE}ÂêØÂä®${CONTAINER_NAME}ÂÆπÂô®${RESET}
    ${GREEN}docker stop ${CONTAINER_NAME}${RESET} 	${BLUE}ÂÅúÊ≠¢${CONTAINER_NAME}ÂÆπÂô®${RESET}
    ${GREEN}docker attach ${CONTAINER_NAME}${RESET} 	${BLUE}ËøûÊé•${CONTAINER_NAME}ÂÆπÂô®${RESET}
    ${GREEN}docker exec -it ${CONTAINER_NAME} /bin/bash${RESET} 	${BLUE}ÂØπ${CONTAINER_NAME}ÂÆπÂô®ÊâßË°å/bin/bash${RESET}
	${GREEN}docker exec -it ${CONTAINER_NAME} /bin/sh${RESET} 	${BLUE}ÂØπ${CONTAINER_NAME}ÂÆπÂô®ÊâßË°å/bin/sh${RESET}
ENDOFDOCKER
}
#############
custom_docker_container_tag() {
    if [ "$(printf '%s\n' "${DOCKER_NAME}" | grep '/')" ]; then
        #https://hub.docker.com/r/kalilinux/kali-rolling/tags
        DOCKER_URL="https://hub.docker.com/r/${DOCKER_NAME}/tags"
    else
        DOCKER_URL="https://hub.docker.com/_/${DOCKER_NAME}?tab=tags"
    fi
    TARGET=$(whiptail --inputbox "Please type the container tag,\nyou may be able to get more info via \n${DOCKER_URL}" 0 50 --title "DOCKER TAG" 3>&1 1>&2 2>&3)
    if [ "$?" != "0" ]; then
        ${RETURN_TO_WHERE}
    elif [ -z "${TARGET}" ]; then
        printf "%s\n" "ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑÂÄº"
        printf "%s\n" "Please enter a valid value"
    else
        DOCKER_TAG=${TARGET}
        run_special_tag_docker_container
    fi
}
##########
docker_attch_container() {
    if [ ! "$(pgrep docker)" ]; then
        service docker start 2>/dev/null || systemctl start docker
    fi
    if [ "$(docker ps -a | grep ${CONTAINER_NAME})" ]; then
        docker start ${CONTAINER_NAME}
        docker exec -it ${CONTAINER_NAME} /bin/bash || docker attach ${CONTAINER_NAME}
    else
        printf "%s\n" "The ${CONTAINER_NAME} container was not found."
        printf "%s\n" "Do you want to pull ${DOCKER_NAME}?"
        printf "%s\n" "Âõ†Êú™ÊâæÂà∞${CONTAINER_NAME}ÂÆπÂô®ÔºåÊïÖÂÆπÂô®ËøûÊé•Â§±Ë¥•ÔºåËØ∑ÈóÆÊÇ®ÊòØÂê¶ÈúÄË¶ÅÊãâÂèñ${DOCKER_NAME}ÈïúÂÉèÂπ∂Êñ∞Âª∫ÂÆπÂô®Ôºü"
        do_you_want_to_continue
        run_special_tag_docker_container
    fi

}
############
tmoe_docker_management_menu_01() {
    RETURN_TO_WHERE='tmoe_docker_management_menu_01'
    DOCKER_TAG=${DOCKER_TAG_01}
    VIRTUAL_TECH=$(
        whiptail --title "${DOCKER_NAME} CONTAINER(dockerÂÆπÂô®)" --menu "Which container do you want to run?" 0 0 0 \
            "1" "${DOCKER_TAG_01}" \
            "2" "${DOCKER_TAG_02}" \
            "3" "custom tag(ËøêË°åËá™ÂÆö‰πâÊ†áÁ≠æÁöÑÂÆπÂô®)" \
            "4" "docker attach ${CONTAINER_NAME}(ËøûÊé•ÂÆπÂô®)" \
            "5" "readme of ${CONTAINER_NAME} ËØ¥Êòé" \
            "6" "reset(ÈáçÁΩÆÂÆπÂô®Êï∞ÊçÆÂπ∂ÈáçÊãâ${DOCKER_TAG}ÈïúÂÉè)" \
            "7" "delete(Âà†Èô§${CONTAINER_NAME}ÂÆπÂô®)" \
            "0" "üåö Return to previous menu ËøîÂõû‰∏äÁ∫ßËèúÂçï" \
            3>&1 1>&2 2>&3
    )
    #############
    case ${VIRTUAL_TECH} in
    0 | "") choose_gnu_linux_docker_images ;;
    1)
        DOCKER_TAG=${DOCKER_TAG_01}
        run_special_tag_docker_container
        ;;
    2)
        DOCKER_TAG=${DOCKER_TAG_02}
        run_special_tag_docker_container
        ;;
    3) custom_docker_container_tag ;;
    4) docker_attch_container ;;
    5) tmoe_docker_readme ;;
    6) reset_docker_container ;;
    7) delete_docker_container ;;
    esac
    ###############
    press_enter_to_return
    tmoe_docker_management_menu_01
}
###########
delete_docker_container() {
    if (whiptail --title "Delete container" --yes-button 'container' --no-button 'container+image' --yesno "What do you want to delete?\nÊÇ®ÊòØÊÉ≥Ë¶ÅÂà†Èô§ÂÆπÂô®,ËøòÊòØÂà†Èô§ÂÆπÂô®+ÈïúÂÉèÔºü" 0 50); then
        only_delete_docker_container
    else
        delete_docker_container_and_image
    fi
}
############
tmoe_docker_management_menu_02() {
    RETURN_TO_WHERE='tmoe_docker_management_menu_02'
    DOCKER_TAG=${DOCKER_TAG_01}
    VIRTUAL_TECH=$(
        whiptail --title "${DOCKER_NAME} CONTAINER(dockerÂÆπÂô®)" --menu "Which container do you want to run?" 0 0 0 \
            "1" "${DOCKER_NAME}" \
            "2" "${DOCKER_NAME_02}" \
            "3" "custom tag(ËøêË°åËá™ÂÆö‰πâÊ†áÁ≠æÁöÑÂÆπÂô®)" \
            "4" "docker attach ${CONTAINER_NAME}(ËøûÊé•ÂÆπÂô®)" \
            "5" "readme of ${CONTAINER_NAME} ËØ¥Êòé" \
            "6" "reset(ÈáçÁΩÆÂÆπÂô®Êï∞ÊçÆÂπ∂ÈáçÊãâ${DOCKER_NAME}:${DOCKER_TAG_01}ÈïúÂÉè)" \
            "7" "delete(Âà†Èô§${CONTAINER_NAME}ÂÆπÂô®)" \
            "0" "üåö Return to previous menu ËøîÂõû‰∏äÁ∫ßËèúÂçï" \
            3>&1 1>&2 2>&3
    )
    #############
    case ${VIRTUAL_TECH} in
    0 | "") choose_gnu_linux_docker_images ;;
    1)
        DOCKER_NAME="${DOCKER_NAME}"
        run_special_tag_docker_container
        ;;
    2)
        DOCKER_NAME="${DOCKER_NAME_02}"
        run_special_tag_docker_container
        ;;
    3) custom_docker_container_tag ;;
    4) docker_attch_container ;;
    5) tmoe_docker_readme ;;
    6) reset_docker_container ;;
    7) delete_docker_container ;;
    esac
    ###############
    press_enter_to_return
    tmoe_docker_management_menu_02
}
###########
tmoe_docker_management_menu_03() {
    RETURN_TO_WHERE='tmoe_docker_management_menu_03'
    DOCKER_TAG=${DOCKER_TAG_01}
    VIRTUAL_TECH=$(
        whiptail --title "${DOCKER_NAME} CONTAINER(dockerÂÆπÂô®)" --menu "Which container do you want to run?" 0 0 0 \
            "1" "${DOCKER_TAG_01}" \
            "2" "custom tag(ËøêË°åËá™ÂÆö‰πâÊ†áÁ≠æÁöÑÂÆπÂô®)" \
            "3" "readme of ${CONTAINER_NAME} ËØ¥Êòé" \
            "4" "docker attach ${CONTAINER_NAME}(ËøûÊé•ÂÆπÂô®)" \
            "5" "reset(ÈáçÁΩÆÂÆπÂô®Êï∞ÊçÆÂπ∂ÈáçÊãâ${DOCKER_TAG_01}ÈïúÂÉè)" \
            "6" "delete(Âà†Èô§${CONTAINER_NAME}ÂÆπÂô®)" \
            "0" "üåö Return to previous menu ËøîÂõû‰∏äÁ∫ßËèúÂçï" \
            3>&1 1>&2 2>&3
    )
    #############
    case ${VIRTUAL_TECH} in
    0 | "") choose_gnu_linux_docker_images ;;
    1) run_special_tag_docker_container ;;
    2) custom_docker_container_tag ;;
    3) tmoe_docker_readme ;;
    4) docker_attch_container ;;
    5) reset_docker_container ;;
    6) delete_docker_container ;;
    esac
    ###############
    press_enter_to_return
    tmoe_docker_management_menu_03
}
###########
not_adapted_across_architecture() {
    if [ ! -z "${TMOE_QEMU_ARCH}" ]; then
        #TMOE_QEMU_ARCH=''
        #Ê≠§Â§Ñ‰∏çË¶ÅÊ∏ÖÈô§ÂèòÈáè
        printf "%s\n" "${RED}WARNINGÔºÅ${RESET}Êú¨ËÑöÊú¨Êú™ÈÄÇÈÖç${CONTAINER_NAME}ÂÆπÂô®ÁöÑË∑®Êû∂ÊûÑËøêË°å„ÄÇ"
        press_enter_to_continue
    fi
}
###############
only_support_amd64_container() {
    case ${TMOE_QEMU_ARCH} in
    x86_64) ;;
    "")
        case ${TRUE_ARCH_TYPE} in
        amd64) ;;
        *) arch_does_not_support ;;
        esac
        ;;
    *) arch_does_not_support ;;
    esac
}
#############
only_support_amd64_and_arm64v8_container() {
    case ${TMOE_QEMU_ARCH} in
    x86_64 | aarch64) ;;
    "")
        case ${TRUE_ARCH_TYPE} in
        amd64 | arm64) ;;
        *) arch_does_not_support ;;
        esac
        ;;
    *) arch_does_not_support ;;
    esac
}
#############
gentoo_stage3_amd64() {
    DOCKER_NAME='gentoo/stage3-amd64'
    DOCKER_NAME_02='gentoo/stage3-amd64-hardened-nomultilib'
}
########
gentoo_stage3_i386() {
    DOCKER_NAME='gentoo/stage3-x86'
    DOCKER_NAME_02='gentoo/stage3-x86-hardened'
}
########
gentoo_stage3_armhf() {
    DOCKER_NAME='paralin/gentoo-stage3-armv7a'
    DOCKER_NAME_02='applehq/gentoo-stage4'
}
########
arch_docker_amd64() {
    DOCKER_NAME='archlinux'
    DOCKER_MANAGEMENT_MENU='03'
}
##########
arch_docker_arm64() {
    DOCKER_NAME='lopsided/archlinux'
    DOCKER_NAME_02='agners/archlinuxarm'
    DOCKER_MANAGEMENT_MENU='02'
}
##########
openwrt_docker_amd64() {
    DOCKER_NAME='openwrtorg/rootfs'
    DOCKER_NAME_02='katta/openwrt-rootfs'
    DOCKER_MANAGEMENT_MENU='02'
}
###########
openwrt_docker_arm64() {
    DOCKER_NAME='buddyfly/openwrt-aarch64'
    DOCKER_NAME_02='unifreq/openwrt-aarch64'
    DOCKER_MANAGEMENT_MENU='02'
}
############
kali_docker_amd64() {
    DOCKER_NAME='kalilinux/kali-rolling'
    DOCKER_NAME_02='kalilinux/kali'
}
kali_docker_armhf() {
    DOCKER_NAME='rbartoli/kali-linux-arm'
    DOCKER_NAME_02='williamlegourd/kali-gui'
}
kali_docker_arm64() {
    DOCKER_NAME='donaldrich/kali-linux'
    DOCKER_NAME_02='heywoodlh/kali-linux'
}
###############
sbin_init_systemd_docker_list() {
    check_docker_installation
    RETURN_TO_WHERE='sbin_init_systemd_docker_list'
    DOCKER_TAG_01='latest'
    CONTAINER_NAME=''
    DOCKER_MANAGEMENT_MENU='01'
    SELECTED_GNU_LINUX=$(whiptail --title "DOCKER IMAGES" --menu "Which distribution image do you want to pull? \nÊÇ®ÊÉ≥Ë¶ÅÊãâÂèñÂì™‰∏™GNU/LinuxÂèëË°åÁâàÁöÑÈïúÂÉè?" 0 50 0 \
        "0" "Return to previous menu ËøîÂõû‰∏äÁ∫ßËèúÂçï" \
        "1" "üëí fedora:Á∫¢Â∏ΩÁ§æÂå∫Áâà,Êñ∞ÊäÄÊúØËØïÈ™åÂú∫" \
        "2" "centos(Âü∫‰∫éÁ∫¢Â∏ΩÁöÑÁ§æÂå∫‰ºÅ‰∏öÊìç‰ΩúÁ≥ªÁªü)" \
        3>&1 1>&2 2>&3)
    #############
    case ${SELECTED_GNU_LINUX} in
    0 | "") tmoe_docker_menu ;;
    1)
        DOCKER_TAG_02='rawhide'
        DOCKER_NAME='fedora'
        ;;
    2)
        DOCKER_TAG_01='latest'
        DOCKER_TAG_02='7'
        DOCKER_NAME='centos'
        CONTAINER_NAME='cent-systemd'
        ;;
    esac
    ###############
    if [ -z "${CONTAINER_NAME}" ]; then
        CONTAINER_NAME=${DOCKER_NAME}-systemd
    fi
    case "${TMOE_QEMU_ARCH}" in
    "") ;;
    *)
        case ${DOCKER_MANAGEMENT_MENU} in
        01 | 03)
            DOCKER_NAME="${NEW_TMOE_ARCH}/${DOCKER_NAME}"
            CONTAINER_NAME="${CONTAINER_NAME}_${CONTAINER_EXT_NAME}"
            ;;
        02)
            CONTAINER_NAME="${CONTAINER_NAME}_${CONTAINER_EXT_NAME}"
            ;;
        esac
        ;;
    esac
    #########
    case ${DOCKER_MANAGEMENT_MENU} in
    01) tmoe_docker_management_menu_01 ;;
    02) tmoe_docker_management_menu_02 ;;
    03) tmoe_docker_management_menu_03 ;;
    esac
    ###########
    press_enter_to_return
    sbin_init_systemd_docker_list
}
#############
choose_gnu_linux_docker_images() {
    check_docker_installation
    RETURN_TO_WHERE='choose_gnu_linux_docker_images'
    DOCKER_TAG_01='latest'
    CONTAINER_NAME=''
    DOCKER_MANAGEMENT_MENU='01'
    SELECTED_GNU_LINUX=$(whiptail --title "DOCKER IMAGES" --menu "Which distribution image do you want to pull? \nÊÇ®ÊÉ≥Ë¶ÅÊãâÂèñÂì™‰∏™GNU/LinuxÂèëË°åÁâàÁöÑÈïúÂÉè?" 0 50 0 \
        "0" "Return to previous menu ËøîÂõû‰∏äÁ∫ßËèúÂçï" \
        "1" "üèîÔ∏è alpine:ÈùûglibcÁöÑÁ≤æÁÆÄÁ≥ªÁªü" \
        "2" "üç• Debian:ÊúÄÊó©ÁöÑÂèëË°åÁâà‰πã‰∏Ä" \
        "3" "üçõ Ubuntu:ÊàëÁöÑÂ≠òÂú®ÊòØÂõ†ÁÇ∫Â§ßÂÆ∂ÁöÑÂ≠òÂú®" \
        "4" "üêâ Kali rolling:ËÆæËÆ°Áî®‰∫éÊï∞Â≠óÂèñËØÅÂíåÊ∏óÈÄèÊµãËØï" \
        "5" "arch:Á≥ªÁªüËÆæËÆ°‰ª•KISS‰∏∫ÊÄª‰ΩìÊåáÂØºÂéüÂàô" \
        "6" "üëí fedora:Á∫¢Â∏ΩÁ§æÂå∫Áâà,Êñ∞ÊäÄÊúØËØïÈ™åÂú∫" \
        "7" "centos(Âü∫‰∫éÁ∫¢Â∏ΩÁöÑÁ§æÂå∫‰ºÅ‰∏öÊìç‰ΩúÁ≥ªÁªü)" \
        "8" "opensuse tumbleweed(Â∞èËú•Ëú¥È£éÊªöËçâ)" \
        "9" "gentoo(ËøΩÊ±ÇÊûÅÈôêÈÖçÁΩÆÂíåÊûÅÈ´òËá™Áî±,stage3-amd64)" \
        "10" "clearlinux(intelÂèëË°åÁöÑÁ≥ªÁªü)" \
        "11" "Void(Âü∫‰∫éxbpsÂåÖÁÆ°ÁêÜÂô®ÁöÑÁã¨Á´ãÂèëË°åÁâà)" \
        "12" "oracle(Áî≤È™®ÊñáÂü∫‰∫éÁ∫¢Â∏ΩÂèëË°åÁöÑÁ≥ªÁªü)" \
        "13" "amazon(‰∫öÈ©¨ÈÄä‰∫ëÊúçÂä°ÂèëË°åÁâà)" \
        "14" "crux(lightweightËΩªÈáèÂåñ)" \
        "15" "openwrt(Â∏∏ËßÅ‰∫éË∑ØÁî±Âô®)" \
        "16" "alt(Ëµ∑Ê∫ê‰∫é‰øÑÁΩóÊñØÁöÑÂèëË°åÁâà)" \
        "17" "photon(VMware‰∏ì‰∏∫ESXiÂÆöÂà∂ÁöÑÂÆπÂô®Á≥ªÁªü)" \
        3>&1 1>&2 2>&3)
    #############
    case ${SELECTED_GNU_LINUX} in
    0 | "") tmoe_docker_menu ;;
    1)
        DOCKER_TAG_02='edge'
        DOCKER_NAME='alpine'
        ;;
    2)
        DOCKER_TAG_01='unstable'
        DOCKER_TAG_02='stable'
        DOCKER_NAME='debian'
        ;;
    3)
        DOCKER_TAG_02='devel'
        DOCKER_NAME='ubuntu'
        ;;
    4)
        CONTAINER_NAME='kali'
        case ${TMOE_QEMU_ARCH} in
        x86_64) kali_docker_amd64 ;;
        arm) kali_docker_armhf ;;
        aarch64 | i386) kali_docker_arm64 ;;
        "")
            case ${TRUE_ARCH_TYPE} in
            amd64) kali_docker_amd64 ;;
            armhf) kali_docker_armhf ;;
            arm64 | i386) kali_docker_arm64 ;;
            *) arch_does_not_support ;;
            esac
            ;;
        *) arch_does_not_support ;;
        esac
        DOCKER_MANAGEMENT_MENU='02'
        ;;
    5)
        CONTAINER_NAME='arch'
        case ${TMOE_QEMU_ARCH} in
        x86_64) arch_docker_amd64 ;;
        arm | aarch64) arch_docker_arm64 ;;
        "")
            case ${TRUE_ARCH_TYPE} in
            amd64) arch_docker_amd64 ;;
            arm*) arch_docker_arm64 ;;
            *) arch_does_not_support ;;
            esac
            ;;
        *) arch_does_not_support ;;
        esac
        ;;
    6)
        DOCKER_TAG_02='rawhide'
        DOCKER_NAME='fedora'
        ;;
    7)
        DOCKER_TAG_01='latest'
        DOCKER_TAG_02='7'
        DOCKER_NAME='centos'
        CONTAINER_NAME='cent'
        ;;
    8)
        CONTAINER_NAME='suse'
        not_adapted_across_architecture
        DOCKER_NAME='opensuse/tumbleweed'
        DOCKER_NAME_02='opensuse/leap'
        DOCKER_MANAGEMENT_MENU='02'
        ;;
    9)
        CONTAINER_NAME='gentoo'
        case ${TMOE_QEMU_ARCH} in
        x86_64) gentoo_stage3_amd64 ;;
        i386) gentoo_stage3_i386 ;;
        arm | aarch64) gentoo_stage3_armhf ;;
        "")
            case ${TRUE_ARCH_TYPE} in
            amd64) gentoo_stage3_amd64 ;;
            i386) gentoo_stage3_i386 ;;
            arm*) gentoo_stage3_armhf ;;
            *) arch_does_not_support ;;
            esac
            ;;
        *) arch_does_not_support ;;
        esac
        DOCKER_MANAGEMENT_MENU='02'
        ;;
    10)
        only_support_amd64_container
        CONTAINER_NAME='clear'
        DOCKER_TAG_01='latest'
        DOCKER_TAG_02='base'
        DOCKER_NAME='clearlinux'
        ;;
    11)
        DOCKER_NAME='voidlinux/voidlinux'
        DOCKER_NAME_02='voidlinux/voidlinux-musl'
        CONTAINER_NAME='void'
        DOCKER_MANAGEMENT_MENU='02'
        ;;
    12)
        only_support_amd64_container
        DOCKER_TAG_02='7'
        DOCKER_NAME='oraclelinux'
        CONTAINER_NAME='oracle'
        ;;
    13)
        only_support_amd64_and_arm64v8_container
        DOCKER_TAG_02='with-sources'
        DOCKER_NAME='amazonlinux'
        CONTAINER_NAME='amazon'
        ;;
    14)
        only_support_amd64_and_arm64v8_container
        DOCKER_TAG_02='3.4'
        DOCKER_NAME='crux'
        ;;
    15)
        CONTAINER_NAME='openwrt'
        ########
        case ${TMOE_QEMU_ARCH} in
        x86_64) openwrt_docker_amd64 ;;
        aarch64) openwrt_docker_arm64 ;;
        "")
            case ${TRUE_ARCH_TYPE} in
            amd64) openwrt_docker_amd64 ;;
            arm64) openwrt_docker_arm64 ;;
            *) arch_does_not_support ;;
            esac
            ;;
        *) arch_does_not_support ;;
        esac
        ;;
    16)
        DOCKER_TAG_02='sisyphus'
        DOCKER_NAME='alt'
        ;;
    17)
        only_support_amd64_and_arm64v8_container
        DOCKER_TAG_02='2.0'
        DOCKER_NAME='photon'
        ;;
    esac
    ###############
    if [ -z "${CONTAINER_NAME}" ]; then
        CONTAINER_NAME=${DOCKER_NAME}
    fi
    case "${TMOE_QEMU_ARCH}" in
    "") ;;
    *)
        case ${DOCKER_MANAGEMENT_MENU} in
        01 | 03)
            DOCKER_NAME="${NEW_TMOE_ARCH}/${DOCKER_NAME}"
            CONTAINER_NAME="${CONTAINER_NAME}_${CONTAINER_EXT_NAME}"
            ;;
        02)
            CONTAINER_NAME="${CONTAINER_NAME}_${CONTAINER_EXT_NAME}"
            ;;
        esac
        ;;
    esac
    #########
    case ${DOCKER_MANAGEMENT_MENU} in
    01) tmoe_docker_management_menu_01 ;;
    02) tmoe_docker_management_menu_02 ;;
    03) tmoe_docker_management_menu_03 ;;
    esac
    ###########
    press_enter_to_return
    choose_gnu_linux_docker_images
}
#############
install_docker_ce_or_io() {
    case "${TMOE_PROOT}" in
    true)
        printf "%s\n" "${RED}WARNINGÔºÅ${RESET}Ê£ÄÊµãÂà∞ÊÇ®ÂΩìÂâçÂ§Ñ‰∫é${GREEN}prootÂÆπÂô®${RESET}ÁéØÂ¢É‰∏ãÔºÅ"
        printf "%s\n" "Ëã•ÊÇ®Â§Ñ‰∫éÂÆπÂô®ÁéØÂ¢É‰∏ã,‰∏îÂÆø‰∏ªÊú∫‰∏∫${BOLD}Android${RESET}Á≥ªÁªüÔºåÂàôËØ∑Âú®ÂÆâË£ÖÂâç${BLUE}Á°Æ‰øù${RESET}ÊÇ®ÁöÑLinuxÂÜÖÊ†∏ÊîØÊåÅdocker"
        printf "%s\n" "Âê¶ÂàôËØ∑ÈÄöËøáqemu-systemÊù•ËøêË°åGNU/LinuxËôöÊãüÊú∫ÔºåÂÜçÂÆâË£Ödocker„ÄÇ"
        printf "%s\n" "If your host is android, it is recommended that you use qemu-system virtual machine to run docker."
        do_you_want_to_continue
        ;;
    false) printf "%s\n" "Ê£ÄÊµãÂà∞ÊÇ®ÂΩìÂâçÂ§Ñ‰∫échrootÂÆπÂô®ÁéØÂ¢É‰∏ã" ;;
    esac
    if (whiptail --title "DOCKERÊú¨‰Ωì" --yes-button 'docker-ce' --no-button 'docker.io' --yesno "Please make sure your linux kernel supports docker.\nÂÆâË£ÖÂâçËØ∑ÂÖàÁ°Æ‰øùÊÇ®ÁöÑlinuxÂÜÖÊ†∏ÊîØÊåÅdocker„ÄÇ‰∏∫ÈÅøÂÖçÂÜ≤Á™Å,ËØ∑Âè™ÈÄâÊã©ÂÖ∂‰∏≠‰∏Ä‰∏™„ÄÇ" 0 50); then
        install_docker_ce
    else
        install_docker_io
    fi
    docker version
}
##############
add_current_user_to_docker_group() {
    printf "%s\n" "Do you want to add ${CURRENT_USER_NAME} to docker group?"
    printf "%s\n" "${YELLOW}gpasswd -a ${CURRENT_USER_NAME} docker${RESE}"
    do_you_want_to_continue
    if [ ! "$(groups | grep docker)" ]; then
        groupadd docker
    fi
    gpasswd -a ${CURRENT_USER_NAME} docker
    printf "%s\n" "ÊÇ®ÂèØ‰ª•ÊâãÂä®ÊâßË°å${GREEN}newgrp docker${RESET}Êù•Âà∑Êñ∞dockerÁî®Êà∑ÁªÑ"
    printf "%s\n" "If you want to remove it,then type ${RED}gpasswd -d ${CURRENT_USER_NAME} docker${RESET}"
    printf "%s\n" "Ëã•ÊÇ®ÈúÄË¶ÅÂ∞ÜÂΩìÂâçÁî®Êà∑ÁßªÂá∫dockerÁî®Êà∑ÁªÑÔºåÂàôËØ∑Ëæì${RED}gpasswd -d ${CURRENT_USER_NAME} docker${RESET}"
}
##########
docker_163_mirror() {
    if [ ! -d /etc/docker ]; then
        mkdir -pv /etc/docker
    fi
    cd /etc/docker
    if [ ! -e daemon.json ]; then
        printf "\n" >daemon.json
    fi
    if ! grep -q 'registry-mirrors' "daemon.json"; then
        cat >>daemon.json <<-'EOF'
		
			{
			"registry-mirrors": [
			"https://hub-mirror.c.163.com/"
			]
			}
		EOF
    else
        cat <<-'EOF'
			Ê£ÄÊµãÂà∞ÊÇ®Â∑≤ÁªèËÆæÂÆö‰∫Üregistry-mirrors,ËØ∑ÊâãÂä®‰øÆÊîπdaemon.json‰∏∫‰ª•‰∏ãÈÖçÁΩÆ„ÄÇ
			{
			"registry-mirrors": [
			"https://hub-mirror.c.163.com/"
			]
			}
		EOF
    fi
}
##########
docker_mirror_source() {
    RETURN_TO_WHERE='docker_mirror_source'
    VIRTUAL_TECH=$(
        whiptail --title "DOCKER MIRROR" --menu "ÊÇ®ÊÉ≥Ë¶Å‰øÆÊîπÂì™‰∫õdockerÈÖçÁΩÆÔºü" 0 0 0 \
            "1" "163ÈïúÂÉè" \
            "2" "edit daemon.json" \
            "3" "edit software sourceËΩØ‰ª∂Êú¨‰ΩìÊ∫ê" \
            "4" "remove docker-ce.list" \
            "0" "üåö Return to previous menu ËøîÂõû‰∏äÁ∫ßËèúÂçï" \
            3>&1 1>&2 2>&3
    )
    #############
    case ${VIRTUAL_TECH} in
    0 | "") tmoe_docker_menu ;;
    1) docker_163_mirror ;;
    2) nano /etc/docker/daemon.json ;;
    3)
        non_debian_function
        check_editor
        ${EDITOR} /etc/apt/sources.list.d/docker-ce.list
        ;;
    4)
        printf "%s\n" "${RED}rm -fv ${BLUE}/etc/apt/sources.list.d/docker-ce.list /etc/apt/sources.list.d/docker.list /usr/share/keyrings/docker-ce-archive-keyring.gpg${RESET}"
        do_you_want_to_continue
        rm -fv /etc/apt/sources.list.d/docker-ce.list /etc/apt/sources.list.d/docker.list /usr/share/keyrings/docker-ce-archive-keyring.gpg
        ;;
    esac
    ###############
    press_enter_to_return
    docker_mirror_source
}
##########
tmoe_docker_menu() {
    RETURN_TO_WHERE='tmoe_docker_menu'
    # RETURN_TO_MENU='tmoe_docker_menu'
    SYSTEMD_DOCKER=false
    TMOE_QEMU_ARCH=""
    VIRTUAL_TECH=$(
        whiptail --title "DOCKERÂÆπÂô®" --menu "ÊÇ®ÊÉ≥Ë¶ÅÂØπdockerÂ∞èÂèØÁà±ÂÅö‰ªÄ‰πà?" 0 0 0 \
            "1" "üåÅ cross-architecture(Ë∑®CPUÊû∂ÊûÑËøêË°ådockerÂÆπÂô®)" \
            "2" "ü•õ systemd-docker(ÊîØÊåÅsystemctlÁöÑdockerÂÆπÂô®)" \
            "3" "üç≠ pull distro images(ÊãâÂèñalpine,debianÂíåubuntuÈïúÂÉè)" \
            "4" "üåâ portainer(webÁ´ØÂõæÂΩ¢ÂåñdockerÂÆπÂô®ÁÆ°ÁêÜ)" \
            "5" "export container ÂØºÂá∫ÂÆπÂô®(Â§á‰ªΩ)" \
            "6" "import image ÂØºÂÖ•ÈïúÂÉè(ÊÅ¢Â§ç)" \
            "7" "üç• mirror sourceÈïúÂÉèÊ∫ê" \
            "8" "üêã install docker-ce(ÂÆâË£ÖdockerÁ§æÂå∫ÁâàÂºïÊìé)" \
            "9" "add ${CURRENT_USER_NAME} to docker group(Ê∑ªÂä†ÂΩìÂâçÁî®Êà∑Ëá≥dockerÁî®Êà∑ÁªÑ)" \
            "0" "üåö Return to previous menu ËøîÂõû‰∏äÁ∫ßËèúÂçï" \
            3>&1 1>&2 2>&3
    )
    #############
    case ${VIRTUAL_TECH} in
    0 | "") install_container_and_virtual_machine ;;
    1) run_docker_across_architectures ;;
    2) systemd_docker_env ;;
    3) choose_gnu_linux_docker_images ;;
    4) install_docker_portainer ;;
    5) export_docker_image_menu ;;
    6) import_docker_image_menu ;;
    7) docker_mirror_source ;;
    8) install_docker_ce_or_io ;;
    9) add_current_user_to_docker_group ;;
    esac
    ###############
    press_enter_to_return
    tmoe_docker_menu
}
############
case_tar_file_and_extract() {
    cd ${FILE_PATH}
    case "${SELECTION:0-6:6}" in
    tar.xz)
        xz -d -k -v "${TMOE_FILE_ABSOLUTE_PATH}"
        TMOE_TAR_ITEM="${SELECTION%???}"
        chmod -v a+rw ${TMOE_TAR_ITEM}
        docker_import_command
        # rm -fv ${TMOE_TAR_ITEM}
        ;;
    tar.gz)
        gzip -d -k -v "${TMOE_FILE_ABSOLUTE_PATH}"
        TMOE_TAR_ITEM="${SELECTION%???}"
        chmod -v a+rw ${TMOE_TAR_ITEM}
        docker_import_command
        # rm -fv ${TMOE_TAR_ITEM}
        ;;
    ar.zst)
        zstd -dv "${TMOE_FILE_ABSOLUTE_PATH}"
        TMOE_TAR_ITEM="${SELECTION%????}"
        chmod -v a+rw ${TMOE_TAR_ITEM}
        docker_import_command
        # rm -fv ${TMOE_TAR_ITEM}
        ;;
    *)
        TMOE_TAR_ITEM="${TMOE_FILE_ABSOLUTE_PATH}"
        docker_import_command
        ;;
    esac
}
###############
docker_import_command() {
    ls -lah "${TMOE_TAR_ITEM}"
    DOCKER_NAME=$(printf "%s\n" "${SELECTION}" | sed -e 's@.tar.*@@' -e 's@_bak-.*@@' -e 's@+@-@')
    DOCKER_TAG=$(date +%Y-%m-%d_%H-%M)
    printf "%s\n" "${GREEN}docker ${PURPLE}import - ${BLUE}${DOCKER_NAME}:${YELLOW}${DOCKER_TAG} ${RED}<${BLUE}${TMOE_TAR_ITEM}${RESET}"
    do_you_want_to_continue
    docker import - ${DOCKER_NAME}:${DOCKER_TAG} <${TMOE_TAR_ITEM}
}
###############
import_docker_image_menu() {
    RETURN_TO_WHERE='tmoe_docker_menu'
    FILE_EXT_01='tar'
    FILE_EXT_02='tar.*'
    #where_is_tmoe_file_dir
    for i in "${HOME}/sd/Download/backup/rootfs" "/media/sd/Download/backup/rootfs" "${HOME}/sd" "${HOME}"; do
        if [[ -d ${i} ]]; then
            START_DIR="${i}"
            break
        fi
    done
    IMPORTANT_TIPS='ÊÇ®ÂèØ‰ª•ÈÄâÊã©tmoeÊØèÂë®ÊûÑÂª∫ÁâàÈïúÂÉè,‰πüÂèØ‰ª•ÈÄâÊã©Êú¨Âú∞tarÊñá‰ª∂'
    tmoe_file_manager
    if [ -z ${SELECTION} ]; then
        printf "%s\n" "Ê≤°ÊúâÊåáÂÆö${YELLOW}ÊúâÊïà${RESET}ÁöÑ${BLUE}Êñá‰ª∂${GREEN}ÔºåËØ∑${GREEN}ÈáçÊñ∞${RESET}ÈÄâÊã©"
    else
        printf "%s\n" "ÊÇ®ÈÄâÊã©ÁöÑÊñá‰ª∂‰∏∫${TMOE_FILE_ABSOLUTE_PATH}"
        stat "${TMOE_FILE_ABSOLUTE_PATH}"
        ls -lah "${TMOE_FILE_ABSOLUTE_PATH}"
        do_you_want_to_continue
        case_tar_file_and_extract
        printf "%s\n" "${GREEN}docker ${BLUE}images${RESET}"
        docker images
        please_type_the_container_name
        printf "%s\n" "Do you want to run this container now?"
        if [[ -d /media/docker ]]; then
            MOUNT_DOCKER_FOLDER=/media/docker
            printf "%s\n" "${BLUE}docker run -itd --name ${CONTAINER_NAME} --env LANG=${TMOE_LANG} --restart on-failure -v ${MOUNT_DOCKER_FOLDER}:${MOUNT_DOCKER_FOLDER} ${DOCKER_NAME}:${DOCKER_TAG} sh${RESET}"
        else
            printf "%s\n" "${BLUE}docker run -itd --name ${CONTAINER_NAME} --env LANG=${TMOE_LANG} --restart on-failure ${DOCKER_NAME}:${DOCKER_TAG} sh${RESET}"
        fi
        do_you_want_to_continue

        if [[ -d /media/docker ]]; then
            docker run -itd --name ${CONTAINER_NAME} --env LANG=${TMOE_LANG} --restart on-failure -v ${MOUNT_DOCKER_FOLDER}:${MOUNT_DOCKER_FOLDER} ${DOCKER_NAME}:${DOCKER_TAG} sh
        else
            docker run -itd --name ${CONTAINER_NAME} --env LANG=${TMOE_LANG} --restart on-failure ${DOCKER_NAME}:${DOCKER_TAG} sh
        fi
        printf "%s\n" "You can run ${GREEN}docker exec ${BLUE}-it ${YELLOW}${CONTAINER_NAME} ${RED}sh${RESET} to attach it."
    fi
}
please_type_the_container_name() {
    CONTAINER_NAME=$(whiptail --inputbox "Please type the container name\nËØ∑ËæìÂÖ•ÂÆπÂô®Êñá‰ª∂ÂêçÁß∞,Ëã•ÁïôÁ©∫ÂàôÂ∞ÜËá™Âä®ÂëΩÂêç‰∏∫${DOCKER_NAME}" 0 50 --title "CONTAINER NAME" 3>&1 1>&2 2>&3)
    if [ -z "${CONTAINER_NAME}" ]; then
        CONTAINER_NAME="${DOCKER_NAME}"
    fi
}
export_docker_image_menu() {
    RETURN_TO_WHERE='export_docker_image_menu'
    cd /tmp/
    docker ps -a | awk '{print $NF}' | sed '1d' >.tmoe-linux_cache.01
    docker ps -a | awk '{print $2}' | sed '1d' >.tmoe-linux_cache.02
    TMOE_CONTAINER_LIST=$(paste -d ' ' .tmoe-linux_cache.01 .tmoe-linux_cache.02 | sed ":a;N;s/\n/ /g;ta")
    rm -f .tmoe-linux_cache.0*
    DOCKER_NAME=$(whiptail --title "CONTAINER LIST" --menu \
        "Which container do you want to backup?" 0 0 0 \
        ${TMOE_CONTAINER_LIST} \
        "0" "üåö Return to previous menu ËøîÂõû‰∏äÁ∫ßËèúÂçï" \
        3>&1 1>&2 2>&3)
    case ${DOCKER_NAME} in
    0 | "") tmoe_docker_menu ;;
    esac
    type_the_file_path
    DOCKER_BAK_FILE="${TARGET}/${DOCKER_NAME}_bak-$(date +%Y-%m-%d_%H-%M).tar"
    printf "%s\n" "${GREEN}docker export ${BLUE}${DOCKER_NAME} ${PURPLE}> ${YELLOW}${DOCKER_BAK_FILE}${RESET}"
    do_you_want_to_continue
    docker export ${DOCKER_NAME} >${DOCKER_BAK_FILE}
    if [[ ${HOME} != /root ]]; then
        chown -v ${CURRENT_USER_NAME}:${CURRENT_USER_GROUP} ${DOCKER_BAK_FILE}
        chmod -v a+rw ${DOCKER_BAK_FILE}
    fi
    stat ${DOCKER_BAK_FILE}
    ls -lah ${DOCKER_BAK_FILE}
}
##########
type_the_file_path() {
    for i in "${HOME}/sd/Download/backup/rootfs" "/media/sd/Download/backup/rootfs" "${HOME}/sd" "${HOME}"; do
        if [[ -d ${i} ]]; then
            START_DIR="${i}"
            break
        fi
    done
    TARGET=$(whiptail --inputbox "Please type the file path\nËØ∑ËæìÂÖ•Êñá‰ª∂‰øùÂ≠òË∑ØÂæÑÔºåËã•ÁïôÁ©∫ÂàôËæìÂá∫Ëá≥${START_DIR}" 0 50 --title "FILE DIR" 3>&1 1>&2 2>&3)
    if [ "${?}" != "0" ]; then
        ${RETURN_TO_WHERE}
    elif [ -z "${TARGET}" ]; then
        TARGET="${START_DIR}"
    elif [[ ! -x ${TARGET} ]]; then
        printf "%s\n" "${RED}ERROR${RESET},please retype."
        printf "%s\n" "Êñá‰ª∂Ë∑ØÂæÑ‰∏çÂ≠òÂú®ÊàñÊó†Ê≥ïË¢´ËÆøÈóÆÔºåËØ∑ÈáçÊñ∞ËæìÂÖ•„ÄÇ"
        press_enter_to_return
        type_the_file_path
    fi
}
systemd_docker_env() {
    #printf "%s\n" Êú¨ÂäüËÉΩÊ≠£Âú®ÂºÄÂèë‰∏≠...
    #press_enter_to_return
    SYSTEMD_DOCKER=true
    run_docker_across_architectures
}
apt_install_qemu_user_static() {
    DEPENDENCY_01='qemu-user-static'
    DEPENDENCY_02=''
    beta_features_quick_install
    if [ ! -e "/usr/bin/qemu-aarch64-static" ]; then
        cat <<-'EOF'
        ÂÆâË£ÖÂ§±Ë¥•ÔºåËØ∑ÊâãÂä®ÊâßË°å‰ª•‰∏ãÂëΩ‰ª§ÔºåÊàñÈÄöËøáÂÆâË£ÖÂåÖÊù•ÂÆâË£Ö„ÄÇ
        docker pull multiarch/qemu-user-static:register
        docker run --rm --privileged multiarch/qemu-user-static:register
EOF
    fi
}
############
tmoe_qemu_user_static() {
    RETURN_TO_WHERE='tmoe_qemu_user_static'
    BETA_SYSTEM=$(
        whiptail --title "qemu_user_static" --menu "You can use qemu-user-static to run docker containers cross-architecture." 0 50 0 \
            "1" "chartÊû∂ÊûÑÊîØÊåÅË°®Ê†º" \
            "2" "install via software source(ÈÄöËøáËΩØ‰ª∂Ê∫êÂÆâË£Ö)" \
            "3" "install/upgrade(ÈÄöËøáÂÆâË£ÖÂåÖÊù•ÂÆâË£Ö/Êõ¥Êñ∞)" \
            "4" "remove(ÁßªÈô§/Âç∏ËΩΩ)" \
            "0" "üåö Return to previous menu ËøîÂõû‰∏äÁ∫ßËèúÂçï" \
            3>&1 1>&2 2>&3
    )
    ##############################
    case "${BETA_SYSTEM}" in
    0 | "") run_docker_across_architectures ;;
    1) tmoe_qemu_user_chart ;;
    2) apt_install_qemu_user_static ;;
    3) install_qemu_user_static ;;
    4) remove_qemu_user_static ;;
    esac
    ######################
    press_enter_to_return
    tmoe_qemu_user_static
}
#####################
tmoe_qemu_user_chart() {
    cat <<-'ENDofTable'
		‰∏ãË°®‰∏≠ÁöÑÊâÄÊúâÁ≥ªÁªüÂùáÊîØÊåÅx64(amd64)Âíåarm64
		*Ë°®Á§∫‰ªÖÊóßÁâàÊîØÊåÅ
			‚ïî‚ïê‚ïê‚ïê‚ï¶‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï¶‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï¶‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï¶‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï¶
			‚ïë   ‚ïëArchitecture‚ïë        ‚ïë        ‚ïë         ‚ïë
			‚ïë   ‚ïë----------- ‚ïë x86    ‚ïëarmhf   ‚ïëppc64el  ‚ïë
			‚ïë   ‚ïëSystem      ‚ïë        ‚ïë        ‚ïë         ‚ïë
			‚ïë---‚ïë------------‚ïë--------‚ïë--------‚ïë---------‚ïë
			‚ïë 1 ‚ïë  Debian    ‚ïë  ‚úì     ‚ïë    ‚úì   ‚ïë   ‚úì     ‚ïë
			‚ïë   ‚ïë            ‚ïë        ‚ïë        ‚ïë         ‚ïë
			‚ïë---‚ïë------------‚ïë--------‚ïë--------‚ïë---------‚ïë
			‚ïë   ‚ïë            ‚ïë        ‚ïë        ‚ïë         ‚ïë
			‚ïë 2 ‚ïë  Ubuntu    ‚ïë*<=19.10‚ïë   ‚úì    ‚ïë   ‚úì     ‚ïë
			‚ïë---‚ïë------------‚ïë--------‚ïë--------‚ïë---------‚ïë
			‚ïë   ‚ïë            ‚ïë        ‚ïë        ‚ïë         ‚ïë
			‚ïë 3 ‚ïë Kali       ‚ïë  ‚úì     ‚ïë   ‚úì    ‚ïë    X    ‚ïë
			‚ïë---‚ïë------------‚ïë--------‚ïë--------‚ïë---------‚ïë
			‚ïë   ‚ïë            ‚ïë        ‚ïë        ‚ïë         ‚ïë
			‚ïë 4 ‚ïë Arch       ‚ïë  X     ‚ïë   ‚úì    ‚ïë   X     ‚ïë
			‚ïë---‚ïë------------‚ïë--------‚ïë--------‚ïë---------‚ïë
			‚ïë   ‚ïë            ‚ïë        ‚ïë        ‚ïë         ‚ïë
			‚ïë 5 ‚ïë Fedora     ‚ïë *<=29  ‚ïë   ‚úì    ‚ïë  ‚úì      ‚ïë
			‚ïë---‚ïë------------‚ïë--------‚ïë--------‚ïë---------‚ïë
			‚ïë   ‚ïë            ‚ïë        ‚ïë        ‚ïë         ‚ïë
			‚ïë 6 ‚ïë  Alpine    ‚ïë  ‚úì     ‚ïë    ‚úì   ‚ïë   ‚úì     ‚ïë
			‚ïë---‚ïë------------‚ïë--------‚ïë--------‚ïë---------‚ïë
			‚ïë   ‚ïë            ‚ïë        ‚ïë        ‚ïë         ‚ïë
			‚ïë 7 ‚ïë Centos     ‚ïë *<=7   ‚ïë *<=7   ‚ïë   ‚úì     ‚ïë
	ENDofTable
}
###############
install_qemu_user_static() {
    printf "%s\n" "Ê≠£Âú®Ê£ÄÊµãÁâàÊú¨‰ø°ÊÅØ..."
    LOCAL_QEMU_USER_FILE=''
    #if [ -e "/usr/local/bin/qemu-aarch64-static" ]; then
    #   LOCAL_QEMU_USER_FILE='/usr/local/bin/qemu-aarch64-static'
    if [ -e "/usr/bin/qemu-aarch64-static" ]; then
        LOCAL_QEMU_USER_FILE='/usr/bin/qemu-aarch64-static'
    fi
    case ${LOCAL_QEMU_USER_FILE} in
    "") LOCAL_QEMU_USER_VERSION='ÊÇ®Â∞öÊú™ÂÆâË£ÖQEMU-USER-STATIC' ;;
    *) LOCAL_QEMU_USER_VERSION=$(${LOCAL_QEMU_USER_FILE} --version | head -n 1 | awk '{print $5}' | cut -d ':' -f 2 | cut -d ')' -f 1) ;;
    esac

    cat <<-'EOF'
		---------------------------
		‰∏ÄËà¨Êù•ËØ¥ÔºåÊñ∞ÁâàÁöÑqemu-user‰ºöÂºïÂÖ•Êñ∞ÁöÑÂäüËÉΩÔºåÂπ∂Â∏¶Êù•ÊÄßËÉΩ‰∏äÁöÑÊèêÂçá„ÄÇ
		Â∞ΩÁÆ°ÊúâÂèØËÉΩ‰ºöÂºïÂÖ•‰∏Ä‰∫õÊñ∞bugÔºå‰ΩÜÊòØ‰πüÊúâÂèØËÉΩ‰øÆÂ§ç‰∫ÜÊóßÁâàÁöÑbug„ÄÇ
		We recommend that you to use the new version.
		---------------------------
	EOF
    check_qemu_user_version
    cat <<-ENDofTable
		‚ïî‚ïê‚ïê‚ïê‚ï¶‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï¶‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï¶‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
		‚ïë   ‚ïë          ‚ïë                   ‚ïë                    
		‚ïë   ‚ïë software ‚ïë    ‚ú®ÊúÄÊñ∞ÁâàÊú¨     ‚ïë   Êú¨Âú∞ÁâàÊú¨ üé™
		‚ïë   ‚ïë          ‚ïë  Latest version   ‚ïë  Local version     
		‚ïë---‚ïë----------‚ïë-------------------‚ïë--------------------
		‚ïë 1 ‚ïëqemu-user ‚ïë                    ${LOCAL_QEMU_USER_VERSION} 
		‚ïë   ‚ïë static   ‚ïë$(printf '%s\n' "${THE_LATEST_DEB_VERSION_CODE}" | sed 's@%2B@+@')

	ENDofTable
    do_you_want_to_continue
    THE_LATEST_DEB_LINK="${REPO_URL}${THE_LATEST_DEB_VERSION}"
    printf "%s\n" "${THE_LATEST_DEB_LINK}"
    #printf "%s\n" "${THE_LATEST_DEB_VERSION_CODE}" >${QEMU_USER_LOCAL_VERSION_FILE}
    download_qemu_user
    unxz_deb_file
}
##############
check_qemu_user_version() {
    REPO_URL='https://mirrors.bfsu.edu.cn/debian/pool/main/q/qemu/'
    THE_LATEST_DEB_VERSION="$(curl -L ${REPO_URL} | grep '\.deb' | grep 'qemu-user-static' | grep "${TRUE_ARCH_TYPE}" | tail -n 1 | cut -d '=' -f 3 | cut -d '"' -f 2)"
    THE_LATEST_DEB_VERSION_CODE=$(printf '%s\n' "${THE_LATEST_DEB_VERSION}" | cut -d '_' -f 2)
}
###############
unxz_deb_file() {
    if [ ! $(command -v ar) ]; then
        DEPENDENCY_01='binutils'
        DEPENDENCY_02=''
        beta_features_quick_install
    fi
    ar xv ${THE_LATEST_DEB_VERSION}
    #tar -Jxvf data.tar.xz ./usr/bin -C $PREFIX/..
    #tar -Jxvf data.tar.xz
    cd /
    tar -Jxvf ${TMPDIR}/${TEMP_FOLDER}/data.tar.xz ./usr/bin
    #cp -rf ./usr/bin /usr
    #cd ..
    rm -rvf ${TMPDIR}/${TEMP_FOLDER}
    docker run --rm --privileged multiarch/qemu-user-static:register
}
########################
download_qemu_user() {
    cd ${TMPDIR}
    TEMP_FOLDER='.QEMU_USER_BIN'
    mkdir -pv ${TEMP_FOLDER}
    cd ${TEMP_FOLDER}
    aria2c --console-log-level=warn --no-conf --allow-overwrite=true -s 5 -x 5 -k 1M -o "${THE_LATEST_DEB_VERSION}" "${THE_LATEST_DEB_LINK}"
}
##############
remove_qemu_user_static() {
    ls -lah /usr/bin/qemu-*-static 2>/dev/null
    printf "%s\n" "${RED}rm -rv${RESET} ${BLUE}/usr/bin/qemu-*-static${RESET}"
    printf "%s\n" "${RED}${TMOE_REMOVAL_COMMAND}${RESET} ${BLUE}qemu-user-static${RESET}"
    do_you_want_to_continue
    rm -rvf /usr/bin/qemu-*-static
    ${TMOE_REMOVAL_COMMAND} qemu-user-static
}
##############
run_docker_across_architectures() {
    check_docker_installation
    TMOE_QEMU_ARCH=""
    BETA_SYSTEM=$(
        whiptail --title "Ë∑®Êû∂ÊûÑËøêË°åÂÆπÂô®" --menu "ÊÇ®ÊÉ≥Ë¶Å(Ê®°Êãü)ËøêË°åÂì™‰∏™Êû∂ÊûÑÔºü\nWhich architecture do you want to simulate?" 0 50 0 \
            "0" "üåö Return to previous menu ËøîÂõû‰∏äÁ∫ßËèúÂçï" \
            "00" "qemu-user-staticÁÆ°ÁêÜ(Ë∑®Êû∂ÊûÑÊ®°ÊãüÊâÄÈúÄÁöÑÂü∫Á°Ä‰æùËµñ)" \
            "1" "x64/amd64(64‰ΩçÊû∂ÊûÑ,Â∫îÁî®‰∫épcÂíåÊúçÂä°Âô®Ôºâ" \
            "2" "arm64v8/aarch64(Â∏∏ËßÅ‰∫éÁßªÂä®Âπ≥Âè∞ÁöÑ64‰ΩçcpuÊû∂ÊûÑÔºâ" \
            "3" "i386(Â∏∏ËßÅ‰∫é32‰ΩçcpuÁöÑÊóßÂºè‰º†Áªüpc)" \
            "4" "arm32v7/armhf(32‰ΩçarmÊû∂ÊûÑ,ÊîØÊåÅÁ°¨ÊµÆÁÇπËøêÁÆó)" \
            "5" "ppc64le(PowerPC,Â∏∏Áî®‰∫éÈÄö‰ø°„ÄÅÂ∑•Êéß„ÄÅËà™Â§©ÂõΩÈò≤Á≠âÈ¢ÜÂüü)" \
            "6" "s390x(Â∏∏ËßÅ‰∫éIBMÂ§ßÂûãÊú∫)" \
            3>&1 1>&2 2>&3
    )
    ##############################
    case "${BETA_SYSTEM}" in
    0 | "") tmoe_docker_menu ;;
    00) tmoe_qemu_user_static ;;
    1)
        NEW_TMOE_ARCH='amd64'
        CONTAINER_EXT_NAME='x64'
        case ${TRUE_ARCH_TYPE} in
        amd64) ;;
        *) TMOE_QEMU_ARCH="x86_64" ;;
        esac
        ;;
    2)
        NEW_TMOE_ARCH='arm64v8'
        CONTAINER_EXT_NAME='arm64'
        case ${TRUE_ARCH_TYPE} in
        arm64) ;;
        *) TMOE_QEMU_ARCH="aarch64" ;;
        esac
        ;;
    3)
        NEW_TMOE_ARCH='i386'
        CONTAINER_EXT_NAME='x86'
        case ${TRUE_ARCH_TYPE} in
        i386) ;;
        *) TMOE_QEMU_ARCH="${NEW_TMOE_ARCH}" ;;
        esac
        ;;
    4)
        NEW_TMOE_ARCH='arm32v7'
        CONTAINER_EXT_NAME='arm'
        case ${TRUE_ARCH_TYPE} in
        armhf) ;;
        *) TMOE_QEMU_ARCH="arm" ;;
        esac
        ;;
    5)
        NEW_TMOE_ARCH='ppc64le'
        CONTAINER_EXT_NAME='ppc'
        case ${TRUE_ARCH_TYPE} in
        ppc64el) ;;
        *) TMOE_QEMU_ARCH="ppc64le" ;;
        esac
        ;;
    6)
        NEW_TMOE_ARCH='s390x'
        CONTAINER_EXT_NAME='s390'
        case ${TRUE_ARCH_TYPE} in
        s390x) ;;
        *) TMOE_QEMU_ARCH="s390x" ;;
        esac
        ;;
    esac
    ######################
    if [ ! -e "/usr/bin/qemu-x86_64-static" ]; then
        install_qemu_user_static
    fi
    case ${SYSTEMD_DOCKER} in
    true) sbin_init_systemd_docker_list ;;
    *) choose_gnu_linux_docker_images ;;
    esac
    press_enter_to_return
    run_docker_across_architectures
}
#####################
debian_add_docker_gpg() {
    if [ "${DEBIAN_DISTRO}" = 'ubuntu' ]; then
        DOCKER_RELEASE='ubuntu'
    else
        DOCKER_RELEASE='debian'
    fi
    DOCKER_TUNA_CODE_LIST=$(curl -L "https://mirrors.bfsu.edu.cn/docker-ce/linux/${DOCKER_RELEASE}/dists/" | grep link | awk -F 'title=' '{print $2}' | cut -d '"' -f 2)
    DOCKER_LIST=$(printf "%s\n" $DOCKER_TUNA_CODE_LIST | sed "s@\$@ .deb@g" | tr '\n' ' ')
    DOCKER_CODE=$(
        whiptail --title "DISTRO CODE & DOCKER VERSION" --menu \
            "Which version do you want to choose?" 0 0 0 \
            ${DOCKER_LIST} \
            3>&1 1>&2 2>&3
    )
    curl -L "https://mirrors.bfsu.edu.cn/docker-ce/linux/${DOCKER_RELEASE}/gpg" | gpg --dearmor >/tmp/docker-ce.gpg
    install -o root -g root -m 644 /tmp/docker-ce.gpg /usr/share/keyrings/docker-ce-archive-keyring.gpg
    ls -lah /usr/share/keyrings/docker-ce-archive-keyring.gpg
    cd /etc/apt/sources.list.d/
    sed -i 's@^[^#]*deb @#&@g' docker-ce.list 2>/dev/null
    #case "$(lsb_release -cs)" in
    #sid) DOCKER_CODE="buster" ;;
    #esac
    if (whiptail --title "ËØ∑ÈÄâÊã©ËΩØ‰ª∂Ê∫ê" --yes-button "bfsu" --no-button "docker.com" --yesno "Please choose docker software source." 0 50); then
        printf "%s\n" "deb [signed-by=/usr/share/keyrings/docker-ce-archive-keyring.gpg] https://mirrors.bfsu.edu.cn/docker-ce/linux/${DOCKER_RELEASE} ${DOCKER_CODE} stable" >>docker-ce.list
    else
        printf "%s\n" "deb [signed-by=/usr/share/keyrings/docker-ce-archive-keyring.gpg] https://download.docker.com/linux/${DOCKER_RELEASE} ${DOCKER_CODE} stable" >>docker-ce.list
    fi
    cat docker-ce.list
}
#################
check_docker_installation() {
    if [ ! "$(command -v docker)" ]; then
        printf "%s\n" "Ê£ÄÊµãÂà∞ÊÇ®Â∞öÊú™ÂÆâË£ÖdockerÔºåËØ∑ÂÖàÂÆâË£Ödocker"
        install_docker_ce_or_io
    fi
}
############
install_docker_portainer() {
    check_docker_installation
    TARGET_PORT=$(whiptail --inputbox "ËØ∑ËÆæÂÆöËÆøÈóÆÁ´ØÂè£Âè∑,‰æãÂ¶Ç39080,ÈªòËÆ§ÂÜÖÈÉ®Á´ØÂè£‰∏∫9000\n Please type the port." 0 50 --title "PORT" 3>&1 1>&2 2>&3)
    if [[ ${?} != 0 ]]; then
        ${RETURN_TO_WHERE}
    elif [ -z "${TARGET_PORT}" ]; then
        printf "%s\n" "Á´ØÂè£Êó†ÊïàÔºåÂ∞ÜËá™Âä®‰ΩøÁî®39080Á´ØÂè£„ÄÇ"
        printf "%s\n" "${RED}ERROR,the value is invalid.${RESET}"
        TARGET_PORT=39080
    fi
    printf "%s\n" "${GREEN}docker ${YELLOW}pull ${BLUE}portainer/portainer-ce:latest${RESET}"
    printf "%s\n" "${GREEN}docker ${RED}rm ${BLUE}portainer${RESET}"
    printf "%s\n" "${GREEN}docker ${BLUE}run -d -p ${YELLOW}${TARGET_PORT}:9000 ${BLUE}--name portainer --restart always -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data portainer/portainer-ce:latest${RESET}"
    do_you_want_to_continue
    service docker start 2>/dev/null || systemctl start docker
    docker stop portainer 2>/dev/null
    docker pull portainer/portainer-ce:latest
    docker rm portainer
    docker run -d -p ${TARGET_PORT}:9000 --name portainer --restart always -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data portainer/portainer-ce:latest
}
#####################
install_docker_io() {
    DEPENDENCY_01="docker.io"
    DEPENDENCY_02="docker"
    beta_features_quick_install
}
###########
install_docker_ce() {
    if [ ! $(command -v gpg) ]; then
        DEPENDENCY_01="gpg"
        DEPENDENCY_02="gnupg"
        beta_features_quick_install
    fi
    DEPENDENCY_02="docker-ce"
    DEPENDENCY_01="docker"
    #apt remove docker docker-engine docker.io
    case "${LINUX_DISTRO}" in
    debian)
        DEPENDENCY_01="docker-ce"
        DEPENDENCY_02="docker-ce-cli docker"
        debian_add_docker_gpg
        ;;
    redhat)
        curl -Lv -o /etc/yum.repos.d/docker-ce.repo "https://download.docker.com/linux/${REDHAT_DISTRO}/docker-ce.repo"
        sed -i 's@download.docker.com@mirrors.bfsu.edu.cn/docker-ce@g' /etc/yum.repos.d/docker-ce.repo
        ;;
    arch)
        DEPENDENCY_01="docker"
        ;;
    alpine)
        DEPENDENCY_01="docker-engine docker-cli"
        DEPENDENCY_02="docker"
        ;;
    esac
    beta_features_quick_install
    if [ ! $(command -v docker) ]; then
        printf "%s\n" "ÂÆâË£ÖÂ§±Ë¥•ÔºåËØ∑ÊâßË°å${TMOE_INSTALLATION_COMMAND} docker.io"
    fi
}
#################
tmoe_docker_menu
