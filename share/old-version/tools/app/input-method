##################################
tmoe_pinyin_input_method_main() {
    case "$1" in
    --auto-install-fcitx4)
        set_input_method_env
        case_fcitx4_depends_01
        DEPENDENCY_02='fcitx-googlepinyin'
        beta_features_quick_install
        configure_tmoe_input_method
        case "${LINUX_DISTRO}" in
        "debian") DEPENDENCY_02='fcitx-module-cloudpinyin' ;;
        *) DEPENDENCY_02='fcitx-cloudpinyin' ;;
        esac
        DEPENDENCY_03='fcitx-libpinyin'
        ${TMOE_INSTALLATION_COMMAND} ${DEPENDENCY_02} ${DEPENDENCY_03}
        ;;
    *) install_pinyin_input_method ;;
    esac
}
#################
set_input_method_env() {
    LNK_NAME_FCITX4='fcitx'
    LNK_NAME_FCITX5='org.fcitx.Fcitx5 fcitx5'
    LNK_NAME_IBUS='ibus-setup'
}
install_pinyin_input_method() {
    RETURN_TO_WHERE='install_pinyin_input_method'
    set_input_method_env
    INPUT_METHOD=$(
        whiptail --title "é”®ç›˜ä¸è¾“å…¥æ³•" --menu "arch & debian-sidç­‰æ–°ç‰ˆç³»ç»Ÿå¯ç”¨fcitx5\nubuntu18.04 & debian10ç­‰æ—§ç‰ˆç³»ç»Ÿå¯ç”¨fcitx4\nä¸ºé¿å…å†²çª,ä¸å»ºè®®åŒæ—¶å®‰è£…fcitxå’Œibus\nè‹¥æ‚¨ä½¿ç”¨çš„æ˜¯å®¹å™¨,åˆ™æ¨èfcitx4;è‹¥ä¸ºè™šæ‹Ÿæœº,åˆ™æ¨èfcitx5" 0 0 0 \
            "1" "ğŸ fcitx4 å°ä¼é¹…è¾“å…¥æ³•æ¡†æ¶" \
            "2" "ğŸ€ fcitx5(è½¯ä»¶ä¸è¯åº“)" \
            "3" "ibus è¾“å…¥æ³•æ¡†æ¶" \
            "4" "onboard(å±å¹•è™šæ‹Ÿé”®ç›˜)" \
            "0" "ğŸŒš Return to previous menu è¿”å›ä¸Šçº§èœå•" \
            3>&1 1>&2 2>&3
    )
    case ${INPUT_METHOD} in
    0 | "") beta_features ;;
    1) fcitx4_input_method_menu ;;
    2) tmoe_fcitx5_menu ;;
    3) ibus_input_method_menu ;;
    4) install_onboard ;;
    esac
    ###############
    press_enter_to_return
    install_pinyin_input_method
}
########################
ibus_input_method_menu() {
    DEPENDENCY_01="ibus"
    TMOE_INPUT_METHOD_FRAMEWORK="ibus"
    DEPENDENCY_02=""
    #17 55 8
    INPUT_METHOD=$(
        whiptail --title "FCITX4" --menu "IBusè¾“å…¥æ³•æ¡†æ¶çš„åŠŸèƒ½ä¸ SCIM å’Œ Uim ç±»ä¼¼" 0 0 0 \
            "1" "libpinyin(æä¾›æ™ºèƒ½æ•´å¥è¾“å…¥ç®—æ³•æ ¸å¿ƒ)" \
            "2" "rimeä¸­å·éŸ»(æ“ŠéŸ¿ä¸­æ–‡ä¹‹éŸ»)" \
            "3" "ğŸ FAQ:å¸¸è§é—®é¢˜ä¸ç–‘éš¾è¯Šæ–­" \
            "4" "sunpinyin(åŸºäºç»Ÿè®¡å­¦è¯­è¨€æ¨¡å‹)" \
            "5" "chewing(æ³¨éŸ³)" \
            "0" "ğŸŒš Return to previous menu è¿”å›ä¸Šçº§èœå•" \
            3>&1 1>&2 2>&3
    )
    case ${INPUT_METHOD} in
    0 | "") install_pinyin_input_method ;;
    1) DEPENDENCY_02='ibus-libpinyin' ;;
    2) DEPENDENCY_02='ibus-rime' ;;
    3) tmoe_fcitx_faq ;;
    4) DEPENDENCY_02='ibus-sunpinyin' ;;
    5) DEPENDENCY_02='ibus-chewing' ;;
    esac
    ###############
    case ${INPUT_METHOD} in
    3) ;;
    *) [[ -z ${DEPENDENCY_02} ]] || beta_features_quick_install ;;
    esac
    configure_tmoe_input_method
    press_enter_to_return
    ibus_input_method_menu
}
#################
kde_config_module_for_fcitx() {
    DEPENDENCY_01=""
    DEPENDENCY_02='kcm-fcitx'
    case "${LINUX_DISTRO}" in
    "debian") DEPENDENCY_02='kde-config-fcitx' ;;
    "arch") DEPENDENCY_02='kcm-fcitx' ;;
    esac
    beta_features_quick_install
}
#################
case_fcitx4_depends_01() {
    TMOE_INPUT_METHOD_FRAMEWORK="fcitx"
    DEPENDENCY_01="fcitx"
    case "${LINUX_DISTRO}" in
    "debian")
        DEPENDENCY_01='fcitx fcitx-tools fcitx-config-gtk' #kde-config-fcitx
        ;;
    "arch")
        DEPENDENCY_01='fcitx-im fcitx-configtool' #kcm-fcitx
        ;;
    esac
}
###########
fcitx4_input_method_menu() {
    case_fcitx4_depends_01
    DEPENDENCY_02=""
    #17 55 8
    INPUT_METHOD=$(
        whiptail --title "FCITX4" --menu "fcitxå¯ä»¥é€šè¿‡å®‰è£…å¼•æ“æ¥æ”¯æŒå¤šç§è¾“å…¥æ³•\nåœ¨æ¡Œé¢ç¯å¢ƒä¸‹æŒ‰Ctrl+ç©ºæ ¼åˆ‡æ¢è¾“å…¥æ³•" 0 0 0 \
            "1" "googleè°·æ­Œæ‹¼éŸ³(å¼•æ“forkè‡ªAndroidç‰ˆ)" \
            "2" "rimeä¸­å·éŸ»(æ“ŠéŸ¿ä¸­æ–‡ä¹‹éŸ»)" \
            "3" "ğŸ FAQ:å¸¸è§é—®é¢˜ä¸ç–‘éš¾è¯Šæ–­" \
            "4" "libpinyin(æä¾›æ™ºèƒ½æ•´å¥è¾“å…¥ç®—æ³•æ ¸å¿ƒ)" \
            "5" "sunpinyin(åŸºäºç»Ÿè®¡å­¦è¯­è¨€æ¨¡å‹)" \
            "6" "fcitx4-äº‘æ‹¼éŸ³æ¨¡å—" \
            "7" "KDE-fcitx4-é…ç½®æ¨¡å—" \
            "0" "ğŸŒš Return to previous menu è¿”å›ä¸Šçº§èœå•" \
            3>&1 1>&2 2>&3
    )
    #     "6" "sogou(æœç‹—æ‹¼éŸ³,x64)" \
    # "7" "iflyime(è®¯é£è¯­éŸ³+æ‹¼éŸ³+äº”ç¬”,x64)" \
    # "8" "baidu(ç™¾åº¦è¾“å…¥æ³•,x64)" \
    case ${INPUT_METHOD} in
    0 | "") install_pinyin_input_method ;;
    1) install_google_pinyin ;;
    2) install_rime_pinyin ;;
    3) tmoe_fcitx_faq ;;
    4) install_lib_pinyin ;;
    5) install_sun_pinyin ;;
    # 6) install_sogou_pinyin ;;
    # 7) install_iflyime_pinyin ;;
    # 8) install_baidu_pinyin ;;
    6) install_fcitx_module_cloud_pinyin ;;
    7) kde_config_module_for_fcitx ;;
    esac
    ###############
    configure_tmoe_input_method
    press_enter_to_return
    fcitx4_input_method_menu
}
#################
configure_tmoe_input_method() {
    #[[ -s /etc/environment ]] || printf "\n" >>/etc/environment
    [[ -d ${XDG_AUTOSTART_DIR} ]] || mkdir -pv ${XDG_AUTOSTART_DIR}
    if ! grep -Eq "^[^#]*export SDL_IM_MODULE=" /etc/environment; then
        cat >>/etc/environment <<-'EOF'
			export GTK_IM_MODULE=fcitx
			export QT_IM_MODULE=fcitx
			export XMODIFIERS="@im=fcitx"
			export SDL_IM_MODULE=fcitx
		EOF
    fi
    chmod a+r /etc/environment
    if [[ -n ${TMOE_INPUT_METHOD_FRAMEWORK} ]]; then
        sed -E -e "s%(export GTK_IM_MODULE=).*%\1${TMOE_INPUT_METHOD_FRAMEWORK}%g" \
            -e "s%(export QT_IM_MODULE=).*%\1${TMOE_INPUT_METHOD_FRAMEWORK}%g" \
            -e "s%(export XMODIFIERS=).*%\1\"@im=${TMOE_INPUT_METHOD_FRAMEWORK}\"%g" \
            -e "s%(export SDL_IM_MODULE=).*%\1${TMOE_INPUT_METHOD_FRAMEWORK}%g" \
            -i /etc/environment
    fi
    grep -E --color=auto 'GTK_IM_MODULE=|QT_IM_MODULE=|XMODIFIERS=|SDL_IM_MODULE=' /etc/environment

    case ${TMOE_INPUT_METHOD_FRAMEWORK} in
    fcitx5)
        LNK_NAME=${LNK_NAME_FCITX5}
        NON_AUTO_STARTUP="${LNK_NAME_IBUS} ${LNK_NAME_FCITX4}"
        ;;
    ibus)
        LNK_NAME=${LNK_NAME_IBUS}
        NON_AUTO_STARTUP="${LNK_NAME_FCITX4} ${LNK_NAME_FCITX5}"
        ;;
    fcitx | *)
        LNK_NAME=${LNK_NAME_FCITX4}
        NON_AUTO_STARTUP="${LNK_NAME_IBUS} ${LNK_NAME_FCITX5}"
        ;;
    esac
    #case ${ENABLE_IM_AUTOSTART} in
    #true)
    for i in ${NON_AUTO_STARTUP}; do
        [[ ! -e ${XDG_AUTOSTART_DIR}/${i}.desktop ]] || rm -vf ${XDG_AUTOSTART_DIR}/${i}.desktop
    done

    for i in ${LNK_NAME}; do
        if [[ -e ${APPS_LNK_DIR}/${i}.desktop ]]; then
            ln -svf ${APPS_LNK_DIR}/${i}.desktop ${XDG_AUTOSTART_DIR}
            break
        fi
    done
    #   ;;
    #esac
}
##############
tmoe_fcitx5_menu() {
    check_zstd
    TMOE_INPUT_METHOD_FRAMEWORK="fcitx5"
    RETURN_TO_WHERE='tmoe_fcitx5_menu'
    DEPENDENCY_01="fcitx5-chinese-addons fcitx5"
    DEPENDENCY_02=""
    case "${LINUX_DISTRO}" in
    "debian") DEPENDENCY_02='kde-config-fcitx5' ;;
    "arch") DEPENDENCY_02='fcitx5-qt fcitx5-gtk kcm-fcitx5' ;;
    esac
    INPUT_METHOD=$(
        whiptail --title "Fcitx5" --menu "Fcitx5 æ˜¯ç»§ Fcitx åçš„æ–°ä¸€ä»£è¾“å…¥æ³•æ¡†æ¶ã€‚\nè¯åº“æ˜¯è¾“å…¥æ³•ä¿å­˜çš„ä¸€äº›æµè¡Œè¯è¯­ã€å¸¸ç”¨è¯è¯­æˆ–ä¸“ä¸šæœ¯è¯­ç­‰çš„ä¿¡æ¯,\næ·»åŠ æµè¡Œè¯åº“èƒ½å¢åŠ æµè¡Œå€™é€‰è¯çš„å‘½ä¸­ç‡" 0 55 0 \
            "1" "fcitx5å®‰è£…ä¸å¸è½½" \
            "2" "ğŸ FAQ:å¸¸è§é—®é¢˜ä¸ç–‘éš¾è¯Šæ–­" \
            "3" "è‚¥çŒ«ç™¾ä¸‡å¤§è¯åº“@felixonmars" \
            "4" "èŒå¨˜ç™¾ç§‘è¯åº“@outloudvi" \
            "5" "beautificationè¾“å…¥æ³•ç¾åŒ–ä¸»é¢˜" \
            "6" "fcitx5-rime" \
            "0" "ğŸŒš Return to previous menu è¿”å›ä¸Šçº§èœå•" \
            3>&1 1>&2 2>&3
    )
    case ${INPUT_METHOD} in
    0 | "") install_pinyin_input_method ;;
    1) install_fcitx5 ;;
    2) tmoe_fcitx_faq ;;
    3) felixonmars_fcitx5_wiki_dict ;;
    4) outloudvi_fcitx5_moegirl_dict ;;
    5) input_method_beautification ;;
    6) install_fcitx5_rime ;;
    esac
    #"5" "Material Designè´¨æ„Ÿä¸»é¢˜@hosxy" \
    ###############
    case ${INPUT_METHOD} in
    1 | 6) configure_tmoe_input_method ;;
    esac
    press_enter_to_return
    tmoe_fcitx5_menu
}
############
install_fcitx5() {
    beta_features_quick_install
    case "${LINUX_DISTRO}" in
    "debian")
        if [ ! $(command -v fcitx5-config-qt) ]; then
            DEPENDENCY_01=""
            printf '%s\n' 'æ£€æµ‹åˆ°æ‚¨çš„è½¯ä»¶æºä¸­ä¸åŒ…å«kde-config-fcitx5,æ‚¨å¯ä»¥æ·»åŠ ç¬¬ä¸‰æ–¹ppaæºæ¥å®‰è£…'
            printf "%s\n" "${GREEN}add-apt-repository ppa:hosxy/test${RESET}"
            printf '%s\n' 'è‹¥ppaæºæ·»åŠ å¤±è´¥ï¼Œåˆ™è¯·ä½¿ç”¨æœ¬å·¥å…·å†…ç½®çš„ppaæºæ·»åŠ å™¨'
            add-apt-repository ppa:hosxy/test
            beta_features_quick_install
        fi
        ;;
    esac
}
##############
install_fcitx5_rime() {
    DEPENDENCY_01="fcitx5-rime"
    DEPENDENCY_02="fcitx5-pinyin-moegirl-rime"
    case "${LINUX_DISTRO}" in
    debian | arch) ;;
    *) printf '%s\n' 'æˆªè‡³2020å¹´æœ«ï¼Œæœ¬åŠŸèƒ½æš‚ä»…é€‚é…Archç³»å’ŒDebianç³»å‘è¡Œç‰ˆ' ;;
    esac
    beta_features_quick_install
}
#############
input_method_beautification() {
    RETURN_TO_WHERE='input_method_beautification'
    DEPENDENCY_01=''
    FCITX5_CLASSUI_CONF_PATH="${HOME}/.config/fcitx5/conf"
    # ~/.config/fcitx5/profile
    FCITX5_CLASSUI_CONF_FILE="${FCITX5_CLASSUI_CONF_PATH}/classicui.conf"
    INPUT_METHOD=$(
        whiptail --title "Fcitx5" --menu "fcitxä¸»é¢˜" 0 55 0 \
            "1" "Material Design(å¾®è½¯æ‹¼éŸ³é£æ ¼)@hosxy" \
            "2" "kimpanel(æ”¯æŒkde-wayland)" \
            "3" "gnome-shell-extension-kimpanel(æ”¯æŒgnome-wayland)" \
            "4" "profile" \
            "0" "ğŸŒš Return to previous menu è¿”å›ä¸Šçº§èœå•" \
            3>&1 1>&2 2>&3
    )
    case ${INPUT_METHOD} in
    0 | "") tmoe_fcitx5_menu ;;
    1) configure_fcitx5_material_color_theme ;;
    2) install_kimpanel ;;
    3) install_gnome_shell_extension_kimpanel ;;
    4) edit_fcitx_theme_config_file ;;
    esac
    ###############
    press_enter_to_return
    input_method_beautification
}
##############
edit_fcitx_theme_config_file() {
    printf "%s\n" "~/.config/fcitx5/profile"
    cat ~/.config/fcitx5/profile

    # if [ $(command -v editor) ]; then
    #     editor ${FCITX5_CLASSUI_CONF_FILE}
    # else
    #     nano ${FCITX5_CLASSUI_CONF_FILE}
    # fi
    # chown -v ${CURRENT_USER_NAME}:${CURRENT_USER_GROUP} ${FCITX5_CLASSUI_CONF_FILE}
}
#############
configure_fcitx5_material_color_theme() {
    printf "%s\n" "https://github.com/hosxy/Fcitx5-Material-Color"
    printf "%s\n" "fcitx5é…ç½®--é…ç½®é™„åŠ ç»„ä»¶--ç»å…¸ç”¨æˆ·ç•Œé¢--ä¸»é¢˜--Material-Color"
    do_you_want_to_continue
    DEPENDENCY_02="fcitx5-material-color"
    beta_features_quick_install
}
install_kimpanel() {
    #NON_DEBIAN=true
    non_debian_function
    DEPENDENCY_02='fcitx5-module-kimpanel'
    beta_features_quick_install
}
#############
install_gnome_shell_extension_kimpanel() {
    DEPENDENCY_02='gnome-shell-extension-kimpanel'
    beta_features_quick_install
}
############
check_fcitx5_dict() {
    if [ ! -d ${FCITX5_DIICT_PATH} ]; then
        mkdir -pv ${FCITX5_DIICT_PATH}
    fi
    DICT_FILE="${FCITX5_DIICT_PATH}/${DICT_NAME}"
    DICT_SHARE_FILE=".${FCITX5_DIICT_PATH}/${DICT_NAME}"
    #å‹¿å¿˜ç‚¹
    #usr/share/fcitx5/pinyin/dictionaries/
    if [ -e "${DICT_FILE}" ]; then
        printf "%s\n" "æ£€æµ‹åˆ°æ‚¨${RED}å·²ç»ä¸‹è½½è¿‡${RESET}${DICT_NAME}äº†"
        printf "%s\n" "è¯¥æ–‡ä»¶ä½äº${BLUE}${FCITX5_DIICT_PATH}${RESET}"
        printf "%s\n" "å¦‚éœ€åˆ é™¤ï¼Œè¯·æ‰‹åŠ¨æ‰§è¡Œ${RED}rm -v ${DICT_FILE}${RESET}"
        ls -lah ${DICT_FILE}
        printf "%s\n" "sha256hash: $(sha256sum ${DICT_FILE})"
        printf "%s\n" "Do you want to ${RED}update it?${RESET}"
        printf "%s\n" "æ˜¯å¦æƒ³è¦æ›´æ–°ç‰ˆæœ¬ï¼Ÿ"
        do_you_want_to_continue
    fi
}
#############
move_dict_model_01() {
    if [ -e "data.tar.zst" ]; then
        tar -I zstd -xvf data.tar.zst &>/dev/null || zstdcat "data.tar.zst" | tar xvf -
    elif [ -e "data.tar.xz" ]; then
        tar -Jxvf data.tar.xz 2>/dev/null
    elif [ -e "data.tar.gz" ]; then
        tar -zxvf data.tar.gz 2>/dev/null
    else
        tar -xvf data.* 2>/dev/null
    fi
    #DICT_SHARE_PATH=fcitx5/pinyin/dictionaries/moegirl.dict
    mv -fv ${DICT_SHARE_FILE} ${FCITX5_DIICT_PATH}
    printf "%s\n" "chmod +r ${DICT_FILE}"
    chmod +r ${DICT_FILE}
    cd ..
    rm -rf /tmp/.${THEME_NAME}
    printf "%s\n" "${BLUE}æ–‡ä»¶${RESET}å·²ç»ä¿å­˜è‡³${DICT_FILE}"
    printf "%s\n" "${BLUE}The file${RESET} have been saved to ${DICT_FILE}"
    ls -lah ${DICT_FILE}
    printf "%s\n" "å¦‚éœ€åˆ é™¤ï¼Œè¯·æ‰‹åŠ¨æ‰§è¡Œrm -v ${DICT_FILE}"
}
###################
download_dict_model_01() {
    GREP_NAME_V='rime'
    THEME_URL='https://mirrors.bfsu.edu.cn/archlinuxcn/any/'
    THEME_URL_02='https://mirrors.tuna.tsinghua.edu.cn/archlinuxcn/any/'
    THEME_NAME="${GREP_NAME}"
    FCITX5_DIICT_PATH='/usr/share/fcitx5/pinyin/dictionaries'
    check_fcitx5_dict
    download_arch_community_repo_html
    grep_arch_linux_pkg_03
    move_dict_model_01
}
############
outloudvi_fcitx5_moegirl_dict() {
    DICT_NAME='moegirl.dict'
    GREP_NAME='fcitx5-pinyin-moegirl'
    download_dict_model_01
    printf '%s\n' 'https://github.com/outloudvi/fcitx5-pinyin-moegirl'
}
#################
felixonmars_fcitx5_wiki_dict() {
    DICT_NAME='zhwiki.dict'
    GREP_NAME='fcitx5-pinyin-zhwiki'
    # download_dict_model_01
    printf "${YELLOW}%s${RESET}\n" 'https://github.com/felixonmars/fcitx5-pinyin-zhwiki/releases'
    #~/.local/share/fcitx5/pinyin/dictionaries/
    cat <<-EOF
é¦–å…ˆå‰å¾€gitä»“åº“releaseé¡µé¢ä¸‹è½½${CYAN}.dict${RESET}æ–‡ä»¶ã€‚
ç„¶åå°†å…¶ç§»åŠ¨åˆ° ${BLUE}'/usr/share/fcitx5/pinyin/dictionaries'${RESET}
ç”¨æ³•ç¤ºä¾‹ï¼š
sudo mkdir -pv ${BLUE}/usr/share/fcitx5/pinyin/dictionaries${RESET}
sudo curl -Lo ${BLUE}/usr/share/fcitx5/pinyin/dictionaries/${CYAN}zhwiki.dict ${YELLOW}"https://github.com/felixonmars/fcitx5-pinyin-zhwiki/releases/download/0.2.3/zhwiki-20210605.dict"${RESET}
EOF
}
#################
install_onboard() {
    DEPENDENCY_01=''
    DEPENDENCY_02='onboard'
    beta_features_quick_install
}
##################
#"2" "remove other-im:ç§»é™¤å¯èƒ½å¼•å‘å†²çªçš„è¾“å…¥æ³•" \
tmoe_fcitx_faq() {
    #æ­¤å¤„ä¸è¦è®¾ç½®DEPENDENCY_01
    RETURN_TO_WHERE='tmoe_fcitx_faq'
    TMOE_APP=$(whiptail --title "${TMOE_INPUT_METHOD_FRAMEWORK} FAQ" --menu \
        "ä½ æƒ³è¦å¯¹è¿™ä¸ªå°å¯çˆ±åšä»€ä¹ˆ?" 0 50 5 \
        "1" "edit /etc/environment(ç³»ç»Ÿç¯å¢ƒå˜é‡é…ç½®)" \
        "2" "im-config:é…ç½®${TMOE_INPUT_METHOD_FRAMEWORK}è¾“å…¥æ³•" \
        "3" "${TMOE_INPUT_METHOD_FRAMEWORK}-diagnose:è¯Šæ–­" \
        "4" "edit .pam_environment(ç”¨æˆ·ç¯å¢ƒå˜é‡é…ç½®)" \
        "5" "remove ç§»é™¤${TMOE_INPUT_METHOD_FRAMEWORK}" \
        "6" "disable autostart ç¦æ­¢è¿›å…¥æ¡Œé¢åè‡ªå¯åŠ¨" \
        "0" "ğŸŒš Return to previous menu è¿”å›ä¸Šçº§èœå•" \
        3>&1 1>&2 2>&3)
    ##########################
    case "${TMOE_APP}" in
    0 | "") install_pinyin_input_method ;;
    1)
        FCITX_ENV_FILE="/etc/environment"
        edit_fcitx_env_file
        ;;
    2) input_method_config ;;
    3)
        printf '%s\n' 'è‹¥æ‚¨æ— æ³•ä½¿ç”¨fcitx,åˆ™è¯·æ ¹æ®ä»¥ä¸‹è¯Šæ–­ä¿¡æ¯è‡ªè¡Œè§£å†³'
        case ${TMOE_INPUT_METHOD_FRAMEWORK} in
        fcitx) fcitx-diagnose ;;
        fcitx5)
            FCITX_DIAGNOSES=false
            for i in fcitx5-diagnose fcitx-diagnose; do
                if [[ $(command -v ${i}) ]]; then
                    FCITX_DIAGNOSES=true
                    ${i}
                    break
                fi
            done
            [[ ${FCITX_DIAGNOSES} = true ]] || printf "%s\n" "Sorryï¼Œæ‚¨çš„ç³»ç»Ÿä¸å­˜åœ¨${GREEN}fcitx-diagnoses${RESET}å‘½ä»¤ã€‚"
            ;;
        *) printf '%s\n' 'Sorryï¼Œè¯Šæ–­åŠŸèƒ½ä¸æ”¯æŒibus' ;;
        esac
        ;;
    4)
        FCITX_ENV_FILE="${HOME}/.pam_environment"
        edit_fcitx_env_file
        [[ ${HOME} = /root ]] || chown -v ${CURRENT_USER_NAME}:${CURRENT_USER_GROUP} ${FCITX_ENV_FILE}
        ;;
    5)
        printf "%s\n" "${TMOE_REMOVAL_COMMAND} ${DEPENDENCY_01}"
        do_you_want_to_continue
        ${TMOE_REMOVAL_COMMAND} ${DEPENDENCY_01}
        [[ $(command -v apt-get) ]] || apt autoremove --purge || apt autoremove
        ;;
    6) disable_fcitx_xdg_autostart ;;
    esac
    ##########################
    press_enter_to_return
    tmoe_fcitx_faq
}
#################
disable_fcitx_xdg_autostart() {
    unset AUTO_STARTUP_LNK AUTO_STARTUP_LNK_02
    unset i
    if [ -d "${XDG_AUTOSTART_DIR}" ]; then
        for i in $(ls ${XDG_AUTOSTART_DIR} | grep -E 'ibus-setup|fcitx'); do
            printf "${RED}%s${BLUE}%s\n" "rm -vf" "${XDG_AUTOSTART_DIR}/${i}"
            rm -vf "${XDG_AUTOSTART_DIR}/${i}"
        done
    fi
    XDG_AUTOSTART_DIR_02=${HOME}/.config/autostart
    if [ -d "${XDG_AUTOSTART_DIR_02}" ]; then
        for i in $(ls ${XDG_AUTOSTART_DIR_02} | grep -E 'ibus-setup|fcitx'); do
            printf "${RED}%s${BLUE}%s\n" "rm -vf" "${XDG_AUTOSTART_DIR_02}/${i}"
            rm -vf "${XDG_AUTOSTART_DIR_02}/${i}"
        done
    fi
    printf "%s\n" "å¦‚éœ€æ·»åŠ æ¡Œé¢å¯åŠ¨æ—¶è‡ªåŠ¨æ‰§è¡Œçš„ç¨‹åºï¼Œåˆ™è¯·æŒ‡å®š${YELLOW}${APPS_LNK_DIR}${RESET}ä¸‹çš„desktopæ–‡ä»¶,å¹¶å°†å…¶å¤åˆ¶åˆ°${BLUE}${HOME}/.config/autostart/${RESET}æ–‡ä»¶å¤¹"
}
##################
edit_fcitx_env_file() {
    if [ $(command -v editor) ]; then
        editor ${FCITX_ENV_FILE}
    else
        nano ${FCITX_ENV_FILE}
    fi
}
###########
input_method_config() {
    cd ${HOME}
    #NON_DEBIAN=true
    #non_debian_function
    if [ ! $(command -v im-config) ]; then
        #DEPENDENCY_01=''
        DEPENDENCY_02='zenity im-config'
        #beta_features_quick_install
        printf "%s\n" "${TMOE_INSTALLATION_COMMAND}} ${DEPENDENCY_02}"
        ${TMOE_INSTALLATION_COMMAND}} ${DEPENDENCY_02}
    fi
    #æ£€æµ‹ä¸¤æ¬¡
    unset DISPLAY
    im-config
    if [ ! $(command -v im-config) ]; then
        printf '%s\n' 'Sorryï¼Œæœ¬åŠŸèƒ½åªæ”¯æŒdebç³»å‘è¡Œç‰ˆ'
    fi
    chmod 755 -R .config/fcitx
    if [ ${HOME} != '/root' ]; then
        printf "%s\n" "æ­£åœ¨å°†${HOME}/.configç›®å½•ä¸‹çš„fcitx,fcitx5,ibusçš„æ–‡ä»¶å¤¹æƒé™ä¿®æ”¹ä¸º${CURRENT_USER_NAME}ç”¨æˆ·å’Œ${CURRENT_USER_GROUP}ç”¨æˆ·ç»„"
        for i in fcitx fcitx5 ibus; do
            [[ ! -e .config/${i} ]] || chown -Rv ${CURRENT_USER_NAME}:${CURRENT_USER_GROUP} .config/${i}
        done
    fi
    configure_tmoe_input_method
    #fcitx &>/dev/null || fcitx5 &>/dev/null
    #printf "%s\n" "è¯·æ‰‹åŠ¨ä¿®æ”¹é”®ç›˜å¸ƒå±€ï¼Œå¹¶æ‰“å¼€fcitx-configtool"
}
################
install_fcitx_module_cloud_pinyin() {
    DEPENDENCY_01=''
    case "${LINUX_DISTRO}" in
    "debian") DEPENDENCY_02='fcitx-module-cloudpinyin' ;;
    *) DEPENDENCY_02='fcitx-cloudpinyin' ;;
    esac
    beta_features_quick_install
}
######################
install_rime_pinyin() {
    DEPENDENCY_02='fcitx-rime'
    beta_features_quick_install
}
#############
install_lib_pinyin() {
    DEPENDENCY_02='fcitx-libpinyin'
    beta_features_quick_install
}
######################
install_sun_pinyin() {
    DEPENDENCY_02='fcitx-sunpinyin'
    beta_features_quick_install
}
###########
install_google_pinyin() {
    DEPENDENCY_02='fcitx-googlepinyin'
    beta_features_quick_install
}
###########
install_debian_baidu_pinyin() {
    DEPENDENCY_02="fcitx-baidupinyin"
    if [ ! $(command -v unzip) ]; then
        printf "%s\n" "${GREEN}${TMOE_INSTALLATION_COMMAND} ${BLUE}unzip${RESET}"
        ${TMOE_INSTALLATION_COMMAND} unzip || ${TMOE_INSTALLATION_COMMAND} unzip
    fi
    ###################
    case "${ARCH_TYPE}" in
    "amd64")
        mkdir /tmp/.BAIDU_IME
        cd /tmp/.BAIDU_IME
        THE_Latest_Link='https://imeres.baidu.com/imeres/ime-res/guanwang/img/Ubuntu_Deepin-fcitx-baidupinyin-64.zip'
        printf "%s\n" "${THE_Latest_Link}"
        aria2c --console-log-level=warn --no-conf --allow-overwrite=true -s 5 -x 5 -k 1M -o 'fcitx-baidupinyin.zip' "${THE_Latest_Link}"
        unzip -o 'fcitx-baidupinyin.zip' || unzip 'fcitx-baidupinyin.zip'
        DEB_FILE_NAME="$(ls -l ./*deb | grep ^- | head -n 1 | awk -F ' ' '$0=$NF')"
        apt install ${DEB_FILE_NAME}
        ;;
    *)
        printf "%s\n" "æ¶æ„ä¸æ”¯æŒï¼Œè·³è¿‡å®‰è£…ç™¾åº¦è¾“å…¥æ³•ã€‚"
        arch_does_not_support
        ;;
    esac
    apt-cache show ./fcitx-baidupinyin.deb
    apt install -y ./fcitx-baidupinyin.deb
    printf "%s\n" "è‹¥å®‰è£…å¤±è´¥ï¼Œåˆ™è¯·å‰å¾€å®˜ç½‘æ‰‹åŠ¨ä¸‹è½½å®‰è£…ã€‚"
    printf '%s\n' 'url: https://srf.baidu.com/site/guanwang_linux/index.html'
    cd /tmp
    rm -rfv /tmp/.BAIDU_IME
    beta_features_install_completed
}
########
install_pkg_warning() {
    printf "%s\n" "æ£€æµ‹åˆ°${YELLOW}æ‚¨å·²å®‰è£…${RESET} ${GREEN} ${DEPENDENCY_02} ${RESET}"
    printf "%s\n" "å¦‚éœ€${RED}å¸è½½${RESET}ï¼Œè¯·æ‰‹åŠ¨è¾“${BLUE} ${TMOE_REMOVAL_COMMAND} ${DEPENDENCY_02} ${RESET}"
    press_enter_to_reinstall_yes_or_no
}
#############
install_baidu_pinyin() {
    DEPENDENCY_02="fcitx-baidupinyin"
    if [ -e "/opt/apps/com.baidu.fcitx-baidupinyin/" ]; then
        install_pkg_warning
    fi
    case "${LINUX_DISTRO}" in
    "debian") install_debian_baidu_pinyin ;;
    "arch")
        DEPENDENCY_02="fcitx-baidupinyin"
        beta_features_quick_install
        ;;
    *)
        non_debian_function
        ;;
    esac
}
##########
#å·²åºŸå¼ƒï¼
sougou_pinyin_amd64() {
    case "${ARCH_TYPE}" in
    "arm64" | "i386")
        LatestSogouPinyinLink=$(curl -L 'https://pinyin.sogou.com/linux' | grep ${ARCH_TYPE} | grep 'deb' | head -n 1 | cut -d '=' -f 3 | cut -d '?' -f 1 | cut -d '"' -f 2)
        printf "%s\n" "${LatestSogouPinyinLink}"
        aria2c --console-log-level=warn --no-conf --allow-overwrite=true -s 5 -x 5 -k 1M -o 'sogou_pinyin.deb' "${LatestSogouPinyinLink}"
        ;;
    *)
        printf "%s\n" "æ¶æ„ä¸æ”¯æŒï¼Œè·³è¿‡å®‰è£…æœç‹—è¾“å…¥æ³•ã€‚"
        arch_does_not_support
        ;;
    esac
}
###################
install_debian_sogou_pinyin() {
    #DEPENDENCY_02="sogouimebs"
    DEPENDENCY_02='sogoupinyin'
    ###################
    if [ -e "/usr/share/fcitx-sogoupinyin" ] || [ -e "/usr/share/sogouimebs/" ]; then
        install_pkg_warning
    fi
    case "${ARCH_TYPE}" in
    amd64 | i386)
        printf "%s\n" "æœ¬è„šæœ¬æä¾›çš„æ˜¯æœç‹—å®˜ç½‘çš„ç‰ˆæœ¬"
        printf "%s\n" "Debian sidã€Kali rollingå’Œubuntu 21.04ç­‰é«˜ç‰ˆæœ¬å¯èƒ½æ— æ³•æ­£å¸¸è¿è¡Œ,æ‚¨å¯ä»¥å‰å¾€ä¼˜éº’éºŸè½¯ä»¶ä»“åº“æ‰‹åŠ¨ä¸‹è½½å®‰è£…ã€‚"
        printf '%s\n' 'http://archive.ubuntukylin.com/ukui/pool/main/s/sogouimebs/'
        LATEST_DEB_URL=$(curl -L 'https://pinyin.sogou.com/linux/' | grep ${ARCH_TYPE} | grep deb | awk -F 'href=' '{print $2}' | cut -d '"' -f 2 | head -n 1)
        printf "${YELLOW}%s${RESET}\n" "${LATEST_DEB_URL}"
        do_you_want_to_continue
        LATEST_DEB_VERSION="sogouimebs_${ARCH_TYPE}.deb"
        install_deb_file_common_model_02
        ;;
    arm64)
        printf '%s\n' 'http://archive.ubuntukylin.com/ukui/pool/main/s/sogouimebs/'
        printf "%s\n" "è¯·å‰å¾€ä¼˜éº’éºŸè½¯ä»¶ä»“åº“,æ‰‹åŠ¨ä¸‹è½½å®‰è£…arm64ç‰ˆsogouimebs"
        ;;
    esac
    printf "%s\n" "è‹¥å®‰è£…å¤±è´¥ï¼Œåˆ™è¯·å‰å¾€å®˜ç½‘æ‰‹åŠ¨ä¸‹è½½å®‰è£…ã€‚"
    printf "%s\n" "url: ${YELLOW}https://pinyin.sogou.com/linux/${RESET}"
    beta_features_install_completed
}
########
install_sogou_pinyin() {
    case "${LINUX_DISTRO}" in
    "debian") install_debian_sogou_pinyin ;;
    "arch")
        DEPENDENCY_02="fcitx-sogouimebs"
        beta_features_quick_install
        ;;
    *) non_debian_function ;;
    esac
}
############
fix_fcitx5_permissions() {
    if [ ${HOME} != '/root' ]; then
        printf "%s\n" "æ­£åœ¨å°†${FCITX5_FILE}çš„æ–‡ä»¶æƒé™ä¿®æ”¹ä¸º${CURRENT_USER_NAME}ç”¨æˆ·å’Œ${CURRENT_USER_GROUP}ç”¨æˆ·ç»„"
        chown -R ${CURRENT_USER_NAME}:${CURRENT_USER_GROUP} ${FCITX5_FILE}
    fi
}
############
install_debian_iflyime_pinyin() {
    DEPENDENCY_02="iflyime"
    beta_features_quick_install
    case "${ARCH_TYPE}" in
    amd64)
        REPO_URL='https://mirrors.bfsu.edu.cn/deepin/pool/non-free/i/iflyime/'
        GREP_NAME="${ARCH_TYPE}"
        grep_deb_comman_model_01
        ;;
    *)
        printf "%s\n" "è¯·åœ¨æ›´æ¢x64æ¶æ„çš„è®¾å¤‡åï¼Œå†æ¥å°è¯•"
        arch_does_not_support
        ;;
    esac
}
#############
install_iflyime_pinyin() {
    case "${LINUX_DISTRO}" in
    "debian") install_debian_iflyime_pinyin ;;
    "arch")
        DEPENDENCY_02="iflyime"
        beta_features_quick_install
        ;;
    *)
        non_debian_function
        ;;
    esac
}
################
####################
tmoe_pinyin_input_method_main "$@"
