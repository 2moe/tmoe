#############
tmoe_documents_menu() {
    RETURN_TO_WHERE='tmoe_documents_menu'
    RETURN_TO_MENU='tmoe_documents_menu'
    DEPENDENCY_01=""
    DEPENDENCY_02=""
    TMOE_APP=$(
        whiptail --title "documents" --menu \
            "Which software do you want to install?" 0 50 0 \
            "1" "Libre office(å¼€æºã€è‡ªç”±çš„åŠå…¬æ–‡æ¡£è½¯ä»¶)" \
            "2" "Yozo æ°¸ä¸­office(arm64,x64,ç§‰æ‰¿é›†æˆåˆ›æ–°ç†å¿µ)" \
            "3" "WPS office(æ‰“é€ æ–°ä¸€ä»£åŠå…¬ç¯å¢ƒ)" \
            "4" "Meld(å¯è§†åŒ–çš„æ–‡æœ¬å·®å¼‚æ¯”è¾ƒå·¥å…·)" \
            "5" "Kdiff3(KDEä¸‹çš„æ–‡ä»¶å·®å¼‚å¯¹æ¯”å·¥å…·)" \
            "6" "Chinese manual(ä¸­æ–‡æ‰‹å†Œ)" \
            "0" "ğŸŒš Return to previous menu è¿”å›ä¸Šçº§èœå•" \
            3>&1 1>&2 2>&3
    )
    ##########################
    case "${TMOE_APP}" in
    0 | "") software_center ;;
    1) install_libre_office ;;
    2) yozo_office_env ;;
    3) install_wps_office ;;
    4) install_meld ;;
    5) install_kdiff3 ;;
    6) install_chinese_manpages ;;
    esac
    # 4) free_office_env ;;
    # "4" "Free office(x86,x64,å…¨é¢æ”¯æŒå¾®è½¯Officeæ–‡ä»¶)" \
    ##########################
    press_enter_to_return
    tmoe_documents_menu
}
#############
install_meld() {
    DEPENDENCY_02="meld"
    beta_features_quick_install
}
############
install_kdiff3() {
    DEPENDENCY_02="kdiff3"
    beta_features_quick_install
}
#################
free_office_env() {
    DEPENDENCY_01="freeoffice"
    GREP_NAME=${DEPENDENCY_01}
    OFFICIAL_URL='https://www.freeoffice.com/download/applications'
    tmoe_app_menu_01
}
############
install_free_office() {
    REPO_URL="${OFFICIAL_URL}"
    THE_LATEST_DEB_URL=$(curl -L ${REPO_URL} | grep 'amd64.deb' | sed 's@ @\n@g' | grep deb | cut -d '"' -f 2 | cut -d '=' -f 2 | head -n 1)
    case ${ARCH_TYPE} in
    amd64) ;;
    i386) THE_LATEST_DEB_URL=$(printf '%s\n' "${THE_LATEST_DEB_URL}" | sed "s@amd64.deb@${ARCH_TYPE}.deb@") ;;
    esac
    #https://www.softmaker.net/down/softmaker-freeoffice-2018_976-01_amd64.deb
    #https://www.softmaker.net/down/softmaker-freeoffice-2018-976.x86_64.rpm
    case ${LINUX_DISTRO} in
    debian | arch) ;;
    redhat)
        case ${ARCH_TYPE} in
        amd64)
            THE_LATEST_DEB_URL="$(curl -L ${REPO_URL} | grep rpm | sed 's@ @\n@g' | grep 'rpm' | grep 'x86_64' | cut -d '"' -f 2 | cut -d '=' -f 2 | head -n 1)"
            #THE_LATEST_DEB_URL=$(printf '%s\n' "${THE_LATEST_DEB_URL}" | sed "s@-01_amd64.deb@.x86_64.rpm@" | sed "s@_amd64.deb@.x86_64.rpm@")
            ;;
        i386)
            THE_LATEST_DEB_URL=$(curl -L ${REPO_URL} | grep 'rpm' | sed 's@ @\n@g' | grep rpm | grep i386 | cut -d '"' -f 2 | cut -d '=' -f 2 | head -n 1)
            #THE_LATEST_DEB_URL=$(printf '%s\n' "${THE_LATEST_DEB_URL}" | sed "s@-01_amd64.deb@.i386.rpm@" | sed "s@_amd64.deb@.i386.rpm@")
            ;;
        esac
        ;;
    esac
    THE_LATEST_DEB_FILE=$(printf '%s\n' "${THE_LATEST_DEB_URL}" | awk -F '/' '{print $NF}')
    THE_LATEST_DEB_VERSION=$(printf '%s\n' "${THE_LATEST_DEB_FILE}" | sed 's@.deb@@' | sed 's@softmaker-freeoffice-@@' | sed "s@${GREP_NAME}_@@")
    check_deb_version
    case ${ARCH_TYPE} in
    amd64) ;;
    i386) ;;
    *) arch_does_not_support ;;
    esac
    download_and_install_deb
}
###################
yozo_office_env() {
    DEPENDENCY_01="yozo-office"
    case ${LINUX_DISTRO} in
    arch) DEPENDENCY_02="yozo-office-fonts" ;;
    esac
    GREP_NAME=${DEPENDENCY_01}
    OFFICIAL_URL='https://www.yozosoft.com/product-officelinux.html'
    tmoe_app_menu_01
}
############
install_yozo_office() {
    #REPO_URL='http://www.yozosoft.com/product-officelinux.html'
    #httpsè¯ä¹¦é”™è¯¯ï¼Œå› æ­¤ä¸åŠ s
    #THE_LATEST_DEB_FILE=$(curl -L ${REPO_URL} | grep 'amd64.deb' | grep '=' | cut -d '=' -f 2 | cut -d '"' -f 2 | awk -F '/' '{print $NF}')
    #THE_LATEST_DEB_URL="https://dl.yozosoft.com/portal-download/fileManager/PRODUCT/${THE_LATEST_DEB_FILE}"
    #arm64) THE_LATEST_DEB_URL=$(printf '%s\n' "${THE_LATEST_DEB_URL}" | sed "s@amd64.deb@arm64.deb@") ;;
    #https://dl.yozosoft.com/portal-download/fileManager/PRODUCT/yozo-office_8.0.1331.101ZH.S1_amd64.deb
    #https://dl.yozosoft.com/portal-download/fileManager/PRODUCT/yozo-office-8.0.1331.101ZH.S1-1.x86_64.rpm
    REPO_URL='https://aur.archlinux.org/packages/yozo-office/'
    THE_LATEST_DEB_URL=$(curl -L ${REPO_URL} | grep deb | cut -d '=' -f 2 | cut -d '"' -f 2 | head -n 1)

    printf "%s\n" "è‹¥å®‰è£…å¤±è´¥ï¼Œåˆ™è¯·å‰å¾€å®˜ç½‘${YELLOW}http://www.yozosoft.com/product-officelinux.html${RESET} æ‰‹åŠ¨ä¸‹è½½å®‰è£…ã€‚"

    printf "%s\n" \
        "å¯¹äº amd64 æ¶æ„ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ çº¢å¸½ç³»(ä¾‹å¦‚ fedora) å’Œ debian ç³»(ubuntu, mint & kaliç­‰)" \
        "å¯¹äº arm64 æ¶æ„, æœ¬å·¥å…·ä»…èƒ½ä¸‹è½½å¹¶å®‰è£… deb åŒ…ã€‚è¯·ä½¿ç”¨ debian ç³»çš„å‘è¡Œç‰ˆï¼Œä¾‹å¦‚ ubuntu" \
        "è‹¥æ‚¨ä½¿ç”¨çš„æ˜¯ arch ç³»å‘è¡Œç‰ˆï¼Œåˆ™å»ºè®®ä½¿ç”¨ ${GREEN}paru${RESET} ç­‰ ${BLUE}AUR helper${RESET} æ¥å®‰è£…ï¼Œè€Œä¸æ˜¯é€šè¿‡æœ¬å·¥å…·æ¥å®‰è£…ã€‚"
    case ${LINUX_DISTRO} in
    debian) ;;
    redhat) THE_LATEST_DEB_URL=$(printf '%s\n' "${THE_LATEST_DEB_URL}" | sed "s@${GREP_NAME}_@${GREP_NAME}-@" | sed "s@_amd64.deb@-1.x86_64.rpm@") ;;
    esac

    case ${ARCH_TYPE} in
    amd64)
        THE_LATEST_DEB_FILE=$(printf '%s\n' "${THE_LATEST_DEB_URL}" | awk -F '/' '{print $NF}')
        THE_LATEST_DEB_VERSION=$(printf '%s\n' "${THE_LATEST_DEB_FILE}" | sed 's@.deb@@' | sed "s@${GREP_NAME}-@@" | sed "s@${GREP_NAME}_@@")
        ;;
    arm64)
        THE_LATEST_DEB_FILE="yozo-office_8.0.1322.191ZH.SY01.S1_arm64.deb"
        THE_LATEST_DEB_VERSION="8.0.1322.191zh.s1_arm64"
        ;;
    *) ;;
    esac

    ICON_FILE='/usr/share/icons/hicolor/48x48/apps/yozoicon.png'
    if [ -e "${ICON_FILE}" ]; then
        catimg "${ICON_FILE}" 2>/dev/null
    fi
    check_deb_version

    printf "%s\n" \
        "æ ¹æ® 2022å¹´3æœˆä»½ä¿®è®¢çš„ TMOE LICENSE v1.2, æ‚¨éœ€è¦å†æ¬¡äº†è§£å¹¶åŒæ„ä»¥ä¸‹å†…å®¹ã€‚" \
        '7. å…³äºå•†ä¸šè½¯ä»¶çš„è¯´æ˜
ä¸­åäººæ°‘å…±å’Œå›½å¢ƒå†…çš„ä¼ä¸šç”Ÿäº§çš„éƒ¨åˆ†å•†ä¸šè½¯ä»¶ä½¿ç”¨äº†ç§æœ‰åè®®ï¼Œå¹¶ä¸”å—ã€Šä¸­åäººæ°‘å…±å’Œå›½è‘—ä½œæƒæ³•ã€‹ä¿æŠ¤ã€‚
æ‚¨åœ¨ä½¿ç”¨æœ¬è½¯ä»¶åŠå…¶ç›¸å…³é¡¹ç›®æ—¶ï¼Œåœ¨å®‰è£…ç›¸å…³å•†ä¸šè½¯ä»¶å‰ï¼Œå¿…é¡»äº†è§£å¹¶åŒæ„ä»¥ä¸‹åè®®ã€‚
(a)æ ¹æ®ã€Šä¸­åäººæ°‘å…±å’Œå›½è®¡ç®—æœºè½¯ä»¶ä¿æŠ¤æ¡ä¾‹ã€‹ç¬¬åä¸ƒæ¡è§„å®šï¼šâ€œä¸ºäº†å­¦ä¹ å’Œç ”ç©¶è½¯ä»¶å†…å«çš„è®¾è®¡æ€æƒ³å’ŒåŸç†ï¼Œé€šè¿‡å®‰è£…ã€æ˜¾ç¤ºã€ä¼ è¾“æˆ–è€…å­˜å‚¨è½¯ä»¶ç­‰æ–¹å¼ä½¿ç”¨è½¯ä»¶çš„ï¼Œå¯ä»¥ä¸ç»è½¯ä»¶è‘—ä½œæƒäººè®¸å¯ï¼Œä¸å‘å…¶æ”¯ä»˜æŠ¥é…¬â€ã€‚
(b)æœ¬è½¯ä»¶åŠå…¶ç›¸å…³é¡¹ç›®é™„å¸¦çš„å•†ä¸šè½¯ä»¶æ¥è‡ªäº’è”ç½‘ï¼ˆåŒ…æ‹¬ä½†ä¸é™äºä¼˜éº’éºŸã€é“¶æ²³éº’éºŸå’Œç»Ÿä¿¡çš„è½¯ä»¶ä»“åº“ï¼‰ï¼Œè¿™äº›å•†ä¸šè½¯ä»¶ä»…ç”¨æ¥æµ‹è¯•ï¼ˆåŒ…æ‹¬ä½†ä¸é™äºæµ‹è¯•å…¶åœ¨arm64ç­‰ç‰¹å®šæ¶æ„ã€ç‰¹å®šå®¹å™¨ç¯å¢ƒçš„å…¼å®¹æ€§ï¼Œæµ‹è¯•ç ”ç©¶è½¯ä»¶æœºåˆ¶å’ŒåŸç†ï¼‰ï¼Œæœ¬è½¯ä»¶å¼€å‘è€…æœªæˆæƒä»»ä½•æœºæ„å’Œä¸ªäººç”¨äºå•†ä¸šç”¨é€”ã€‚è¯·ä¸¥æ ¼éµå®ˆæ³•å¾‹è§„å®šï¼Œåœ¨æµ‹è¯•å24å°æ—¶å†…å®Œå…¨å¸è½½ç›¸å…³è½¯ä»¶ï¼Œå¹¶å½»åº•é”€æ¯ã€‚å¼€å‘è€…å°†ä¸å¯¹ä¼ æ’­è¿™äº›è½¯ä»¶æ‰€äº§ç”Ÿçš„ä»»ä½•åæœè´Ÿè´£ï¼Œä¹Ÿä¸å¯¹æ‚¨ä½¿ç”¨ç›¸å…³è½¯ä»¶æ‰€è¿›è¡Œçš„ä»»ä½•è¡Œä¸ºè´Ÿè´£ã€‚
(c)éç‰¹æ®Šæƒ…å†µä¸‹ï¼Œè¯·ä¸è¦ç»™å¼€å‘è€…æ‰“èµã€‚å¦‚éœ€æ‰“èµï¼Œåˆ™è¡¨ç¤ºæ‚¨å·²ç»åŒæ„äº†è¿™ç§è¡Œä¸ºä¸ç›¸å…³å•†ä¸šè½¯ä»¶æ¯«æ— å…³ç³»ã€‚
(d)è‹¥æœ¬è½¯ä»¶åŠå…¶ç›¸å…³é¡¹ç›®ä¾µå®³äº†æ‚¨çš„æƒç›Šï¼Œè¯·åŠæ—¶ä¸å¼€å‘è€…è”ç³»ï¼Œå¼€å‘è€…å°†åˆ é™¤ç›¸å…³å†…å®¹ã€‚

8. ä½¿ç”¨è¯´æ˜
(a)æ‚¨æœ‰æƒé€‰æ‹©æ¥å—æˆ–æ‹’ç»ä½¿ç”¨æœ¬è½¯ä»¶æˆ–æœ¬è½¯ä»¶ç›¸å…³çš„é¡¹ç›®ã€‚
(b)è‹¥æ‚¨ä¸åŒæ„æœ¬åè®®åŠå…¶é™„åŠ åè®®ï¼Œåˆ™å»ºè®®æ‚¨å¸è½½æ‰æœ¬è½¯ä»¶åŠå…¶ç›¸å…³é¡¹ç›®ï¼Œå¹¶å½»åº•é”€æ¯ã€‚
(c)æœ¬è½¯ä»¶åŠå…¶ç›¸å…³é¡¹ç›®æœåŠ¡äºå…¨çƒå„åœ°ï¼Œæ‚¨åœ¨ä½¿ç”¨æœŸé—´å¿…é¡»è¦éµå®ˆå½“åœ°çš„æ³•è§„ã€‚
(d)è‹¥æœ¬åè®®åŠå…¶é™„åŠ åè®®ä¸æ‚¨æ‰€åœ¨åœ°çš„æ³•å¾‹æˆ–æ³•è§„å†²çªï¼Œåˆ™è¯·æ‚¨å¸è½½æ‰æœ¬è½¯ä»¶åŠå…¶ç›¸å…³é¡¹ç›®ï¼Œå¹¶å½»åº•é”€æ¯ï¼ŒåŒæ—¶å¼€å‘è€…å°†ä¸æ‰¿æ‹…ä»»ä½•è´£ä»»ã€‚
You shall remove the software and its related projects if this agreement and any extra agreements violate with the laws or regulations of your location, and the developer will not be accountable.'

    case ${ARCH_TYPE} in
    amd64) ;;
    arm64) THE_LATEST_DEB_URL="https://l.tmoe.me/yozo-office-arm64" ;;
    *) arch_does_not_support ;;
    esac
    #printf "%s\n" "æœ€æ–°ç‰ˆé“¾æ¥ä¸º${BLUE}${THE_LATEST_DEB_URL}${RESET}"
    download_and_install_deb
}
###################
make_font_cache() {
    for i in mkfontscale mkfontdir fc-cache; do
        [[ ! $(command -v ${i}) ]] || ${i}
    done
}
###############
install_wps_office() {
    random_neko
    DEPENDENCY_01="wps-office"
    DEPENDENCY_02=""
    printf "%s\n" "æ­£åœ¨æ£€æµ‹ç‰ˆæœ¬æ›´æ–°..."
    printf "%s\n" "è‹¥å®‰è£…å¤±è´¥ï¼Œåˆ™è¯·å‰å¾€å®˜ç½‘æ‰‹åŠ¨ä¸‹è½½å®‰è£…ã€‚"
    printf "%s\n" "url: ${YELLOW}https://linux.wps.cn${RESET}"
    case ${LINUX_DISTRO} in
    redhat)
        THE_LATEST_DEB_URL=$(curl -L https://linux.wps.cn/ | grep '\.rpm' | grep -i "$(uname -m)" | head -n 1 | cut -d '=' -f 2 | cut -d '"' -f 2)
        ;;
    *)
        THE_LATEST_DEB_URL=$(curl -L https://linux.wps.cn/ | grep '\.deb' | grep -i "${ARCH_TYPE}" | head -n 1 | cut -d '=' -f 2 | cut -d '"' -f 2)
        ;;
    esac
    THE_LATEST_DEB_VERSION=$(printf '%s\n' "${THE_LATEST_DEB_URL}" | awk -F '/' '{print $NF}' | sed 's@.deb@@')
    TMOE_TIPS_01="æ£€æµ‹åˆ°æœ€æ–°ç‰ˆæœ¬ä¸º${THE_LATEST_DEB_VERSION}"
    lolcat_tmoe_tips_01
    printf "%s\n" "æœ€æ–°ç‰ˆé“¾æ¥ä¸º${BLUE}${THE_LATEST_DEB_URL}${RESET}"
    if [ ! -e "${APPS_LNK_DIR}/wps-office-wps.desktop" ]; then
        #press_enter_to_reinstall
        printf "%s\n" "æœªæ£€æµ‹åˆ°æœ¬åœ°ç‰ˆæœ¬ï¼Œæ‚¨å¯èƒ½å°šæœªå®‰è£…WPSå®¢æˆ·ç«¯ã€‚"
    elif [ -e "${TMOE_LINUX_DIR}/${DEPENDENCY_01}-version" ]; then
        printf "%s\n" "æœ¬åœ°ç‰ˆæœ¬å¯èƒ½ä¸º${YELLOW}$(head -n 1 ${TMOE_LINUX_DIR}/${DEPENDENCY_01}-version)${RESET}"
        printf "%s\n" "å¦‚éœ€${RED}å¸è½½${RESET}ï¼Œè¯·æ‰‹åŠ¨è¾“${BLUE} ${TMOE_REMOVAL_COMMAND} ${DEPENDENCY_01} ${DEPENDENCY_02} ${RESET}"
    else
        printf "%s\n" "æœªæ£€æµ‹åˆ°æœ¬åœ°ç‰ˆæœ¬ï¼Œæ‚¨å¯èƒ½ä¸æ˜¯é€šè¿‡tmoe toolså®‰è£…çš„ã€‚"
    fi
    do_you_want_to_continue
    cd /tmp
    if [ ! -e "/usr/share/fonts/truetype/wps-fonts/wingding.ttf" ]; then
        aria2c --console-log-level=warn --no-conf --allow-overwrite=true -s 5 -x 5 -k 1M -d /tmp -o ttf-wps-fonts.tar.xz https://gitee.com/ak2/ttf-wps-fonts/raw/master/ttf-wps-fonts.tar.xz
        tar -Jxvf /tmp/ttf-wps-fonts.tar.xz -C /
        rm -fv /tmp/ttf-wps-fonts.tar.xz
        cd /usr/share/fonts/truetype/wps-fonts
        make_font_cache
        cd /tmp
    fi

    if [ ! -e "/usr/share/fonts/truetype/msttcorefonts/Impact.ttf" ]; then
        git clone --depth=1 https://gitee.com/ak2/msttcorefonts.git /tmp/.MS_FONTS_TEMP_FOLDER
        cd /tmp/.MS_FONTS_TEMP_FOLDER
        tar -JPxvf msttcorefonts.tar.xz
        cd /usr/share/fonts/truetype/msttcorefonts
        make_font_cache
        cd /tmp
        rm -rvf .MS_FONTS_TEMP_FOLDER 2>/dev/null
    fi

    for i in /tmp ${HOME}/sd/Download; do
        [[ ! -d ${i} ]] || DEB_DIR=${i}
    done
    cd ${DEB_DIR}
    case "${LINUX_DISTRO}" in
    "debian")
        dpkg --configure -a
        if [ ! -e "/usr/share/doc/ttf-mscorefonts-installer/copyright" ]; then
            printf "%s\n" "apt install -y ttf-mscorefonts-installer"
            apt install -y ttf-mscorefonts-installer
        fi
        aria2c --console-log-level=warn --no-conf --allow-overwrite=true --check-certificate=false -s 5 -x 5 -k 1M -o WPSoffice.deb "${THE_LATEST_DEB_URL}"
        apt-cache show ./WPSoffice.deb
        apt install -y ./WPSoffice.deb || dpkg -i ./WPSoffice.deb
        printf "%s\n" "You can type ${RED}rm -fv ${BLUE}${DEB_DIR}/WPSoffice.deb${RESET} to delete the deb file."
        ;;
    "arch")
        DEPENDENCY_01="wps-office-cn"
        beta_features_quick_install
        ;;
    "redhat")
        aria2c --console-log-level=warn --no-conf --allow-overwrite=true -s 5 -x 5 -k 1M -o WPSoffice.rpm "${THE_LATEST_DEB_URL}"
        yum install -y ./WPSoffice.rpm
        printf "%s\n" "You can type ${RED}rm -fv ${BLUE}${DEB_DIR}/WPSoffice.rpm${RESET} to delete the rpm file."
        ;;
    esac
    printf "%s\n" "${THE_LATEST_DEB_VERSION}" >${TMOE_LINUX_DIR}/${DEPENDENCY_01}-version
    #rm -fv ./WPSoffice.deb ./WPSoffice.rpm 2>/dev/null
    beta_features_install_completed
}
###################
install_libre_office() {
    #ps -e >/dev/null || printf "%s\n" "/procåˆ†åŒºæœªæŒ‚è½½ï¼Œè¯·å‹¿å®‰è£…libreoffice,èµ‹äºˆprootå®¹å™¨çœŸå®rootæƒé™å¯è§£å†³ç›¸å…³é—®é¢˜ï¼Œä½†å¼ºçƒˆä¸æ¨èï¼"
    case ${TMOE_PROOT} in
    no)
        printf "%s\n" "${RED}WARNINGï¼${RESET}æ£€æµ‹åˆ°æ‚¨æ— æƒè¯»å–${GREEN}/proc${RESET}çš„æŸäº›æ•°æ®ï¼"
        printf "%s\n" "æœ¬å·¥å…·å°†ä¸ºæ­¤è½¯ä»¶è‡ªåŠ¨æ‰“è¡¥ä¸ä»¥è§£å†³æ— æ³•è¿è¡Œçš„é—®é¢˜ï¼Œä½†æ— æ³•ä¿è¯è¡¥ä¸æœ‰æ•ˆã€‚"
        ;;
    esac
    #RETURN_TO_WHERE='software_center'
    #do_you_want_to_continue
    case "${LINUX_DISTRO}" in
    "debian") DEPENDENCY_01='--no-install-recommends libreoffice' ;;
    *) DEPENDENCY_01="libreoffice" ;;
    esac
    DEPENDENCY_02="libreoffice-l10n-zh-cn libreoffice-gtk3"

    beta_features_quick_install
    case "${TMOE_PROOT}" in
    no)
        patch_libreoffice
        printf "%s\n" "æ‰“è¡¥ä¸å®Œæˆ"
        ;;
    esac
}
###################
patch_libreoffice() {
    mkdir -pv /prod/version
    cd /usr/lib/libreoffice/program
    rm -f oosplash
    curl -Lo 'oosplash' https://gitee.com/mo2/patch/raw/libreoffice/oosplash
    chmod a+rx oosplash
}
##################
check_libreoffice_patch() {
    if [ $(command -v libreoffice) ]; then
        patch_libreoffice
    fi
}
############
tmoe_documents_menu
