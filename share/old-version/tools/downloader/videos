#####################
download_videos() {
    VIDEOTOOL=$(
        whiptail --title "DOWNLOAD VIDEOS" --menu "ä½ æƒ³è¦ä½¿ç”¨å“ªä¸ªå·¥å…·æ¥ä¸‹è½½è§†é¢‘å‘¢" 0 50 0 \
            "1" "ğŸ» Annie" \
            "2" "ğŸ· You-get" \
            "3" "ğŸ¾ Youtube-dl" \
            "4" "ğŸ¹ cookieè¯´æ˜" \
            "5" "ğŸº upgradeæ›´æ–°ä¸‹è½½å·¥å…·" \
            "0" "ğŸŒš Back to the main menu è¿”å›ä¸»èœå•" \
            3>&1 1>&2 2>&3
    )
    ##########################
    case "${VIDEOTOOL}" in
    0 | "") tmoe_linux_tool_menu ;;
    1) golang_annie ;;
    2) python_you_get ;;
    3) python_youtube_dl ;;
    4) cookies_readme ;;
    5) upgrade_video_download_tool ;;
    esac
    ##########################
    press_enter_to_return
    tmoe_linux_tool_menu
}
###########
golang_annie() {
    if [ ! -e "/usr/local/bin/annie" ]; then
        printf "%s\n" "æ£€æµ‹åˆ°æ‚¨å°šæœªå®‰è£…annieï¼Œå°†ä¸ºæ‚¨è·³è½¬è‡³æ›´æ–°ç®¡ç†ä¸­å¿ƒ"
        upgrade_video_download_tool
        exit 0
    fi

    if [ ! -e "${HOME}/sd/Download/Videos" ]; then
        mkdir -pv ${HOME}/sd/Download/Videos
    fi

    cd ${HOME}/sd/Download/Videos

    AnnieVideoURL=$(whiptail --inputbox "Please enter a url.è¯·è¾“å…¥è§†é¢‘é“¾æ¥,ä¾‹å¦‚https://www.bilibili.com/video/avå·,æˆ–è€…ç›´æ¥è¾“å…¥avxxx(avå·æˆ–BVå·)ã€‚æ‚¨å¯ä»¥åœ¨urlå‰åŠ -få‚æ•°æ¥æŒ‡å®šæ¸…æ™°åº¦ï¼Œ-pæ¥ä¸‹è½½æ•´ä¸ªæ’­æ”¾åˆ—è¡¨ã€‚Press Enter after the input is completed." 12 50 --title "è¯·åœ¨åœ°å€æ å†…è¾“å…¥ è§†é¢‘é“¾æ¥" 3>&1 1>&2 2>&3)

    # printf "%s\n" "${AnnieVideoURL}" >> ${HOME}/.video_history
    if [ "$(printf '%s\n' "${AnnieVideoURL}" | grep 'b23.tv')" ]; then
        AnnieVideoURL="$(printf '%s\n' "${AnnieVideoURL}" | sed 's@b23.tv@www.bilibili.com/video@')"
    elif [ "$(printf '%s\n' "${AnnieVideoURL}" | grep '^BV')" ]; then
        AnnieVideoURL="$(printf '%s\n' "${AnnieVideoURL}" | sed 's@^BV@https://www.bilibili.com/video/&@')"
    fi
    #å½“æœªæ·»åŠ httpæ—¶ï¼Œå°†è‡ªåŠ¨ä¿®å¤ã€‚
    if [ "$(printf '%s\n' "${AnnieVideoURL}" | grep -E 'www|com')" ] && [ ! "$(printf '%s\n' "${AnnieVideoURL}" | grep 'http')" ]; then
        ls
        AnnieVideoURL=$(printf '%s\n' "${AnnieVideoURL}" | sed 's@www@http://&@')
    fi
    printf "%s\n" "${AnnieVideoURL}"
    printf "%s\n" "æ­£åœ¨è§£æä¸­..."
    printf "%s\n" "Parsing ..."
    #if [ ! $(printf '%s\n' "${AnnieVideoURL}" | grep -E '^BV|^av|^http') ]; then
    #	AnnieVideoURL=$(printf '%s\n' "${AnnieVideoURL}" | sed 's@^@http://&@')
    #fi

    annie -i ${AnnieVideoURL}
    if [ -e "${HOME}/.config/tmoe-linux/videos.cookiepath" ]; then
        VideoCookies=$(head -n 1 ${HOME}/.config/tmoe-linux/videos.cookiepath)
        annie -c ${VideoCookies} -d ${AnnieVideoURL}
    else
        annie -d ${AnnieVideoURL}
    fi
    ls -lAth ./ | head -n 3
    printf "%s\n" "è§†é¢‘æ–‡ä»¶é»˜è®¤ä¸‹è½½è‡³$(pwd)"
    printf "%s\n" "Press ${GREEN}enter${RESET} to ${BLUE}return.${RESET}"
    printf "%s\n" "æŒ‰${GREEN}å›è½¦é”®${RESET}${BLUE}è¿”å›${RESET}"
    read
    download_videos
}
###########
python_you_get() {
    if [ ! $(command -v you-get) ]; then
        printf "%s\n" "æ£€æµ‹åˆ°æ‚¨å°šæœªå®‰è£…you-get,å°†ä¸ºæ‚¨è·³è½¬è‡³æ›´æ–°ç®¡ç†ä¸­å¿ƒ"
        upgrade_video_download_tool
        exit 0
    fi

    if [ ! -e "${HOME}/sd/Download/Videos" ]; then
        mkdir -pv ${HOME}/sd/Download/Videos
    fi

    cd ${HOME}/sd/Download/Videos

    AnnieVideoURL=$(whiptail --inputbox "Please enter a url.è¯·è¾“å…¥è§†é¢‘é“¾æ¥,ä¾‹å¦‚https://www.bilibili.com/video/avå·,æ‚¨å¯ä»¥åœ¨urlå‰åŠ --formatå‚æ•°æ¥æŒ‡å®šæ¸…æ™°åº¦ï¼Œ-læ¥ä¸‹è½½æ•´ä¸ªæ’­æ”¾åˆ—è¡¨ã€‚Press Enter after the input is completed." 12 50 --title "è¯·åœ¨åœ°å€æ å†…è¾“å…¥ è§†é¢‘é“¾æ¥" 3>&1 1>&2 2>&3)
    exitstatus=$?
    if [ $exitstatus != 0 ]; then
        download_videos
    fi
    printf "%s\n" "${AnnieVideoURL}"
    printf "%s\n" "æ­£åœ¨è§£æä¸­..."
    printf "%s\n" "Parsing ..."
    you-get -i ${AnnieVideoURL}
    if [ -e "${HOME}/.config/tmoe-linux/videos.cookiepath" ]; then
        VideoCookies=$(head -n 1 ${HOME}/.config/tmoe-linux/videos.cookiepath)
        you-get -c ${VideoCookies} -d ${AnnieVideoURL}
    else
        you-get -d ${AnnieVideoURL}
    fi
    ls -lAth ./ | head -n 3
    printf "%s\n" "è§†é¢‘æ–‡ä»¶é»˜è®¤ä¸‹è½½è‡³$(pwd)"
    printf "%s\n" "Press ${GREEN}enter${RESET} to ${BLUE}return.${RESET}"
    printf "%s\n" "æŒ‰${GREEN}å›è½¦é”®${RESET}${BLUE}è¿”å›${RESET}"
    read
    download_videos
}
############
python_youtube_dl() {
    if [ ! $(command -v youtube-dl) ]; then
        printf "%s\n" "æ£€æµ‹åˆ°æ‚¨å°šæœªå®‰è£…youtube-dl,å°†ä¸ºæ‚¨è·³è½¬è‡³æ›´æ–°ç®¡ç†ä¸­å¿ƒ"
        upgrade_video_download_tool
        exit 0
    fi

    if [ ! -e "${HOME}/sd/Download/Videos" ]; then
        mkdir -pv ${HOME}/sd/Download/Videos
    fi

    cd ${HOME}/sd/Download/Videos

    AnnieVideoURL=$(whiptail --inputbox "Please enter a url.è¯·è¾“å…¥è§†é¢‘é“¾æ¥,ä¾‹å¦‚https://www.bilibili.com/video/avå·,æ‚¨å¯ä»¥åœ¨urlå‰åŠ --yes-playlistæ¥ä¸‹è½½æ•´ä¸ªæ’­æ”¾åˆ—è¡¨ã€‚Press Enter after the input is completed." 12 50 --title "è¯·åœ¨åœ°å€æ å†…è¾“å…¥ è§†é¢‘é“¾æ¥" 3>&1 1>&2 2>&3)
    exitstatus=$?
    if [ $exitstatus != 0 ]; then
        download_videos
    fi
    printf "%s\n" "${AnnieVideoURL}"
    printf "%s\n" "æ­£åœ¨è§£æä¸­..."
    printf "%s\n" "Parsing ..."
    youtube-dl -e --get-description --get-duration ${AnnieVideoURL}
    if [ -e "${HOME}/.config/tmoe-linux/videos.cookiepath" ]; then
        VideoCookies=$(head -n 1 ${HOME}/.config/tmoe-linux/videos.cookiepath)
        youtube-dl --merge-output-format mp4 --all-subs --cookies ${VideoCookies} -v ${AnnieVideoURL}
    else
        youtube-dl --merge-output-format mp4 --all-subs -v ${AnnieVideoURL}
    fi
    ls -lAth ./ | head -n 3
    printf "%s\n" "è§†é¢‘æ–‡ä»¶é»˜è®¤ä¸‹è½½è‡³$(pwd)"
    printf "%s\n" "Press ${GREEN}enter${RESET} to ${BLUE}return.${RESET}"
    printf "%s\n" "æŒ‰${GREEN}å›è½¦é”®${RESET}${BLUE}è¿”å›${RESET}"
    read
    download_videos
}
#############
###################################
cookies_readme() {
    cat <<-'EndOFcookies'
		è‹¥æ‚¨éœ€è¦ä¸‹è½½å¤§ä¼šå‘˜è§†é¢‘ï¼Œåˆ™éœ€è¦æŒ‡å®šcookieæ–‡ä»¶è·¯å¾„ã€‚
		åŠ è½½cookieåï¼Œå³ä½¿æ‚¨ä¸æ˜¯å¤§ä¼šå‘˜ï¼Œä¹Ÿèƒ½æé«˜éƒ¨åˆ†ç½‘ç«™çš„ä¸‹è½½é€Ÿåº¦ã€‚
		cookieæ–‡ä»¶åŒ…å«äº†ä¼šå‘˜èº«ä»½è®¤è¯å‡­æ®ï¼Œè¯·å‹¿å°†è¯¥æ–‡ä»¶æ³„éœ²å‡ºå»ï¼
		ä¸€ä¸ªcookieæ–‡ä»¶å¯ä»¥åŒ…å«å¤šä¸ªç½‘ç«™çš„cookiesï¼Œæ‚¨åªéœ€è¦æ‰‹åŠ¨å°†åŒ…å«cookieæ•°æ®çš„çº¯æ–‡æœ¬å¤åˆ¶è‡³cookies.txtæ–‡ä»¶å³å¯ã€‚
		æ‚¨éœ€è¦å®‰è£…æµè§ˆå™¨æ‰©å±•æ’ä»¶æ¥å¯¼å‡ºcookieï¼Œéƒ¨åˆ†æ’ä»¶è¿˜éœ€æ‰‹åŠ¨é…ç½®å¯¼å‡ºæ ¼å¼ä¸ºNetscapeï¼Œå¹¶å°†åç¼€åä¿®æ”¹ä¸ºtxt
		å¯¹äºä¸åŒå¹³å°(windowsã€linuxå’Œmacos)å¯¼å‡ºçš„cookieæ–‡ä»¶ï¼Œå¦‚éœ€è·¨å¹³å°åŠ è½½ï¼Œåˆ™éœ€è¦è½¬æ¢ä¸ºç›¸åº”ç³»ç»Ÿçš„æ¢è¡Œç¬¦ã€‚
		æµè§ˆå™¨å•†åº—ä¸­åŒ…å«å¤šä¸ªç›¸å…³æ‰©å±•æ’ä»¶ï¼Œä½†ä¸åŒæ’ä»¶å¯¼å‡ºçš„cookieæ–‡ä»¶å¯èƒ½å­˜åœ¨å…¼å®¹æ€§çš„å·®å¼‚ã€‚
		ä¾‹å¦‚ç«ç‹æ‰©å±•cookies-txtï¼ˆé€‚ç”¨äºyou-get v0.4.1432ï¼Œä¸é€‚ç”¨äºannie v0.9.8ï¼‰
		https://addons.mozilla.org/zh-CN/firefox/addon/cookies-txt/
		å†æ¬¡æé†’ï¼Œcookieéå¸¸é‡è¦!
		å¸Œæœ›æ‚¨èƒ½ä»”ç»†ç”„åˆ«ï¼Œå ¤é˜²æ¶æ„æ’ä»¶ã€‚
		åŒæ—¶å¸Œæœ›æ‚¨èƒ½å¤Ÿäº†è§£ï¼Œå°†cookieæ–‡ä»¶æ³„éœ²å‡ºå»ç­‰åŒäºå°†è´¦å·æ³„å¯†ï¼
		è¯·å¦¥å–„ä¿ç®¡å¥½è¯¥æ–‡ä»¶åŠç›¸å…³æ•°æ®ï¼
	EndOFcookies
    if [ -e "${HOME}/.config/tmoe-linux/videos.cookiepath" ]; then
        printf "%s\n" "æ‚¨å½“å‰çš„cookieè·¯å¾„ä¸º$(head -n 1 ${HOME}/.config/tmoe-linux/videos.cookiepath)"
    fi
    RETURN_TO_WHERE='download_videos'
    do_you_want_to_continue
    if [ -e "${HOME}/.config/tmoe-linux/videos.cookiepath" ]; then
        COOKIESTATUS="æ£€æµ‹åˆ°æ‚¨å·²å¯ç”¨åŠ è½½cookieåŠŸèƒ½"
        CURRENT_COOKIE_PATH=$(head -n 1 ${HOME}/.config/tmoe-linux/videos.cookiepath)
        CurrentCOOKIESpath="æ‚¨å½“å‰çš„cookieè·¯å¾„ä¸º${CURRENT_COOKIE_PATH}"
    else
        COOKIESTATUS="æ£€æµ‹åˆ°cookieå¤„äºç¦ç”¨çŠ¶æ€"
        CurrentCOOKIESpath="${COOKIESTATUS}"
    fi

    mkdir -pv "${HOME}/.config/tmoe-linux"
    if (whiptail --title "modify cookie path and status" --yes-button 'æŒ‡å®šcookie file' --no-button 'disableç¦ç”¨cookie' --yesno "æ‚¨æƒ³è¦ä¿®æ”¹å“ªäº›é…ç½®ä¿¡æ¯ï¼Ÿ${COOKIESTATUS} Which configuration do you want to modify?" 9 50); then
        IMPORTANT_TIPS="${CurrentCOOKIESpath}"
        CURRENT_QEMU_ISO="${CURRENT_COOKIE_PATH}"
        FILE_EXT_01='txt'
        FILE_EXT_02='sqlite'
        where_is_tmoe_file_dir
        if [ -z ${SELECTION} ]; then
            printf "%s\n" "æ²¡æœ‰æŒ‡å®š${YELLOW}æœ‰æ•ˆ${RESET}çš„${BLUE}æ–‡ä»¶${GREEN}ï¼Œè¯·${GREEN}é‡æ–°${RESET}é€‰æ‹©"
        else
            printf "%s\n" "${TMOE_FILE_ABSOLUTE_PATH}" >"${HOME}/.config/tmoe-linux/videos.cookiepath"
            printf "%s\n" "æ‚¨å½“å‰çš„cookieæ–‡ä»¶è·¯å¾„ä¸º${TMOE_FILE_ABSOLUTE_PATH}"
            ls -lah ${TMOE_FILE_ABSOLUTE_PATH}
        fi
    else
        rm -f "${HOME}/.config/tmoe-linux/videos.cookiepath"
        printf "%s\n" "å·²ç¦ç”¨åŠ è½½cookieåŠŸèƒ½"
    fi
    press_enter_to_return
    download_videos
}
#########
check_latest_video_download_tool_version() {
    printf "%s\n" "æ­£åœ¨${YELLOW}æ£€æµ‹${RESET}${GREEN}ç‰ˆæœ¬ä¿¡æ¯${RESET}..."
    cat <<-ENDofnote
		å¦‚éœ€${YELLOW}å¸è½½${RESET}${BLUE}annie${RESET},è¯·è¾“${GREEN}rm /usr/local/bin/annie${RESET}
		å¦‚éœ€${YELLOW}å¸è½½${RESET}${BLUE}you-get${RESET},è¯·è¾“${GREEN}pip3 uninstall you-get${RESET}
		å¦‚éœ€${YELLOW}å¸è½½${RESET}${BLUE}youtube-dl${RESET},è¯·è¾“${GREEN}pip3 uninstall youtube-dl${RESET}
	ENDofnote

    LATEST_ANNIE_VERSION=$(curl -LfsS https://gitee.com/mo2/annie/raw/linux_amd64/annie_version.txt | head -n 1)

    ####################
    if [ $(command -v you-get) ]; then
        YouGetVersion=$(you-get -V 2>&1 | head -n 1 | cut -d ':' -f 2 | cut -d ',' -f 1 | awk -F ' ' '$0=$NF')
    else
        YouGetVersion='æ‚¨å°šæœªå®‰è£…you-get'
    fi
    #LATEST_YOU_GET_VERSION=$(curl -LfsS https://github.com/soimort/you-get/releases | grep 'muted-link css-truncate' | head -n 1 | cut -d '=' -f 2 | cut -d '"' -f 2 | cut -d '/' -f 5)

    #######################
    if [ $(command -v youtube-dl) ]; then
        YOTUBEdlVersion=$(youtube-dl --version 2>&1 | head -n 1)
    else
        YOTUBEdlVersion='æ‚¨å°šæœªå®‰è£…youtube-dl'
    fi
    #LATEST_YOUTUBE_DL_VERSION=$(curl -LfsS https://github.com/ytdl-org/youtube-dl/releases | grep 'muted-link css-truncate' | head -n 1 | cut -d '=' -f 2 | cut -d '"' -f 2 | cut -d '/' -f 5)
    LATEST_YOUTUBE_DL_VERSION=$(curl -LfsS https://mirrors.bfsu.edu.cn/pypi/web/simple/youtube-dl/ | grep .whl | tail -n 1 | cut -d '=' -f 3 | cut -d '>' -f 2 | cut -d '<' -f 1 | cut -d '-' -f 2)
    ##################
    cat <<-ENDofTable
		â•”â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
		â•‘   â•‘          â•‘                   â•‘                    
		â•‘   â•‘ software â•‘ æœ€æ–°ç‰ˆæœ¬          â•‘   æœ¬åœ°ç‰ˆæœ¬ ğŸª
		â•‘   â•‘          â•‘latest versionâœ¨   â•‘  Local version     
		â•‘---â•‘----------â•‘-------------------â•‘--------------------
		â•‘ 1 â•‘   annie  â•‘                   â•‘ ${AnnieVersion}
		â•‘   â•‘          â•‘${LATEST_ANNIE_VERSION}
		â•‘---â•‘----------â•‘-------------------â•‘--------------------
		â•‘   â•‘          â•‘                   â•‘ ${YouGetVersion}                   
		â•‘ 2 â•‘ you-get  â•‘                   â•‘  
		â•‘---â•‘----------â•‘-------------------â•‘--------------------
		â•‘   â•‘          â•‘                   â•‘ ${YOTUBEdlVersion}                  
		â•‘ 3 â•‘youtube-dlâ•‘${LATEST_YOUTUBE_DL_VERSION}           â•‘  

		annie: github.com/iawia002/annie
		you-get : github.com/soimort/you-get
		youtube-dlï¼šgithub.com/ytdl-org/youtube-dl
	ENDofTable
    #å¯¹åŸå¼€å‘è€…iawia002çš„ä»£ç è¿›è¡Œè‡ªåŠ¨ç¼–è¯‘
    printf "%s\n" "ä¸ºé¿å…åŠ è½½è¶…æ—¶ï¼Œæ•…${RED}éšè—${RESET}äº†éƒ¨åˆ†è½¯ä»¶çš„${GREEN}ç‰ˆæœ¬ä¿¡æ¯ã€‚${RESET}"
    printf "%s\n" "annieå°†äºæ¯æœˆ1å·å‡Œæ™¨4ç‚¹è‡ªåŠ¨ç¼–è¯‘å¹¶å‘å¸ƒæœ€æ–°ç‰ˆ"
    printf "%s\n" "æ‚¨å¯ä»¥æŒ‰${GREEN}å›è½¦é”®${RESET}æ¥${BLUE}è·å–æ›´æ–°${RESET}ï¼Œäº¦å¯å‰å¾€åŸå¼€å‘è€…çš„ä»“åº“æ¥${GREEN}æ‰‹åŠ¨ä¸‹è½½${RESET}æ–°ç‰ˆ"
}
##################
upgrade_video_download_tool() {
    cat <<-'ENDofTable'
		â•”â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•¦
		â•‘   â•‘ ğŸ’» type    â•‘    ğŸ¬  â•‘   ğŸŒ   â•‘   ğŸ“š    â•‘
		â•‘   â•‘----------- â•‘ Videos â•‘ Images â•‘Playlist â•‘
		â•‘   â•‘ website    â•‘        â•‘        â•‘         â•‘
		â•‘---â•‘------------â•‘--------â•‘--------â•‘---------â•‘
		â•‘ 1 â•‘  bilibili  â•‘  âœ“     â•‘        â•‘   âœ“     â•‘
		â•‘   â•‘            â•‘        â•‘        â•‘         â•‘
		â•‘---â•‘------------â•‘--------â•‘--------â•‘---------â•‘
		â•‘   â•‘            â•‘        â•‘        â•‘         â•‘
		â•‘ 2 â•‘  tiktok    â•‘  âœ“     â•‘        â•‘         â•‘
		â•‘---â•‘------------â•‘--------â•‘--------â•‘---------â•‘
		â•‘   â•‘            â•‘        â•‘        â•‘         â•‘
		â•‘ 3 â•‘ youku      â•‘  âœ“     â•‘        â•‘         â•‘
		â•‘---â•‘------------â•‘--------â•‘--------â•‘---------â•‘
		â•‘   â•‘            â•‘        â•‘        â•‘         â•‘
		â•‘ 4 â•‘ youtube    â•‘  âœ“     â•‘        â•‘   âœ“     â•‘
		â•‘---â•‘------------â•‘--------â•‘--------â•‘---------â•‘
		â•‘   â•‘            â•‘        â•‘        â•‘         â•‘
		â•‘ 5 â•‘ iqiyi      â•‘  âœ“     â•‘        â•‘         â•‘
		â•‘---â•‘------------â•‘--------â•‘--------â•‘---------â•‘
		â•‘   â•‘            â•‘        â•‘        â•‘         â•‘
		â•‘ 6 â•‘  weibo     â•‘  âœ“     â•‘        â•‘         â•‘
		â•‘---â•‘------------â•‘--------â•‘--------â•‘---------â•‘
		â•‘   â•‘ netease    â•‘        â•‘        â•‘         â•‘
		â•‘ 7 â•‘ 163music   â•‘  âœ“     â•‘        â•‘         â•‘
		â•‘---â•‘------------â•‘--------â•‘--------â•‘---------â•‘
		â•‘   â•‘ tencent    â•‘        â•‘        â•‘         â•‘
		â•‘ 8 â•‘ video      â•‘  âœ“     â•‘        â•‘         â•‘
		â•‘---â•‘------------â•‘--------â•‘--------â•‘---------â•‘
		â•‘   â•‘            â•‘        â•‘        â•‘         â•‘
		â•‘ 9 â•‘ instagram  â•‘  âœ“     â•‘  âœ“     â•‘         â•‘
		â•‘---â•‘------------â•‘--------â•‘--------â•‘---------â•‘
		â•‘   â•‘            â•‘        â•‘        â•‘         â•‘
		â•‘10 â•‘  twitter   â•‘  âœ“     â•‘        â•‘         â•‘
		â•‘---â•‘------------â•‘--------â•‘--------â•‘---------â•‘
		â•‘   â•‘            â•‘        â•‘        â•‘         â•‘
		â•‘11 â•‘ douyu      â•‘  âœ“     â•‘        â•‘         â•‘
		â•‘---â•‘------------â•‘--------â•‘--------â•‘---------â•‘
		â•‘   â•‘            â•‘        â•‘        â•‘         â•‘
		â•‘12 â•‘pixivision  â•‘        â•‘  âœ“     â•‘         â•‘
		â•‘---â•‘------------â•‘--------â•‘--------â•‘---------â•‘
		â•‘   â•‘            â•‘        â•‘        â•‘         â•‘
		â•‘13 â•‘ pornhub    â•‘  âœ“     â•‘        â•‘         â•‘

	ENDofTable

    if [ -e "/usr/local/bin/annie" ]; then
        #AnnieVersion=$(annie -v | cut -d ':' -f 2 | cut -d ',' -f 1 | awk -F ' ' '$0=$NF')
        AnnieVersion=$(cat ~/.config/tmoe-linux/annie_version.txt | head -n 1)
        check_latest_video_download_tool_version
    else
        AnnieVersion='æ‚¨å°šæœªå®‰è£…annie'
        printf "%s\n" "æ£€æµ‹åˆ°æ‚¨${RED}å°šæœªå®‰è£…${RESET}annieï¼Œè·³è¿‡${GREEN}ç‰ˆæœ¬æ£€æµ‹ï¼${RESET}"
    fi

    printf "%s\n" "æŒ‰${GREEN}å›è½¦é”®${RESET}å°†åŒæ—¶æ›´æ–°${YELLOW}annieã€you-getå’Œyoutube-dl${RESET}"
    printf '%s\n' 'Press Enter to update'
    RETURN_TO_WHERE='download_videos'
    do_you_want_to_continue
    unset DEPENDENCY_01 DEPENDENCY_02

    for i in python3 ffmpeg; do
        if [ -z "$(command -v ${i})" ]; then
            printf "%s\n" "${GREEN}${TMOE_INSTALLATION_COMMAND} ${BLUE}${i}${RESET}"
            ${TMOE_INSTALLATION_COMMAND} "$i"
        fi
    done

    if [ -z "$(command -v pip3)" ]; then
        case "$LINUX_DISTRO" in
        alpine) DEPENDENCY_02="${DEPENDENCY_02} py3-pip" ;;
        debian | redhat) DEPENDENCY_02="${DEPENDENCY_02} python3-pip" ;;
        * | arch) DEPENDENCY_02="${DEPENDENCY_02} python-pip" ;;
        esac

        beta_features_quick_install
        if [ -z "$(command -v pip3)" ]; then
            printf "%s\n" "${RED}Sorry,${RESET}please install pip3 manually." \
                "curl -LO https://bootstrap.pypa.io/get-pip.py" \
                "python3 get-pip.py || python3 get-pip.py -i https://mirrors.bfsu.edu.cn/pypi/web/simple"
            press_enter_to_continue
        fi
    fi

    cd /tmp || exit 1

    rm -rf ./.ANNIETEMPFOLDER
    git clone -b linux_${ARCH_TYPE} --depth=1 https://gitee.com/mo2/annie ./.ANNIETEMPFOLDER
    cd ./.ANNIETEMPFOLDER
    tar -Jxvf annie.tar.xz
    chmod a+rx annie
    mkdir -pv ~/.config/tmoe-linux/
    mv -f annie_version.txt ~/.config/tmoe-linux/
    mv -f annie /usr/local/bin/
    annie -v
    cd ..
    rm -rf ./.ANNIETEMPFOLDER
    #mkdir -pv ${HOME}/.config
    #pip3 config set global.index-url https://mirrors.bfsu.edu.cn/pypi/web/simple
    sudo -H pip3 install pip -U -i https://mirrors.bfsu.edu.cn/pypi/web/simple 2>/dev/null || su -c "pip3 install pip -U -i https://mirrors.bfsu.edu.cn/pypi/web/simple"
    sudo -H pip3 install you-get -U -i https://mirrors.bfsu.edu.cn/pypi/web/simple || su -c "pip3 install you-get -U -i https://mirrors.bfsu.edu.cn/pypi/web/simple"
    you-get -V
    sudo -H pip3 install youtube-dl -U -i https://mirrors.bfsu.edu.cn/pypi/web/simple || su -c "pip3 install youtube-dl -U -i https://mirrors.bfsu.edu.cn/pypi/web/simple"
    youtube-dl -v 2>&1 | grep version
    printf "%s\n" "æ›´æ–°å®Œæ¯•ï¼Œå¦‚éœ€${YELLOW}å¸è½½${RESET}annie,è¯·è¾“${YELLOW}rm /usr/local/bin/annie${RESET}"
    printf "%s\n" "If you want to remove ${BLUE}you-get${RESET},then type ${GREEN}pip3 ${PURPLE}uninstall ${YELLOW}you-get${RESET}"
    printf "%s\n" "If you want to remove ${BLUE}youtube-dl${RESET},then type ${GREEN}pip3 ${PURPLE}uninstall ${YELLOW}youtube-dl${RESET}"
    #printf "%s\n" "è¯·é—®æ‚¨æ˜¯å¦éœ€è¦å°†pipæºåˆ‡æ¢ä¸ºBFSUæº[Y/n]?"
    #printf "%s\n" "pip3 config set global.index-url https://mirrors.bfsu.edu.cn/pypi/web/simple"
    #printf "%s\n" "If you are not living in the People's Republic of China, then please type ${YELLOW}n${RESET} .${PURPLE}[Y/n]${RESET}"
    RETURN_TO_WHERE='download_videos'
    printf '%s\n' 'Press Enter to start annie'
    printf "%s\n" "${YELLOW}æŒ‰å›è½¦é”®å¯åŠ¨annieã€‚${RESET}"
    do_you_want_to_continue
    golang_annie
}
##################
download_videos
