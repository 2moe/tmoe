#!/usr/bin/env bash
#######################################
vnc_can_not_call_pulse_audio() {
    printf "%s\n" "å¦‚æœæ‚¨çš„å®¿ä¸»æœºä¸ºGNU/linuxå®ä½“æœºï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥æ‰‹åŠ¨é…ç½®éŸ³é¢‘æœåŠ¡ã€‚"
    printf "%s\n" "${RED}sudo ${GREEN}editor ${BLUE}/etc/pulse/default.pa${RESET} || ${RED}sudo ${GREEN}nano ${BLUE}/etc/pulse/default.pa${RESET}"
    printf "%s\n" "åœ¨æœ€åä¸€è¡Œé‡ŒåŠ ä¸Š${GREEN}load-module module-native-protocol-tcp auth-ip-acl=127.0.0.1 auth-anonymous=0${RESET}ï¼Œæ¥ç€é‡å¯pulseaudioæœåŠ¡"
    printf "%s\n" "é™¤äº†ä¿®æ”¹é…ç½®å¤–ï¼Œæ‚¨ä¹Ÿå¯ä»¥ç”¨æ™®é€šç”¨æˆ·èº«ä»½æ‰§è¡Œ${GREEN}pulseaudio ${YELLOW}--start --exit-idle-time=-1;pacmd load-module module-native-protocol-tcp auth-ip-acl=${BLUE}'127.0.0.1;192.168.0.0/16;172.16.0.0/12'${RESET}"
    printf "%s\n" "æ‰§è¡Œ${GREEN}pulseaudio ${RED}-k${RESET}æˆ–è€…${RED}pkill ${BLUE}pulseaudio${RESET}æ€æ­»éŸ³é¢‘æœåŠ¡åå°è¿›ç¨‹ã€‚"

    printf "%s\n" "è‹¥æ‚¨çš„å®¿ä¸»æœºä¸ºAndroidç³»ç»Ÿï¼Œåˆ™è¯·é˜…è§ˆä¸‹é¢çš„è¯´æ˜ã€‚"
    printf "%s\n" "é¦–å…ˆè¯·ç¡®ä¿æ‚¨çš„termuxä¸ºæœ€æ–°ç‰ˆæœ¬ï¼Œå¹¶å®‰è£…äº†termux:api"
    printf "%s\n" "è‹¥éŸ³é¢‘æœåŠ¡æ— æ³•å¯åŠ¨ï¼Œåˆ™è¯·åœ¨å¯åŠ¨å®Œæˆåï¼Œæ–°å»ºä¸€ä¸ªtermux sessionä¼šè¯çª—å£ï¼Œç„¶åæ‰‹åŠ¨åœ¨termuxåŸç³»ç»Ÿé‡Œè¾“${GREEN}pulseaudio -D${RESET}æ¥å¯åŠ¨éŸ³é¢‘æœåŠ¡åå°è¿›ç¨‹"
    printf "%s\n" "æ‚¨äº¦å¯è¾“${GREEN}pulseaudio --start${RESET}"
    printf "%s\n" "æ‚¨è‹¥æ— æ³•è®°ä½è¯¥å‘½ä»¤ï¼Œåˆ™åªéœ€è¾“${GREEN}debian${RESET}"
    printf "%s\n" "è‹¥æ‚¨æ— æ³•è°ƒç”¨termuxçš„éŸ³é¢‘ï¼Œåˆ™è¯·å°†xsdl appæŒ‚äºåå°ï¼Œæ­¤æ—¶æ‰§è¡Œ${GREEN}startvnc${RESET}å°†è°ƒç”¨xsdlçš„éŸ³é¢‘æœåŠ¡ã€‚"
    printf "%s\n" "æŒ‰å›è½¦é”®è‡ªåŠ¨å¯åŠ¨éŸ³é¢‘æœåŠ¡"
    printf "%s\n" "Press ${GREEN}Enter${RESET} to start ${BLUE}pulseaudio${RESET}."
    do_you_want_to_continue
    if [[ $(command -v am) ]]; then
        printf "%s\n" "${GREEN}Staring ${BLUE}x.org.server/x.org.server.MainActivity${RESET} ..."
        am start -n x.org.server/x.org.server.MainActivity 2>/dev/null
        sleep 3
    fi
    printf "%s\n" "${GREEN}Staring ${BLUE}pulseaudio${RESET} ..."
    pulseaudio --start --exit-idle-time=3600
    pacmd load-module module-native-protocol-tcp auth-ip-acl='127.0.0.1;192.168.0.0/16;172.16.0.0/12' auth-anonymous=1
}
###############
create_start_linux_deploy_sh() {
    cd $PREFIX/bin
    printf "%s\n" "${CUT_TARGET}"
    cat >"${CUT_TARGET}" <<-'EndofFile'
		#!/usr/bin/env bash
		pulseaudio --start
		printf "%s\n" "pulseaudioæœåŠ¡å¯åŠ¨å®Œæˆï¼Œå°†ä¸ºæ‚¨è‡ªåŠ¨æ‰“å¼€LinuxDeploy,è¯·ç‚¹å‡»â€œå¯åŠ¨â€ã€‚"
		am start -n ru.meefik.linuxdeploy/ru.meefik.linuxdeploy.Launcher
		sleep 6
		am start -n com.realvnc.viewer.android/com.realvnc.viewer.android.app.ConnectionChooserActivity
	EndofFile
}
##############
linux_deploy_pulse_server() {
    printf "%s\n" "è‹¥æ‚¨éœ€è¦åœ¨Linux Deployä¸Šé…ç½®VNCçš„éŸ³é¢‘è½¬å‘åŠŸèƒ½ï¼Œè¯·ä½¿ç”¨æœ¬å·¥å…·ç®±(Tmoe-linux tools)è¦†ç›–å®‰è£…æ¡Œé¢ç¯å¢ƒ"
    printf "%s\n" "æ‚¨åœ¨å®‰è£…Linux deployçš„chrootå®¹å™¨å‰ï¼Œå¯ä»¥å°†å®‰è£…ç±»å‹ä¿®æ”¹ä¸ºç›®å½•ï¼Œå®‰è£…è·¯å¾„ä¿®æ”¹ä¸º/data/data/ru.meefik.linuxdeploy/linux"
    printf "%s\n" "è„šæœ¬ç”¨æ³•ï¼šsshè¿æ¥åï¼Œè¾“å…¥apt install -y curl;bash -c \"(curl -L ${TMOE_GIT_URL}/raw/2/2)\""
    #printf "%s\n" "è¦†ç›–å®‰è£…ä¹‹åï¼Œæ‚¨éœ€è¦é€šè¿‡æœ¬å·¥å…·è¿›è¡ŒVNCå’ŒéŸ³é¢‘æœåŠ¡çš„é…ç½®"
    printf "%s\n" "æ¥ä¸‹æ¥æ‚¨éœ€è¦è®¾å®šä¸€ä¸ªæ‚¨ç‹¬æœ‰çš„å¯åŠ¨å‘½ä»¤ï¼Œä¾‹å¦‚startl"
    printf "%s\n" "æ‚¨ä¹‹åå¯ä»¥åœ¨termuxé‡Œè¾“å…¥æ­¤å‘½ä»¤æ¥å¯åŠ¨Linux Deployä»¥åŠéŸ³é¢‘æœåŠ¡"
    do_you_want_to_continue
    TARGET=$("${TUI_BIN:-whiptail}" --inputbox "è¯·è‡ªå®šä¹‰å¯åŠ¨å‘½ä»¤åç§°\n Please enter the command name." 12 50 --title "COMMAND" 3>&1 1>&2 2>&3)
    CUT_TARGET="$(printf '%s\n' "${TARGET}" | head -n 1 | cut -d ' ' -f 1)"
    if [ -z "${CUT_TARGET}" ]; then
        printf "%s\n" "å‘½ä»¤åç§°ä¸èƒ½ä¸ºç©ºï¼ï¼ï¼"
    else
        create_start_linux_deploy_sh
    fi
    if [ ! -z ${CUT_TARGET} ]; then
        chmod a+rx ${CUT_TARGET}
        ls -lh ${PREFIX}/bin/${CUT_TARGET}
        printf "%s\n" "Congratulations!é…ç½®æˆåŠŸï¼Œæ‚¨ä¹‹åå¯ä»¥è¾“${CUT_TARGET}æ¥å¯åŠ¨"
    else
        printf "%s\n" "æ£€æµ‹åˆ°æ‚¨å–æ¶ˆäº†æ“ä½œ"
    fi
}
##########################
manager_frequently_asked_questions() {
    RETURN_TO_WHERE=manager_frequently_asked_questions
    # 15 60 5
    TMOE_FAQ=$("${TUI_BIN:-whiptail}" --title "FAQ(ã‚ˆãã‚ã‚‹è³ªå•)" --menu \
        "æ‚¨æœ‰å“ªäº›ç–‘é—®ï¼Ÿ\nWhat questions do you have?" 0 50 0 \
        "1" "how to customize the dirå¦‚ä½•è‡ªå®šä¹‰å®¹å™¨ç›®å½•" \
        "2" "how to use micro editorå¦‚ä½•ä½¿ç”¨micro" \
        "3" "cannot rm containeræ— æ³•ç§»é™¤å®¹å™¨" \
        "4" "About auto conf(å…³äºè‡ªåŠ¨é…ç½®)" \
        "5" "VNCæ— æ³•è°ƒç”¨éŸ³é¢‘" \
        "6" "ç»™Linux Deployé…ç½®VNCéŸ³é¢‘" \
        "7" "å½“å®¹å™¨ç›®å½•ä½äºå¤–ç½®ç¡¬ç›˜æ—¶,sudoå‡ºç°nosuidé”™è¯¯" \
        "0" "ğŸŒš Back to the main menu è¿”å›ä¸»èœå•" \
        3>&1 1>&2 2>&3)
    ##############################
    case "${TMOE_FAQ}" in
    0 | "") tmoe_manager_main_menu ;;
    1) how_to_customize_the_container_dir ;;
    2) how_to_use_micro_editor ;;
    3) can_not_remove_the_container ;;
    4) questions_about_tmoe_automatic_configuration ;;
    5) vnc_can_not_call_pulse_audio ;;
    6) linux_deploy_pulse_server ;;
    7)
        printf "%s\n" "å‡è®¾æ‚¨å°†å®¹å™¨è·¯å¾„è½¯é“¾æ¥åˆ°å¤–ç½®ç§»åŠ¨ç¡¬ç›˜çš„æŸä¸ªåˆ†åŒºé‡Œçš„æŸä¸ªç›®å½•"
        printf "%s\n" "æ³¨:è¯¥åˆ†åŒºçš„æ–‡ä»¶ç³»ç»Ÿ(File system)å¯ä¸ºext4/btrfs/xfsç­‰, ä¸èƒ½ä¸ºntfs/fat32/exfat"
        printf "%s\n" "é¦–å…ˆè¯·ç¡®ä¿å®¹å™¨å†…éƒ¨/usr/bin/sudoæ–‡ä»¶æƒé™ä¸º4755,ä¸”æ‰€å±ä¸º0:0"

        printf "%s\n" "æ¥ç€åœ¨å®¿ä¸»ç¯å¢ƒä¸‹å¯¹è¯¥ç¡¬ç›˜è¿›è¡Œé‡æ–°æŒ‚è½½"
        printf "%s\n" "${YELLOW}Example:${RESET}"
        printf "%s\n" "å‡è®¾è¯¥ç¡¬ç›˜ä¸º/dev/nvmexnxpx"
        printf "%s\n" "è¾“å…¥  ${GREEN}mount${RESET} | grep ${BLUE}/dev/nvmexnxpx${RESET} è·å–æŒ‚è½½å‚æ•°"
        printf "%s\n" "è‹¥è·å–åˆ°çš„ç»“æœä¸º${YELLOW}/dev/nvmexnxpx on /media/xxx/mountpoint type btrfs (rw,nosuid,nodev,relatime,space_cache,subvolid=5,subvol=/,uhelper=udisks2)${RESET}"
        printf "%s\n" "é‚£ä¹ˆç¨å¾®æ”¹åŠ¨ä¸€ä¸‹, ç”Ÿæˆæ–°çš„æŒ‚è½½å‘½ä»¤"
        printf "%s\n" "sudo mount -o remount,rw,suid,nodev,relatime,space_cache,subvolid=5,subvol=/,uhelper=udisks2 /dev/nvmexnxpx /media/xxx/mountpoint"
        ;;
    esac
    #subvolid=5,subvol=/,compress=zstd
    #############
    press_enter_to_return
    manager_frequently_asked_questions
}
###########################
how_to_use_micro_editor() {
    how_to_use_micro_editor_zh() {
        cat <<-EOF
			${GREEN}Ctrl + ${YELLOW}S  ${BLUE}ä¿å­˜
			${GREEN}Ctrl + ${YELLOW}Q  ${BLUE}é€€å‡º
			${GREEN}Ctrl + ${YELLOW}C  ${BLUE}å¤åˆ¶
			${GREEN}Ctrl + ${YELLOW}V  ${BLUE}ç²˜è´´
			${GREEN}Ctrl + ${YELLOW}X  ${BLUE}å‰ªåˆ‡
			${GREEN}Ctrl + ${YELLOW}/  ${BLUE}æ³¨é‡Š
			${GREEN}Ctrl + ${YELLOW}Z  ${BLUE}æ’¤é”€
			${GREEN}Ctrl + ${YELLOW}Y  ${BLUE}é‡åš
			${GREEN}Ctrl + ${YELLOW}L  ${BLUE}è·³è½¬åˆ°æŒ‡å®šè¡Œ
			${GREEN}Ctrl + ${YELLOW}F  ${BLUE}æœç´¢
			${GREEN}Ctrl + ${YELLOW}N  ${BLUE}æœç´¢ä¸‹ä¸€ä¸ª
			${GREEN}Ctrl + ${YELLOW}P  ${BLUE}æœç´¢ä¸Šä¸€ä¸ª${RESET}
		EOF
    }
    how_to_use_micro_editor_en() {
        cat <<-EOF
			${GREEN}Ctrl + ${YELLOW}S  ${BLUE}Save
			${GREEN}Ctrl + ${YELLOW}Q  ${BLUE}Quit
			${GREEN}Ctrl + ${YELLOW}C  ${BLUE}Copy
			${GREEN}Ctrl + ${YELLOW}V  ${BLUE}Paste
			${GREEN}Ctrl + ${YELLOW}X  ${BLUE}Cut
			${GREEN}Ctrl + ${YELLOW}/  ${BLUE}Toggle Line Comment
			${GREEN}Ctrl + ${YELLOW}Z  ${BLUE}Undo
			${GREEN}Ctrl + ${YELLOW}Y  ${BLUE}Redo
			${GREEN}Ctrl + ${YELLOW}L  ${BLUE}Go to the designated line
			${GREEN}Ctrl + ${YELLOW}F  ${BLUE}Find
			${GREEN}Ctrl + ${YELLOW}N  ${BLUE}FindNext
			${GREEN}Ctrl + ${YELLOW}P  ${BLUE}FindPrevious${RESET}
		EOF
    }
    case ${TMOE_MENU_LANG} in
    zh_*UTF-8) how_to_use_micro_editor_zh ;;
    *) how_to_use_micro_editor_en ;;
    esac
    if [ ! $(command -v micro) ]; then
        printf "%s\n" "Do you want to install ${BLUE}micro${RESET} editor?[Y/n]"
        printf "%s\n" "${GREEN}${TMOE_INSTALLATION_COMMAND} ${BLUE}micro${RESET}"
        do_you_want_to_continue
        ${TMOE_INSTALLATION_COMMAND} micro
    fi
}
can_not_remove_the_container() {
    cat <<-ENDOFFAQ
		01ï¼š
			If you can not remove the container, then install e2fsprogs.
				${GREEN}apt update;
				apt install -y e2fsprogs${RESET}
			And then, ${GREEN}chattr -i -R CONTAINER_DIR${RESET}
			ä½¿ç”¨"chattr -i -R å®¹å™¨æ–‡ä»¶è·¯å¾„"æ¥é€’å½’è§£é™¤æ–‡ä»¶é”å®šã€‚
		02ï¼š
			è‹¥ä¸ºchrootå®¹å™¨ï¼Œä¸”åœ¨umountåï¼Œå®¹å™¨å†…éƒ¨çš„/media/sdä¸ä¸ºç©ºï¼Œåˆ™è¯·æ‰‹åŠ¨å°†è¯¥ç›®å½•å¤‡ä»½åˆ°å…¶ä»–è·¯å¾„ã€‚
			tmoe managerå°†å®¹å™¨å†…éƒ¨çš„ ${BLUE}/media/sd${RESET} è§†ä¸ºå®¿ä¸»sdçš„æŒ‚è½½ç‚¹ï¼Œè‹¥umountåè¯¥ç›®å½•ä¸ä¸ºç©ºï¼Œåˆ™æ— æ³•ç§»é™¤chrootå®¹å™¨ã€‚
	ENDOFFAQ
}
how_to_customize_the_container_dir() {
    cat <<-ENDOFFAQ
		    Q:${YELLOW}How to customize the container dir?${RESET}

			A:You can create a symbolic link.
			If the container dir is ${BLUE}${HOME}/.local/share/tmoe-linux/containers/proot/rust_arm64${RESET},then you can type the following commands.

			${GREEN}YOUR_DIR=\${HOME}/.local/my_dir
			CONTAINER_DIR=\${HOME}/.local/share/tmoe-linux/containers/proot/rust_arm64
			mv -v \${CONTAINER_DIR} \${YOUR_DIR}
			ln -svf \${YOUR_DIR}/rust_arm64 \${CONTAINER_DIR}
			${RESET}

			If the container dir is ${BLUE}/usr/local/etc/tmoe-linux/containers/chroot${RESET},then you can type the following commands.

			${GREEN}YOUR_DIR=\${HOME}/.local/my_chroot_dir
			CONTAINER_DIR=/usr/local/etc/tmoe-linux/containers/chroot
			mv -v \${CONTAINER_DIR} \${YOUR_DIR}
			ln -svf \${YOUR_DIR}/chroot \${CONTAINER_DIR}
			${RESET}

			ç®€å•æ¥è¯´ï¼Œå°±æ˜¯åˆ›å»ºè½¯é“¾æ¥å•¦ï¼
			Ï†(â‰§Ï‰â‰¦*)â™ª
			-----------------------
	ENDOFFAQ
}
questions_about_tmoe_automatic_configuration() {
    cat <<-ENDOFFAQ
		    Q:${YELLOW}ä¸ºä»€ä¹ˆä¼šè‡ªåŠ¨ä¿®æ”¹termuxçš„é…è‰²ã€å­—ä½“å’Œå°é”®ç›˜å¸ƒå±€${RESET}
			Why the color, font and keyboard layout of termux will be automatically modified during installation.
		    
			A:åªæœ‰å½“${HOME}/.termuxç›®å½•ä¸‹çš„colors.propertiesã€font.ttfå’Œtermux.properties${RED}ä¸å­˜åœ¨æ—¶${RESET}æ‰ä¼šè‡ªåŠ¨é…ç½®å“¦ï¼
			Only when the relevant file in the ~/.termux directory does not exist will it be automatically configured.

			æ—©æœŸä¼šå¼ºåˆ¶æ›´æ¢å­—ä½“,å¹¶è‡ªåŠ¨å¤‡ä»½,ç°åœ¨åªæœ‰å½“å­—ä½“ä¸å­˜åœ¨æ—¶æ‰ä¼šè‡ªåŠ¨é…ç½®ã€‚
			æœ‰äººè·Ÿæˆ‘åé¦ˆè¯´å­—ä½“æ˜¾ç¤ºå¼‚å¸¸ã€‚
			è¿™æ˜¯å› ä¸ºä»…éƒ¨åˆ†å­—ä½“æ”¯æŒzshçš„powerlevel 10kä¸»é¢˜çš„ç‰¹æ®Šå­—ç¬¦ã€‚

			è€Œé…è‰²å’Œé”®ç›˜ä¸€ç›´ä»¥æ¥éƒ½æ˜¯åªæœ‰å½“æ–‡ä»¶ä¸å­˜åœ¨æ—¶ï¼Œæ‰ä¼šè‡ªåŠ¨é…ç½®ã€‚

			ç”±äºæœ¬å·¥å…·ä¸¥é‡ä¾èµ–æ–¹å‘é”®å’Œå›è½¦é”®ï¼Œå› æ­¤ä¿®æ”¹é»˜è®¤å¸ƒå±€ç¨å¾®æœ‰ç‚¹å¿…è¦å‘¢ï¼
			æ‚¨åªéœ€è¦æ‰§è¡Œ${GREEN}rm ${HOME}/.termux/termux.properties${RESET}å³å¯åˆ é™¤é…ç½®å¹¶è¿˜åŸå›é»˜è®¤å¸ƒå±€ã€‚
			You can type ${GREEN}rm ~/.termux/termux.properties${RESET} to delete it and restore to default.
			-----------------------
			Q:${YELLOW}ä¸ºä»€ä¹ˆä¼šè‡ªåŠ¨åŠ è½½EULA?${RESET}
		    
			A:æ·»åŠ è®¸å¯åè®®æ˜¯ä¸ºäº†é¿å…ä¸å¿…è¦çš„éº»çƒ¦ã€‚
			ä½œä¸ºä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œæ‚¨å¯ä»¥éšæ—¶å®¡æŸ¥å…¶ä¸­çš„ä»£ç ï¼Œè€Œä¸å¿…è¿‡å¤šæ‹…å¿ƒæ¶æ„ä»£ç ã€‚
			-----------------------
			Q:${YELLOW}ä¸ºä»€ä¹ˆå®‰è£…æ—¶ä¼šè‡ªåŠ¨æ˜¾ç¤ºgitä»“åº“çš„é“¾æ¥?${RESET}
		    
			A:å› ä¸ºå¼€æºé¡¹ç›®èŠ±äº†å¼€å‘è€…å¾ˆé•¿çš„æ—¶é—´ï¼Œå¸Œæœ›å¤§å®¶èƒ½å°Šé‡åŸå¼€å‘è€…ã€‚
			æ¢ä½æ€è€ƒä¸€ä¸‹ï¼šå‡å¦‚ä½ è¾›è¾›è‹¦è‹¦å½•åˆ¶çš„è§†é¢‘è¢«åˆ«äººç›—äº†ï¼Œæ²¡æœ‰äººçŸ¥é“é‚£ä¸ªè§†é¢‘çœŸæ­£çš„åŸä½œè€…æ˜¯è°ï¼Œè€Œä½ çš„åŠªåŠ›æœ€ç»ˆåªèƒ½ä»˜è¯¸äºä¸œæµã€‚
			å¬è¯´å°Šé‡ä»–äººçš„åŠ³åŠ¨æˆæœï¼Œä¼šè®©ä¸–ç•Œå˜å¾—æ›´åŠ ç¾å¥½å‘¢ï¼Ï†(â‰§Ï‰â‰¦*)â™ª
			æ³¨ï¼šè‹¥æ‚¨éœ€è¦æ¼”ç¤ºtmoe-linuxæˆ–åˆ†äº«ç›¸å…³æ•™ç¨‹ï¼Œåˆ™æ— éœ€æ³¨æ˜gité“¾æ¥ã€‚
			-----------------------
	ENDOFFAQ
}
###########################
manager_frequently_asked_questions $@
