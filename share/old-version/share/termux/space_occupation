#!/usr/bin/env bash
#######################################
space_occupation_menu() {
    cd ${HOME}/..
    #15 60 4
    OPTION=$("${TUI_BIN:-whiptail}" --title "Query space occupation ranking" --menu "æŸ¥è¯¢ç©ºé—´å ç”¨æŽ’è¡Œ" 0 0 0 \
        "0" "ðŸŒš Backè¿”å›ž" \
        "1" "termuxå„ç›®å½•" \
        "2" "termuxæ–‡ä»¶" \
        "3" "sdcard" \
        "4" "æ€»å­˜å‚¨ç©ºé—´ç”¨é‡Disk usage" \
        3>&1 1>&2 2>&3)
    ###########################################################################
    case ${OPTION} in
    0 | "") ${RETURN_TO_MENU} ;;
    1)
        printf '%s\n' 'æ­£åœ¨åŠ è½½ä¸­ï¼Œå¯èƒ½éœ€è¦å‡ ç§’é’Ÿæ—¶é—´ï¼ŒåŠ è½½æ—¶é—´å–å†³äºŽæ–‡ä»¶æ•°é‡å’Œé—ªå­˜è¯»å†™é€Ÿåº¦ã€‚'
        printf '%s\n' 'Loading may take several seconds, depending on the number of files and the UFS or emmc flash read and write speed.'
        printf "%s\n" "${YELLOW}ä¸»ç›®å½• TOP15${RESET}"
        du -hsx ./home/* ./home/.* 2>/dev/null | sort -rh | head -n 15
        printf '%s\n' '-------------------'
        printf "%s\n" "${YELLOW}usr ç›®å½• TOP6${RESET}"
        du -hsx ./usr/* 2>/dev/null | sort -rh | head -n 6
        printf '%s\n' '-------------------'
        printf "%s\n" "${YELLOW}usr/lib ç›®å½• TOP8${RESET}"
        du -hsx ./usr/lib/* 2>/dev/null | sort -rh | head -n 8
        printf '%s\n' '-------------------'
        printf "%s\n" "${YELLOW}usr/share ç›®å½• TOP8${RESET}"
        du -hsx ./usr/share/* 2>/dev/null | sort -rh | head -n 8
        printf '%s\n' '-------------------'
        ;;
    2)
        printf '%s\n' 'æ­£åœ¨åŠ è½½ä¸­ï¼Œå¯èƒ½éœ€è¦å‡ ç§’é’Ÿæ—¶é—´ï¼ŒåŠ è½½æ—¶é—´å–å†³äºŽæ–‡ä»¶æ•°é‡å’Œé—ªå­˜è¯»å†™é€Ÿåº¦ã€‚'
        printf '%s\n' 'Loading may take several seconds, depending on the number of files and the UFS or emmc flash read and write speed.'
        printf "%s\n" "${YELLOW}termux æ–‡ä»¶å¤§å°æŽ’è¡Œæ¦œ(30å)${RESET}"
        find ./ -type f -print0 2>/dev/null |
            xargs -0 du 2>/dev/null |
            sort -n |
            tail -30 |
            cut -f2 |
            xargs -I{} du -sh {} 2>/dev/null
        ;;
    3)
        cd /sdcard
        printf '%s\n' 'æ­£åœ¨åŠ è½½ä¸­ï¼Œå¯èƒ½éœ€è¦å‡ ç§’é’Ÿæ—¶é—´ï¼ŒåŠ è½½æ—¶é—´å–å†³äºŽæ–‡ä»¶æ•°é‡å’Œé—ªå­˜è¯»å†™é€Ÿåº¦ã€‚'
        printf '%s\n' 'Loading may take several seconds, depending on the number of files and the UFS or emmc flash read and write speed.'
        printf "%s\n" "${YELLOW}sdcard ç›®å½• TOP15${RESET}"
        du -hsx ./* ./.* 2>/dev/null | sort -rh | head -n 15
        printf "%s\n" "${YELLOW}sdcardæ–‡ä»¶å¤§å°æŽ’è¡Œæ¦œ(30å)${RESET}"
        find ./ -type f -print0 2>/dev/null |
            xargs -0 du 2>/dev/null |
            sort -n |
            tail -30 |
            cut -f2 |
            xargs -I{} du -sh {} 2>/dev/null
        ;;
    4)
        printf "%s\n" "${YELLOW}Disk usage${RESET}"
        df -h | grep G | grep -v tmpfs
        press_enter_to_return
        space_occupation_menu
        ;;
    esac
    #####################################
    press_enter_to_return
    space_occupation_menu
}
########################################################################
space_occupation_menu $@
