#!/usr/bin/env bash
#######################################
android_termux_tmoe_menu() {
	RETURN_TO_MENU='android_termux_tmoe_menu'
	RETURN_TO_WHERE='android_termux_tmoe_menu'
	#17 60 6
	android_termux_tmoe_menu_zh() {
		OPTION=$(whiptail --title "Termux" --menu "æ‚¨å¯ä»¥é€šè¿‡VNCå®¢æˆ·ç«¯æ¥è¿žæŽ¥GNU/Linux(proot/chroot)å®¹å™¨çš„æ¡Œé¢,\nå¹¶åœ¨æ­¤å¤„ä¿®æ”¹termuxéŸ³é¢‘æœåŠ¡ç«¯çš„é…ç½®\nYou can use vncviewer to connect container DE." 0 50 0 \
			"1" "ðŸ³ mirror sourcesé•œåƒæº(åŒ—å¤–,è…¾è®¯)" \
			"2" "ðŸŽ¶ configure LAN audioå±€åŸŸç½‘éŸ³é¢‘ä¼ è¾“" \
			"3" "ðŸ… query space occupationæŸ¥è¯¢ç©ºé—´å ç”¨" \
			"4" "ðŸ‘ vnc/xsdl.apkä¸‹è½½è¿œç¨‹æ¡Œé¢å®¢æˆ·ç«¯" \
			"5" "ðŸ¤– termux_fdroid.apkä¸‹è½½termux" \
			"6" "ðŸ“º termux original GUI:åŽŸç³»ç»ŸGUI" \
			"0" "ðŸŒš Back to the main menu è¿”å›žä¸»èœå•" \
			3>&1 1>&2 2>&3)
	}
	android_termux_tmoe_menu_ja() {
		OPTION=$(whiptail --title "Termux" --menu "You can use vncviewer to connect container DE." 0 50 0 \
			"1" "ðŸ³ mirror sources" \
			"2" "ðŸŽ¶ LANã‚ªãƒ¼ãƒ‡ã‚£ã‚ªé€ä¿¡ã‚’è¨­å®šã™ã‚‹" \
			"3" "ðŸ… ã‚¯ã‚¨ãƒªã‚¹ãƒšãƒ¼ã‚¹ã®å æœ‰" \
			"4" "ðŸ‘ vnc.apkã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰" \
			"5" "ðŸ¤– termux_fdroid.apkã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰" \
			"6" "ðŸ“º termux ã‚ªãƒªã‚¸ãƒŠãƒ«ã®GUI" \
			"0" "ðŸŒš æˆ»ã‚‹" \
			3>&1 1>&2 2>&3)
	}
	android_termux_tmoe_menu_en() {
		OPTION=$(whiptail --title "Termux" --menu "You can use vncviewer to connect container DE." 0 50 0 \
			"1" "ðŸ³ mirror sources" \
			"2" "ðŸŽ¶ configure LAN audio" \
			"3" "ðŸ… query space occupation" \
			"4" "ðŸ‘ vnc/xsdl.apk" \
			"5" "ðŸ¤– termux_fdroid.apk" \
			"6" "ðŸ“º termux original GUI" \
			"0" "ðŸŒš Back to the main menu" \
			3>&1 1>&2 2>&3)
	}
	: <<\EOF
			"2" "ðŸ¹ backup å¤‡ä»½termux" \
			"3" "ðŸ”¯ restore è¿˜åŽŸ/æ¢å¤termux" \
			"2" "ðŸ¹ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ— termux" \
			"3" "ðŸ”¯ å¾©å…ƒ termux" \
			"2" "ðŸ¹ backup termux" \
			"3" "ðŸ”¯ restore termux" \
	2) backup_termux_menu ;;
	3) restore_termux_menu ;;			
EOF
	########################################
	case ${TMOE_MENU_LANG} in
	zh_*UTF-8) android_termux_tmoe_menu_zh ;;
	ja_JP.UTF-8) android_termux_tmoe_menu_ja ;;
	*) android_termux_tmoe_menu_en ;;
	esac

	case "${OPTION}" in
	0 | "") tmoe_manager_main_menu ;;
	1) tmoe_switch_sources_list ;;
	2) termux_pulse_audio_lan ;;
	3) space_occupation ;;
	4) download_vnc_apk ;;
	5) aria2_download_termux_apk ;;
	6) termux_original_system_gui ;;
	esac
	####################################
	#			"8" "Video tutorial(2020-02,æ—§ç‰ˆæ•™ç¨‹)" \	8) download_video_tutorial ;;
	press_enter_to_return
	android_termux_tmoe_menu
}
#################
tmoe_switch_sources_list() {
	source ${TMOE_SHARE_DIR}/termux/mirror
}
backup_termux_menu() {
	TMOE_CHROOT=false
	source ${TMOE_SHARE_DIR}/termux/backup
}
restore_termux_menu() {
	TMOE_CHROOT=false
	source ${TMOE_SHARE_DIR}/termux/restore
}
space_occupation() {
	source ${TMOE_SHARE_DIR}/termux/space_occupation
}
download_vnc_apk() {
	source ${TMOE_SHARE_DIR}/app/vnc
}
aria2_download_termux_apk() {
	source ${TMOE_SHARE_DIR}/app/termux
}
download_video_tutorial() {
	source ${TMOE_SHARE_DIR}/termux/video_tutorial
}
termux_original_system_gui() {
	source ${TMOE_SHARE_DIR}/termux/xfce
}
##################
termux_pulse_audio_lan() {
	if [ "${LINUX_DISTRO}" = 'Android' ]; then
		cd $PREFIX/etc/pulse
	else
		cd /etc/pulse
	fi
	if grep -q '192.168.0.0/16' default.pa; then
		LANPULSE='æ£€æµ‹åˆ°æ‚¨å·²å¯ç”¨å±€åŸŸç½‘éŸ³é¢‘ä¼ è¾“,you have enabled LAN audio transmission'
	else
		LANPULSE='æ£€æµ‹åˆ°æ‚¨æœªå¯ç”¨å±€åŸŸç½‘éŸ³é¢‘ä¼ è¾“ï¼Œé»˜è®¤ä»…å…è®¸æœ¬æœºä¼ è¾“,you have disabled LAN audio transmission'
	fi
	#10 50
	if (whiptail --title "è¯·é—®æ‚¨æ˜¯éœ€è¦å¯ç”¨è¿˜æ˜¯ç¦ç”¨æ­¤åŠŸèƒ½å‘¢ï¼Ÿ(ï½¡ï½¥âˆ€ï½¥)ï¾‰ï¾ž" --yes-button 'yes(*ï¿£â–½ï¿£*)o' --no-button 'no(ã£ Â°Ð” Â°)' --yesno "${LANPULSE},è¯·é€‰æ‹©æ‚¨éœ€è¦æ‰§è¡Œçš„æ“ä½œï¼\nDo you want to enable LAN audio transmission?" 11 50); then
		sed -i '/auth-ip-acl/d;/module-native-protocol-tcp/d' default.pa
		sed -i '$ a\load-module module-native-protocol-tcp auth-ip-acl=127.0.0.1;192.168.0.0/16;172.16.0.0/12 auth-anonymous=1' default.pa
	else
		sed -i '/auth-ip-acl/d;/module-native-protocol-tcp/d' default.pa
		sed -i '$ a\load-module module-native-protocol-tcp auth-ip-acl=127.0.0.1 auth-anonymous=0' default.pa
	fi
	printf "%s\n" "ä¿®æ”¹å®Œæˆï¼(ï¿£â–½ï¿£)"
	printf "%s\n" "å¦‚éœ€å•ç‹¬å¯åŠ¨éŸ³é¢‘æœåŠ¡ï¼Œè¯·è¾“pulseaudio --start"
	printf "%s\n" "è‹¥æ— å£°éŸ³ï¼Œåˆ™æ‚¨éœ€è¦å®‰è£…termux:apiçš„apk,å¹¶å‡çº§termuxè‡³æœ€æ–°ç‰ˆæœ¬"
	press_enter_to_return
	android_termux_tmoe_menu
}
#####################################
android_termux_tmoe_menu $@
