#!/usr/bin/env bash
#######################################
vnc_can_not_call_pulse_audio() {
	printf "%s\n" "è‹¥æ‚¨å¯åŠ¨VNCåŽï¼Œå‘çŽ°æ— éŸ³é¢‘ã€‚é¦–å…ˆè¯·ç¡®ä¿æ‚¨çš„termuxä¸ºæœ€æ–°ç‰ˆæœ¬ï¼Œå¹¶å®‰è£…äº†termux:api"
	printf "%s\n" "è‹¥æ‚¨çš„å®¿ä¸»æœºä¸ºAndroidç³»ç»Ÿï¼Œä¸”å‘çŽ°éŸ³é¢‘æœåŠ¡æ— æ³•å¯åŠ¨ï¼Œè¯·åœ¨å¯åŠ¨å®ŒæˆåŽï¼Œæ–°å»ºä¸€ä¸ªtermux sessionä¼šè¯çª—å£ï¼Œç„¶åŽæ‰‹åŠ¨åœ¨termuxåŽŸç³»ç»Ÿé‡Œè¾“${GREEN}pulseaudio -D${RESET}æ¥å¯åŠ¨éŸ³é¢‘æœåŠ¡åŽå°è¿›ç¨‹"
	printf "%s\n" "æ‚¨äº¦å¯è¾“${GREEN}pulseaudio --start${RESET}"
	printf "%s\n" "è‹¥æ‚¨æ— æ³•è®°ä½è¯¥å‘½ä»¤ï¼Œåˆ™åªéœ€è¾“${GREEN}debian${RESET}"
	printf "%s\n" "æŒ‰å›žè½¦é”®è‡ªåŠ¨å¯åŠ¨éŸ³é¢‘æœåŠ¡"
	do_you_want_to_continue
	pulseaudio --start
}
###############
create_start_linux_deploy_sh() {
	cd $PREFIX/bin
	printf "%s\n" "${CUT_TARGET}"
	cat >"${CUT_TARGET}" <<-'EndofFile'
		#!/usr/bin/env bash
		pulseaudio --start
		printf "%s\n" "pulseaudioæœåŠ¡å¯åŠ¨å®Œæˆï¼Œå°†ä¸ºæ‚¨è‡ªåŠ¨æ‰“å¼€LinuxDeploy,è¯·ç‚¹å‡»â€œå¯åŠ¨â€ã€‚"
		am start -n ru.meefik.linuxdeploy/ru.meefik.linuxdeploy.Launcher
		sleep 6
		am start -n com.realvnc.viewer.android/com.realvnc.viewer.android.app.ConnectionChooserActivity
	EndofFile
}
##############
linux_deploy_pulse_server() {
	printf "%s\n" "è‹¥æ‚¨éœ€è¦åœ¨Linux Deployä¸Šé…ç½®VNCçš„éŸ³é¢‘è½¬å‘åŠŸèƒ½ï¼Œè¯·ä½¿ç”¨æœ¬å·¥å…·(Tmoe-linux tool)è¦†ç›–å®‰è£…æ¡Œé¢çŽ¯å¢ƒ"
	printf "%s\n" "æ‚¨åœ¨å®‰è£…Linux deployçš„chrootå®¹å™¨å‰ï¼Œå¯ä»¥å°†å®‰è£…ç±»åž‹ä¿®æ”¹ä¸ºç›®å½•ï¼Œå®‰è£…è·¯å¾„ä¿®æ”¹ä¸º/data/data/ru.meefik.linuxdeploy/linux"
	printf "%s\n" "è„šæœ¬ç”¨æ³•ï¼šsshè¿žæŽ¥åŽï¼Œè¾“å…¥apt install -y curl;bash -c \"(curl -L ${TMOE_GIT_URL}/raw/2/2)\""
	#printf "%s\n" "è¦†ç›–å®‰è£…ä¹‹åŽï¼Œæ‚¨éœ€è¦é€šè¿‡æœ¬å·¥å…·è¿›è¡ŒVNCå’ŒéŸ³é¢‘æœåŠ¡çš„é…ç½®"
	printf "%s\n" "æŽ¥ä¸‹æ¥æ‚¨éœ€è¦è®¾å®šä¸€ä¸ªæ‚¨ç‹¬æœ‰çš„å¯åŠ¨å‘½ä»¤ï¼Œä¾‹å¦‚startl"
	printf "%s\n" "æ‚¨ä¹‹åŽå¯ä»¥åœ¨termuxé‡Œè¾“å…¥æ­¤å‘½ä»¤æ¥å¯åŠ¨Linux Deployä»¥åŠéŸ³é¢‘æœåŠ¡"
	do_you_want_to_continue
	TARGET=$(whiptail --inputbox "è¯·è‡ªå®šä¹‰å¯åŠ¨å‘½ä»¤åç§°\n Please enter the command name." 12 50 --title "COMMAND" 3>&1 1>&2 2>&3)
	CUT_TARGET="$(printf '%s\n' "${TARGET}" | head -n 1 | cut -d ' ' -f 1)"
	if [ -z "${CUT_TARGET}" ]; then
		printf "%s\n" "å‘½ä»¤åç§°ä¸èƒ½ä¸ºç©ºï¼ï¼ï¼"
	else
		create_start_linux_deploy_sh
	fi
	if [ ! -z ${CUT_TARGET} ]; then
		chmod a+rx ${CUT_TARGET}
		ls -lh ${PREFIX}/bin/${CUT_TARGET}
		printf "%s\n" "Congratulations!é…ç½®æˆåŠŸï¼Œæ‚¨ä¹‹åŽå¯ä»¥è¾“${CUT_TARGET}æ¥å¯åŠ¨"
	else
		printf "%s\n" "æ£€æµ‹åˆ°æ‚¨å–æ¶ˆäº†æ“ä½œ"
	fi
}
##########################
manager_frequently_asked_questions() {
	RETURN_TO_WHERE=manager_frequently_asked_questions
	# 15 60 5
	TMOE_FAQ=$(whiptail --title "FAQ(ã‚ˆãã‚ã‚‹è³ªå•)" --menu \
		"æ‚¨æœ‰å“ªäº›ç–‘é—®ï¼Ÿ\nWhat questions do you have?" 0 50 0 \
		"1" "how to customize the dirå¦‚ä½•è‡ªå®šä¹‰å®¹å™¨ç›®å½•" \
		"2" "cannot rm containeræ— æ³•ç§»é™¤å®¹å™¨" \
		"3" "About auto conf(å…³äºŽè‡ªåŠ¨é…ç½®)" \
		"4" "VNCæ— æ³•è°ƒç”¨éŸ³é¢‘" \
		"5" "ç»™Linux Deployé…ç½®VNCéŸ³é¢‘" \
		"6" "sudoå‡ºçŽ°nosuidé”™è¯¯" \
		"0" "ðŸŒš Back to the main menu è¿”å›žä¸»èœå•" \
		3>&1 1>&2 2>&3)
	##############################
	case "${TMOE_FAQ}" in
	0 | "") tmoe_manager_main_menu ;;
	1) how_to_customize_the_container_dir ;;
	2) can_not_remove_the_container ;;
	3) questions_about_tmoe_automatic_configuration ;;
	4) vnc_can_not_call_pulse_audio ;;
	5) linux_deploy_pulse_server ;;
	6) printf "%s\n" "sudo mount -o remount,rw,suid,nodev,relatime,space_cache,uhelper=udisks2 /dev/xxx /media/xxx/mountpoint" ;;
	esac
	#subvolid=5,subvol=/,compress=zstd
	#############
	press_enter_to_return
	manager_frequently_asked_questions
}
###########################
can_not_remove_the_container() {
	cat <<-ENDOFFAQ
		01ï¼š
			If you can not remove the container, then install e2fsprogs.
				${GREEN}apt update;
				apt install -y e2fsprogs${RESET}
			And then, ${GREEN}chattr -i -R CONTAINER_DIR${RESET}
			ä½¿ç”¨"chattr -i -R å®¹å™¨æ–‡ä»¶è·¯å¾„"æ¥é€’å½’è§£é™¤æ–‡ä»¶é”å®šã€‚
		02ï¼š
			è‹¥ä¸ºchrootå®¹å™¨ï¼Œä¸”åœ¨umountåŽï¼Œå®¹å™¨å†…éƒ¨çš„/media/sdä¸ä¸ºç©ºï¼Œåˆ™è¯·æ‰‹åŠ¨å°†è¯¥ç›®å½•å¤‡ä»½åˆ°å…¶ä»–è·¯å¾„ã€‚
			tmoe managerå°†å®¹å™¨å†…éƒ¨çš„ ${BLUE}/media/sd${RESET} è§†ä¸ºå®¿ä¸»sdçš„æŒ‚è½½ç‚¹ï¼Œè‹¥umountåŽè¯¥ç›®å½•ä¸ä¸ºç©ºï¼Œåˆ™æ— æ³•ç§»é™¤chrootå®¹å™¨ã€‚
	ENDOFFAQ
}
how_to_customize_the_container_dir() {
	cat <<-ENDOFFAQ
		    Q:${YELLOW}How to customize the container dir?${RESET}

			A:You can create a symbolic link.
			If the container dir is ${BLUE}${HOME}/.local/share/tmoe-linux/containers/proot/rust_arm64${RESET},then you can type the following commands.

			${GREEN}YOUR_DIR=\${HOME}/.local/my_dir
			CONTAINER_DIR=\${HOME}/.local/share/tmoe-linux/containers/proot/rust_arm64
			mv -v \${CONTAINER_DIR} \${YOUR_DIR}
			ln -svf \${YOUR_DIR}/rust_arm64 \${CONTAINER_DIR}
			${RESET}

			If the container dir is ${BLUE}/usr/local/etc/tmoe-linux/containers/chroot${RESET},then you can type the following commands.

			${GREEN}YOUR_DIR=\${HOME}/.local/my_chroot_dir
			CONTAINER_DIR=/usr/local/etc/tmoe-linux/containers/chroot
			mv -v \${CONTAINER_DIR} \${YOUR_DIR}
			ln -svf \${YOUR_DIR}/chroot \${CONTAINER_DIR}
			${RESET}

			ç®€å•æ¥è¯´ï¼Œå°±æ˜¯åˆ›å»ºè½¯é“¾æŽ¥å•¦ï¼
			Ï†(â‰§Ï‰â‰¦*)â™ª
			-----------------------
	ENDOFFAQ
}
questions_about_tmoe_automatic_configuration() {
	cat <<-ENDOFFAQ
		    Q:${YELLOW}ä¸ºä»€ä¹ˆä¼šè‡ªåŠ¨ä¿®æ”¹termuxçš„é…è‰²ã€å­—ä½“å’Œå°é”®ç›˜å¸ƒå±€${RESET}
			Why the color, font and keyboard layout of termux will be automatically modified during installation.
		    
			A:åªæœ‰å½“${HOME}/.termuxç›®å½•ä¸‹çš„colors.propertiesã€font.ttfå’Œtermux.properties${RED}ä¸å­˜åœ¨æ—¶${RESET}æ‰ä¼šè‡ªåŠ¨é…ç½®å“¦ï¼
			Only when the relevant file in the ~/.termux directory does not exist will it be automatically configured.

			æ—©æœŸä¼šå¼ºåˆ¶æ›´æ¢å­—ä½“,å¹¶è‡ªåŠ¨å¤‡ä»½,çŽ°åœ¨åªæœ‰å½“å­—ä½“ä¸å­˜åœ¨æ—¶æ‰ä¼šè‡ªåŠ¨é…ç½®ã€‚
			æœ‰äººè·Ÿæˆ‘åé¦ˆè¯´å­—ä½“æ˜¾ç¤ºå¼‚å¸¸ã€‚
			è¿™æ˜¯å› ä¸ºä»…éƒ¨åˆ†å­—ä½“æ”¯æŒzshçš„powerlevel 10kä¸»é¢˜çš„ç‰¹æ®Šå­—ç¬¦ã€‚

			è€Œé…è‰²å’Œé”®ç›˜ä¸€ç›´ä»¥æ¥éƒ½æ˜¯åªæœ‰å½“æ–‡ä»¶ä¸å­˜åœ¨æ—¶ï¼Œæ‰ä¼šè‡ªåŠ¨é…ç½®ã€‚

			ç”±äºŽæœ¬å·¥å…·ä¸¥é‡ä¾èµ–æ–¹å‘é”®å’Œå›žè½¦é”®ï¼Œå› æ­¤ä¿®æ”¹é»˜è®¤å¸ƒå±€ç¨å¾®æœ‰ç‚¹å¿…è¦å‘¢ï¼
			æ‚¨åªéœ€è¦æ‰§è¡Œ${GREEN}rm ${HOME}/.termux/termux.properties${RESET}å³å¯åˆ é™¤é…ç½®å¹¶è¿˜åŽŸå›žé»˜è®¤å¸ƒå±€ã€‚
			You can type ${GREEN}rm ~/.termux/termux.properties${RESET} to delete it and restore to default.
			-----------------------
			Q:${YELLOW}ä¸ºä»€ä¹ˆä¼šè‡ªåŠ¨åŠ è½½EULA?${RESET}
		    
			A:æ·»åŠ è®¸å¯åè®®æ˜¯ä¸ºäº†é¿å…ä¸å¿…è¦çš„éº»çƒ¦ã€‚
			ä½œä¸ºä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œæ‚¨å¯ä»¥éšæ—¶å®¡æŸ¥å…¶ä¸­çš„ä»£ç ï¼Œè€Œä¸å¿…è¿‡å¤šæ‹…å¿ƒæ¶æ„ä»£ç ã€‚
			-----------------------
			Q:${YELLOW}ä¸ºä»€ä¹ˆå®‰è£…æ—¶ä¼šè‡ªåŠ¨æ˜¾ç¤ºgitä»“åº“çš„é“¾æŽ¥?${RESET}
		    
			A:å› ä¸ºå¼€æºé¡¹ç›®èŠ±äº†å¼€å‘è€…å¾ˆé•¿çš„æ—¶é—´ï¼Œå¸Œæœ›å¤§å®¶èƒ½å°Šé‡åŽŸå¼€å‘è€…ã€‚
			æ¢ä½æ€è€ƒä¸€ä¸‹ï¼šå‡å¦‚ä½ è¾›è¾›è‹¦è‹¦å½•åˆ¶çš„è§†é¢‘è¢«åˆ«äººç›—äº†ï¼Œæ²¡æœ‰äººçŸ¥é“é‚£ä¸ªè§†é¢‘çœŸæ­£çš„åŽŸä½œè€…æ˜¯è°ï¼Œè€Œä½ çš„åŠªåŠ›æœ€ç»ˆåªèƒ½ä»˜è¯¸äºŽä¸œæµã€‚
			å¬è¯´å°Šé‡ä»–äººçš„åŠ³åŠ¨æˆæžœï¼Œä¼šè®©ä¸–ç•Œå˜å¾—æ›´åŠ ç¾Žå¥½å‘¢ï¼Ï†(â‰§Ï‰â‰¦*)â™ª
			æ³¨ï¼šè‹¥æ‚¨éœ€è¦æ¼”ç¤ºtmoe-linuxæˆ–åˆ†äº«ç›¸å…³æ•™ç¨‹ï¼Œåˆ™æ— éœ€æ³¨æ˜Žgité“¾æŽ¥ã€‚
			-----------------------
	ENDOFFAQ
}
###########################
manager_frequently_asked_questions $@
