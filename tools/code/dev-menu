#!/usr/bin/env bash
########################
development_programming_tools() {
    RETURN_TO_WHERE='development_programming_tools'
    GREP_NAME=''
    DEV_MENU=01
    SOFTWARE=$(
        whiptail --title "Development" --menu \
            "ÊÇ®ÊÉ≥Ë¶ÅÂÆâË£ÖÂì™‰∏™ËΩØ‰ª∂Ôºü\n Which software do you want to install?" 0 50 0 \
            "1" "üáª üá∏ VSCode Áé∞‰ª£Âåñ‰ª£Á†ÅÁºñËæëÂô®" \
            "2" "üá¶ üá∏ Android-Studio(ÂÆâÂçìÂºÄÂèëÂ∑•ÂÖ∑IDE)" \
            "3" "üáÆ üáØ IntelliJ IDEA(javaÁºñÁ®ãËØ≠Ë®ÄÈõÜÊàêÂºÄÂèëÁéØÂ¢É)" \
            "4" "üáµ üáæ PyCharm(pythonÈõÜÊàêÂºÄÂèëÁéØÂ¢É)" \
            "5" "üáº üá∏ Webstorm(JavaScript IDE,WebÂâçÁ´ØÂºÄÂèëÂ∑•ÂÖ∑)" \
            "6" "üá® üá± CLion(C/C++ÈõÜÊàêÂºÄÂèëÁéØÂ¢É)" \
            "7" "üá¨ üá¥ GoLand(JetBrainsÁöÑGoÂºÄÂèëÂ∑•ÂÖ∑)" \
            "8" "github-desktop(x64,githubÂÆòÊñπÊ°åÈù¢ÂÆ¢Êà∑Á´Ø)" \
            "9" "‚öõÔ∏è atom(x64,Á±ªSublimeÈ£éÊ†ºÁºñËæëÂô®,githubÂá∫ÂìÅ)" \
            "0" "üåö Return to previous menu ËøîÂõû‰∏äÁ∫ßËèúÂçï" \
            3>&1 1>&2 2>&3
    )
    #"8" "üáπ üá® teamcity(ÊåÅÁª≠ÈõÜÊàêContinue IntegrationÂ∑•ÂÖ∑)" \
    case "${SOFTWARE}" in
    0 | "") software_center ;;
    1) which_vscode_edition ;;
    2) #install_android_studio
        GREP_NAME='android-studio'
        LNK_FILE="${GREP_NAME}.desktop"
        BIN_FILE="/usr/bin/${GREP_NAME}"
        APP_OPT_DIR="/opt/${GREP_NAME}"
        DEV_MENU=02
        ;;
    3)
        GREP_NAME='intellij-idea-ultimate-edition'
        LNK_FILE='jetbrains-idea.desktop'
        BIN_FILE="/usr/bin/${GREP_NAME}"
        ICON_NAME="${GREP_NAME}.png"
        APP_OPT_DIR="/opt/${GREP_NAME}"
        ;;
    4)
        GREP_NAME='pycharm-professional'
        LNK_FILE='charm.desktop pycharm-professional.desktop'
        BIN_FILE="/usr/bin/charm /usr/bin/pycharm"
        ICON_NAME="${GREP_NAME}.png"
        APP_OPT_DIR="/opt/${GREP_NAME}"
        ;;
    5)
        GREP_NAME='webstorm'
        LNK_FILE='jetbrains-webstorm.desktop'
        BIN_FILE="/usr/bin/${GREP_NAME}"
        ICON_NAME="${GREP_NAME}.svg"
        APP_OPT_DIR="/opt/${GREP_NAME}"
        ;;
    6)
        GREP_NAME='clion-1'
        LNK_FILE='jetbrains-clion.desktop'
        BIN_FILE="/usr/bin/clion"
        ICON_NAME="${GREP_NAME}.svg"
        APP_OPT_DIR="/opt/clion"
        ;;
    7)
        GREP_NAME='goland'
        LNK_FILE='jetbrains-goland.desktop'
        BIN_FILE="/usr/bin/${GREP_NAME}"
        ICON_NAME="${GREP_NAME}.png"
        APP_OPT_DIR="/opt/${GREP_NAME}"
        ;;
    8)
        GREP_NAME='github-desktop-bin'
        LNK_FILE="github-desktop.desktop"
        BIN_FILE="/usr/bin/github-desktop"
        ICON_NAME="github-desktop.png"
        APP_OPT_DIR="/opt/github-desktop"
        ;;
    9)
        GREP_NAME='atom-editor-bin'
        LNK_FILE='atom.desktop'
        BIN_FILE="/usr/bin/atom"
        ICON_NAME="atom.png"
        APP_OPT_DIR="/opt/${GREP_NAME}"
        ;;
    esac
    #) echo "Êñ∞ÁâàÂç≥Â∞ÜÈõÜÊàêÊú¨ÂºÄÂèëÂ∑•ÂÖ∑ÁöÑÂÆâË£ÖÔºåÊï¨ËØ∑ÊúüÂæÖ" ;;
    ############################################
    case ${GREP_NAME} in
    "") ;;
    *)
        case ${DEV_MENU} in
        01) dev_menu_01 ;;
        02) dev_menu_02 ;;
        esac
        ;;
    esac
    ####################
    press_enter_to_return
    development_programming_tools
}
###########
dev_menu_02() {
    check_opt_app_version
    check_download_path
    RETURN_TO_WHERE='dev_menu_02'
    SOFTWARE=$(
        whiptail --title "${GREP_NAME}" --menu \
            "ÊÇ®ÊÉ≥Ë¶ÅÂØπ${GREP_NAME}Â∞èÂèØÁà±ÂÅö‰ªÄ‰πàÔºü" 0 50 0 \
            "1" "install/upgrade(ÂÆâË£Ö/Êõ¥Êñ∞)" \
            "2" "del pkg(Âà†Èô§ÂÆâË£ÖÂåÖ)" \
            "3" "remove(Âç∏ËΩΩ${GREP_NAME})" \
            "0" "üåö Return to previous menu ËøîÂõû‰∏äÁ∫ßËèúÂçï" \
            3>&1 1>&2 2>&3
    )
    case "${SOFTWARE}" in
    0 | "") development_programming_tools ;;
    1) install_ide_02 ;;
    2) delete_ide_pkg_02 ;;
    3) remove_ide_02 ;;
    esac
    ############################################
    press_enter_to_return
    dev_menu_02
}
###########
delete_ide_pkg_02() {
    cd ${DOWNLOAD_PATH}
    LOCAL_ARCH_PKG_VERSION=$(ls -t ${GREP_NAME}*.tar.gz 2>/dev/null | head -n 1)
    case ${LOCAL_ARCH_PKG_VERSION} in
    "") echo "Ê£ÄÊµãÂà∞ÂÆâË£ÖÂåÖ${RED}‰∏çÂ≠òÂú®${RESET}" ;;
    *)
        echo "${RED}rm -v${RESET} ${BLUE}${LOCAL_ARCH_PKG_VERSION}${RESET}"
        ls -lh ${DOWNLOAD_PATH}/${LOCAL_ARCH_PKG_VERSION}
        echo "Do you want to delete it?"
        do_you_want_to_continue
        rm -v ${LOCAL_ARCH_PKG_VERSION}
        ;;
    esac
}
###########
dev_menu_01() {
    check_opt_app_version
    check_download_path
    RETURN_TO_WHERE='dev_menu_01'
    SOFTWARE=$(
        whiptail --title "${GREP_NAME}" --menu \
            "ÊÇ®ÊÉ≥Ë¶ÅÂØπ${GREP_NAME}Â∞èÂèØÁà±ÂÅö‰ªÄ‰πàÔºü" 0 50 0 \
            "1" "install/upgrade(ÂÆâË£Ö/Êõ¥Êñ∞)" \
            "2" "del pkg(Âà†Èô§ÂÆâË£ÖÂåÖ)" \
            "3" "remove(Âç∏ËΩΩ${GREP_NAME})" \
            "0" "üåö Return to previous menu ËøîÂõû‰∏äÁ∫ßËèúÂçï" \
            3>&1 1>&2 2>&3
    )
    case "${SOFTWARE}" in
    0 | "") development_programming_tools ;;
    1) install_ide_01 ;;
    2) delete_ide_pkg ;;
    3) remove_ide_01 ;;
    esac
    ############################################
    press_enter_to_return
    dev_menu_01
}
###########
delete_ide_pkg() {
    case ${LINUX_DISTRO} in
    debian)
        apt clean
        apt autoclean
        ;;
    esac
    cd ${DOWNLOAD_PATH}
    LOCAL_ARCH_PKG_VERSION=$(ls -t ${GREP_NAME}*.pkg.tar.zst 2>/dev/null | head -n 1)
    case ${LOCAL_ARCH_PKG_VERSION} in
    "") echo "Ê£ÄÊµãÂà∞ÂÆâË£ÖÂåÖ${RED}‰∏çÂ≠òÂú®${RESET}" ;;
    *)
        echo "${RED}rm -v${RESET} ${BLUE}${LOCAL_ARCH_PKG_VERSION}${RESET}"
        ls -lh ${DOWNLOAD_PATH}/${LOCAL_ARCH_PKG_VERSION}
        echo "Do you want to delete it?"
        do_you_want_to_continue
        rm -v ${LOCAL_ARCH_PKG_VERSION}
        ;;
    esac
}
###########
remove_ide_01() {
    cd ${APPS_LNK_DIR}
    echo "${RED}rm -rv ${RESET} ${BLUE}${APP_OPT_DIR} ${LNK_FILE} /usr/share/pixmaps/${ICON_NAME} ${BIN_FILE} ${LOCAL_APP_VERSION_TXT}${RESET}"
    do_you_want_to_continue
    case ${GREP_NAME} in
    github-desktop-bin)
        rm -rv /usr/share/lintian/overrides/github-desktop /usr/share/doc/github-desktop ${APP_OPT_DIR} ${LNK_FILE} ${BIN_FILE} ${LOCAL_APP_VERSION_TXT} /usr/share/icons/hicolor/256x256/apps/github-desktop.png /usr/share/icons/hicolor/512x512/apps/github-desktop.png /usr/share/icons/hicolor/1024x1024/apps/github-desktop.png
        ;;
    atom-editor-bin) rm -rv atom.desktop atom.desktop.orig /usr/bin/apm /usr/bin/atom /usr/share/atom /usr/share/doc/atom /usr/share/licenses/atom-editor-bin /usr/share/lintian/overrides/atom /usr/share/pixmaps/atom.png /usr/share/polkit-1/actions /usr/share/polkit-1/actions/atom-stable.policy ${LOCAL_APP_VERSION_TXT} ;;
    *) rm -rv ${APP_OPT_DIR} ${LNK_FILE} /usr/share/pixmaps/${ICON_NAME} ${BIN_FILE} ${LOCAL_APP_VERSION_TXT} ;;
    esac
}
############
remove_ide_02() {
    cd ${APPS_LNK_DIR}
    echo "${RED}rm -rv ${RESET} ${BLUE}${APP_OPT_DIR} ${LNK_FILE} ${LOCAL_APP_VERSION_TXT}${RESET}"
    do_you_want_to_continue
    case ${GREP_NAME} in
    *) rm -rv ${APP_OPT_DIR} ${LNK_FILE} ${LOCAL_APP_VERSION_TXT} ;;
    esac
}
#############
check_ide_version() {
    cat <<-ENDofTable
		‚ïî‚ïê‚ïê‚ïê‚ï¶‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï¶‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï¶‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
		‚ïë   ‚ïë          ‚ïë                   ‚ïë                    
		‚ïë   ‚ïë software ‚ïë    ‚ú®ÊúÄÊñ∞ÁâàÊú¨     ‚ïë   Êú¨Âú∞ÁâàÊú¨ üé™
		‚ïë   ‚ïë          ‚ïë  Latest version   ‚ïë  Local version     
		‚ïë---‚ïë----------‚ïë-------------------‚ïë--------------------
		‚ïë 1 ‚ïë${GREP_NAME}                    ${LOCAL_OPT_APP_VERSION} 
		‚ïë   ‚ïë          ‚ïë$(echo ${THE_LATEST_APP_VERSION_CODE} | sed 's@-x86_64@@')

	ENDofTable
}
#########
uncompress_arch_pkg_tar_zst() {
    #mkdir -p ${APP_OPT_DIR}
    #cd ${APP_OPT_DIR}
    #tar --zstd -xvf ${DOWNLOAD_PATH}/${ARCH_WALLPAPER_VERSION} &>/dev/null || zstdcat "${DOWNLOAD_PATH}/${ARCH_WALLPAPER_VERSION}" | tar xvf -
    cd /
    tar --zstd -Ppxvf ${DOWNLOAD_PATH}/${ARCH_WALLPAPER_VERSION} --exclude=.*
    #cp -pf ${TMOE_TOOL_DIR}/code/lnk/${GREP_NAME}.desktop ${APPS_LNK_DIR}
}
###########
install_ide_01() {
    #check_opt_dir_01
    check_zstd
    if [ -e "/usr/share/pixmaps/${ICON_NAME}" ]; then
        if [ $(command -v catimg) ]; then
            catimg /usr/share/pixmaps/${ICON_NAME}
        else
            random_neko
        fi
    else
        random_neko
    fi
    echo "Ê≠£Âú®Ê£ÄÊµãÁâàÊú¨Êõ¥Êñ∞‰ø°ÊÅØ..."
    check_archlinux_cn_html_date
    ############
    THE_LATEST_APP_VERSION_CODE=$(cat index.html | grep '.pkg.tar.zst' | grep -Ev '.xz.sig|.zst.sig' | grep -v '\-jre\-' | grep "${GREP_NAME}" | tail -n 1 | cut -d '=' -f 3 | cut -d '"' -f 2 | sed "s@${GREP_NAME}-@@g" | sed 's@.pkg.tar.zst@@')
    check_ide_version
    case ${GREP_NAME} in
    intellij-idea-ultimate-edition)
        echo "Êú¨ÁâàÊú¨‰∏∫${GREP_NAME}(ÊóóËà∞Áâà)ÔºåÂ¶ÇÈúÄÂÆâË£Öcommunity edition(Á§æÂå∫Áâà)ÔºåÂàôËØ∑ÂâçÂæÄÂÆòÁΩëÊâãÂä®‰∏ãËΩΩÂÆâË£Ö„ÄÇ"
        echo "${BLUE}https://www.jetbrains.com/idea/download/download-thanks.html?platform=linux&code=IIC${RESET}"
        ;;
    pycharm-professional)
        echo "Êú¨ÁâàÊú¨‰∏∫${GREP_NAME}(‰∏ì‰∏öÁâà)ÔºåÂ¶ÇÈúÄÂÆâË£Öcommunity edition(Á§æÂå∫Áâà)ÔºåÂàôËØ∑ÂâçÂæÄÂÆòÁΩëÊâãÂä®‰∏ãËΩΩÂÆâË£Ö„ÄÇ"
        echo "${BLUE}https://www.jetbrains.com/pycharm/download/#section=linux${RESET}"
        ;;
    android-studio)
        THE_LATEST_AS_LINK="$(curl -L 'https://developer.android.google.cn/studio/#downloads' | grep 'linux' | grep href | grep studio | tail -n 1 | cut -d '"' -f 2)"
        echo "Ëã•ÂÆâË£ÖÂ§±Ë¥•ÔºåÂàôËØ∑ÂâçÂæÄÂÆòÁΩëÊâãÂä®‰∏ãËΩΩÂÆâË£Ö„ÄÇ"
        echo "${BLUE}https://developer.android.google.cn/studio${RESET}"
        ;;
    github-desktop-bin)
        case ${ARCH_TYPE} in
        amd64) ;;
        *)
            echo "Êú¨ÁâàÊú¨‰ªÖÊîØÊåÅx86_64Êû∂ÊûÑ"
            echo "${ARCH_TYPE}ËØ∑${RED}Ëá™Ë°åÁºñËØë${RESET}"
            echo "Github url: ${YELLOW}https://github.com/shiftkey/desktop${RESET}"
            arch_does_not_support
            ;;
        esac
        ;;
    atom-editor-bin)
        case ${ARCH_TYPE} in
        amd64) ;;
        *)
            echo "Êú¨ÁâàÊú¨‰ªÖÊîØÊåÅx86_64Êû∂ÊûÑ"
            echo "${ARCH_TYPE}ËØ∑${RED}Ëá™Ë°åÁºñËØë${RESET}"
            echo "Github url: ${YELLOW}https://github.com/atom/atom${RESET}"
            arch_does_not_support
            ;;
        esac
        ;;
    esac
    do_you_want_to_upgrade_it
    #############
    grep_arch_linux_pkg_04
    uncompress_arch_pkg_tar_zst
    case ${GREP_NAME} in
    github-desktop-bin | atom-editor-bin) ;;
    *) install_java ;;
    esac
}
##################
do_you_want_to_upgrade_it() {
    UPGRADE_TIPS="ÊÇ®ÊòØÂê¶ÈúÄË¶ÅÊõ¥Êñ∞${GREP_NAME}?"
    if [ -e /usr/games/lolcat ]; then
        echo ${UPGRADE_TIPS} | /usr/games/lolcat -a -d 7
    elif [ "$(command -v lolcat)" ]; then
        echo ${UPGRADE_TIPS} | lolcat -a -d 7
    else
        echo ${UPGRADE_TIPS}
    fi
    do_you_want_to_continue
}
##################
install_ide_02() {
    ICON_FILE='/opt/android-studio/bin/studio.png'
    if [ -e "${ICON_FILE}" ]; then
        if [ $(command -v catimg) ]; then
            catimg ${ICON_FILE}
        else
            random_neko
        fi
    else
        random_neko
    fi
    echo "Ê≠£Âú®Ê£ÄÊµãÁâàÊú¨Êõ¥Êñ∞‰ø°ÊÅØ..."
    #check_archlinux_cn_html_date
    ############
    #THE_LATEST_APP_VERSION_CODE=$(cat index.html | grep '.pkg.tar.zst' | grep -Ev '.xz.sig|.zst.sig' | grep -v '\-jre\-' | grep "${GREP_NAME}" | tail -n 1 | cut -d '=' -f 3 | cut -d '"' -f 2 | sed "s@${GREP_NAME}-@@g" | sed 's@.pkg.tar.zst@@')
    case ${GREP_NAME} in
    android-studio)
        THE_LATEST_DEB_LINK="$(curl -L 'https://developer.android.google.cn/studio/#downloads' | grep 'linux' | grep href | grep studio | tail -n 1 | cut -d '"' -f 2)"
        THE_LATEST_APP_VERSION_CODE="$(echo ${THE_LATEST_DEB_LINK} | awk -F '/' '{print $NF}' | sed 's@-linux.tar.gz@@' | sed 's@android-studio-ide-@@')"
        DOWNLOAD_FILE_NAME=$(echo ${THE_LATEST_DEB_LINK} | awk -F '/' '{print $NF}')
        echo "Ëã•ÂÆâË£ÖÂ§±Ë¥•ÔºåÂàôËØ∑ÂâçÂæÄÂÆòÁΩëÊâãÂä®‰∏ãËΩΩÂÆâË£Ö„ÄÇ"
        echo "${BLUE}https://developer.android.com/studio${RESET}"
        ;;
    esac
    check_ide_version
    do_you_want_to_upgrade_it
    #############
    #grep_arch_linux_pkg_04
    download_android_studio
    install_android_studio
    #uncompress_arch_pkg_tar_zst
    case ${GREP_NAME} in
    android-studio) install_java ;;
    esac
}
#############
creat_android_studio_application_link() {
    cd ${APPS_LNK_DIR}
    #Icon=android-studio
    cat >android-studio.desktop <<-'EOF'
		[Desktop Entry]
		Name=Android Studio
		Type=Application
		Comment=Android Studio provides the fastest tools for building apps on every type of Android device.
		Exec=/opt/android-studio/bin/studio.sh %F
		Icon=/opt/android-studio/bin/studio.svg
		Categories=TextEditor;Development;IDE;
		MimeType=text/plain;inode/directory;
		Terminal=false
		Actions=new-empty-window;
		StartupNotify=true
		StartupWMClass=Android-Studio
	EOF
    chmod a+r android-studio.desktop
}
#########################
download_android_studio() {
    cd ${DOWNLOAD_PATH}
    LOCAL_ARCH_PKG_VERSION=$(ls -t ${GREP_NAME}*.tar.gz 2>/dev/null | head -n 1)
    case ${LOCAL_ARCH_PKG_VERSION} in
    ${DOWNLOAD_FILE_NAME}) echo "Ê£ÄÊµãÂà∞ÊÇ®Â∑≤Áªè‰∏ãËΩΩÊúÄÊñ∞ÁâàÁöÑ${LOCAL_ARCH_PKG_VERSION},Â¶ÇÈúÄÂà†Èô§ÂÆâË£ÖÂåÖÔºåËØ∑Ëæì${RED}rm -v${RESET} ${BLUE}${DOWNLOAD_PATH}/${LOCAL_ARCH_PKG_VERSION}${RESET}" ;;
    *) aria2c --allow-overwrite=true -d ${DOWNLOAD_PATH} -o ${DOWNLOAD_FILE_NAME} -x 10 -s 10 -k 1M ${THE_LATEST_DEB_LINK} ;;
    esac
    echo ${THE_LATEST_APP_VERSION_CODE} >"${LOCAL_APP_VERSION_TXT}"
    #echo ${THE_LATEST_DEB_LINK}
    #echo "Do you want to download and install it?"
    #do_you_want_to_continue
    #aria2c --allow-overwrite=true -s 10 -x 10 -k 1M -o android_studio_linux_64bit.tar.gz ${THE_LATEST_DEB_LINK}
}
###############
check_android_studio() {
    mkdir -p ${HOME}/sd/Download
    cd ${HOME}/sd/Download
    if [ -e "/opt/android-studio" ]; then
        echo 'ÊÇ®Â∑≤ÂÆâË£ÖAndroid studio'
        echo "Ëã•ÊÇ®ÈúÄË¶ÅÂç∏ËΩΩÔºåÂàôËØ∑Ëæì${RED}rm -rv${RESET} ${HOME}/sd/Download/android_studio_linux_64bit.tar.gz ${BLUE}/opt/android-studio ${APPS_LNK_DIR}/android_studio.desktop${RESET};${RED}${TMOE_REMOVAL_COMMAND}${RESET} ${BLUE}default-jre${RESET}"
        echo "ÊòØÂê¶ÈúÄË¶ÅÈáçÊñ∞ÂÆâË£ÖÔºü"
        echo "Do you want to reinstall it?"
        do_you_want_to_continue
    fi
    if [ ! -e "android_studio_linux_64bit.tar.gz" ]; then
        download_android_studio
    fi
    install_java
}
##############
install_android_studio() {
    #check_android_studio
    tar -pzxvf ${DOWNLOAD_PATH}/${DOWNLOAD_FILE_NAME} -C /opt
    creat_android_studio_application_link
    #echo "ÂÆâË£ÖÂåÖ‰Ωç‰∫é${BLUE}${HOME}/sd/Download/android_studio_linux_64bit.tar.gz${RESET}"
    echo "ÂÆâË£ÖÂÆåÊàêÔºåÂ¶ÇÈúÄÂç∏ËΩΩÔºåÂàôËØ∑Ëæì${RED}rm -rv${RESET} ${BLUE}/opt/android-studio ${APPS_LNK_DIR}/android_studio.desktop${RESET};${RED}${TMOE_REMOVAL_COMMAND}${RESET} ${BLUE}default-jre${RESET}"
}
##################
development_programming_tools
